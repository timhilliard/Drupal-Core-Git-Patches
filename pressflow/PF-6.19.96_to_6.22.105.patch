diff --git a/.htaccess b/.htaccess
index c14fc63..4733ffa 100644
--- a/.htaccess
+++ b/.htaccess
@@ -113,4 +113,4 @@ DirectoryIndex index.php
   RewriteRule ^(.*)$ index.php?q=$1 [L,QSA]
 </IfModule>
 
-# $Id: .htaccess,v 1.90.2.5 2010/02/02 07:25:22 dries Exp $
+# $Id$
diff --git a/CHANGELOG.txt b/CHANGELOG.txt
index c9126fa..8f6f713 100644
--- a/CHANGELOG.txt
+++ b/CHANGELOG.txt
@@ -1,4 +1,18 @@
-// $Id: CHANGELOG.txt,v 1.253.2.41 2010/08/11 20:35:47 goba Exp $
+
+Drupal 6.22, 2011-05-25
+----------------------
+- Made Drupal 6 work better with IIS and Internet Explorer.
+- Fixed .po file imports to work better with custom textgroups.
+- Improved code documentation at various places.
+- Fixed a variety of other bugs.
+
+Drupal 6.21, 2011-05-25
+----------------------
+- Fixed security issues (Cross site scripting), see SA-CORE-2011-001.
+
+Drupal 6.20, 2010-12-15
+----------------------
+- Fixed a variety of small bugs, improved code documentation.
 
 Drupal 6.19, 2010-08-11
 ----------------------
diff --git a/COPYRIGHT.txt b/COPYRIGHT.txt
index 5ad7735..94bfd61 100644
--- a/COPYRIGHT.txt
+++ b/COPYRIGHT.txt
@@ -1,4 +1,3 @@
-// $Id: COPYRIGHT.txt,v 1.2.2.3 2010/08/06 10:58:29 goba Exp $
 
 All Drupal code is Copyright 2001 - 2010 by the original authors.
 
diff --git a/INSTALL.mysql.txt b/INSTALL.mysql.txt
index dfccf1c..5383c72 100644
--- a/INSTALL.mysql.txt
+++ b/INSTALL.mysql.txt
@@ -1,4 +1,3 @@
-// $Id: INSTALL.mysql.txt,v 1.10 2007/11/19 19:53:51 goba Exp $
 
 CREATE THE MySQL DATABASE
 --------------------------
diff --git a/INSTALL.pgsql.txt b/INSTALL.pgsql.txt
index aabcfcd..7054c16 100644
--- a/INSTALL.pgsql.txt
+++ b/INSTALL.pgsql.txt
@@ -1,4 +1,3 @@
-// $Id: INSTALL.pgsql.txt,v 1.7 2007/11/26 16:36:42 dries Exp $
 
 CREATE THE PostgreSQL DATABASE
 ------------------------------
diff --git a/INSTALL.txt b/INSTALL.txt
index 5d5abdd..44e12c6 100644
--- a/INSTALL.txt
+++ b/INSTALL.txt
@@ -1,4 +1,3 @@
-// $Id: INSTALL.txt,v 1.61.2.4 2008/07/09 19:15:59 goba Exp $
 
 CONTENTS OF THIS FILE
 ---------------------
@@ -71,7 +70,7 @@ INSTALLATION
    different language, we have good news. You can install and use Drupal in
    other languages from the start. Check whether a released package of the
    language desired is available for this Drupal version at
-   http://drupal.org/project/translations and download the package. Extract
+   http://localize.drupal.org and download the package. Extract
    the contents to the same directory where you extracted Drupal into.
 
 2. CREATE THE CONFIGURATION FILE AND GRANT WRITE PERMISSIONS
diff --git a/LICENSE.txt b/LICENSE.txt
index 450923a..2c095c8 100644
--- a/LICENSE.txt
+++ b/LICENSE.txt
@@ -1,340 +1,274 @@
-// $Id: LICENSE.txt,v 1.5.4.1 2009/01/06 17:27:13 goba Exp $
-		    GNU GENERAL PUBLIC LICENSE
-		       Version 2, June 1991
-
- Copyright (C) 1989, 1991 Free Software Foundation, Inc.,
- 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
- Everyone is permitted to copy and distribute verbatim copies
- of this license document, but changing it is not allowed.
-
-			    Preamble
-
-  The licenses for most software are designed to take away your
-freedom to share and change it.  By contrast, the GNU General Public
-License is intended to guarantee your freedom to share and change free
-software--to make sure the software is free for all its users.  This
-General Public License applies to most of the Free Software
-Foundation's software and to any other program whose authors commit to
-using it.  (Some other Free Software Foundation software is covered by
-the GNU Lesser General Public License instead.)  You can apply it to
-your programs, too.
-
-  When we speak of free software, we are referring to freedom, not
-price.  Our General Public Licenses are designed to make sure that you
-have the freedom to distribute copies of free software (and charge for
-this service if you wish), that you receive source code or can get it
-if you want it, that you can change the software or use pieces of it
-in new free programs; and that you know you can do these things.
-
-  To protect your rights, we need to make restrictions that forbid
-anyone to deny you these rights or to ask you to surrender the rights.
-These restrictions translate to certain responsibilities for you if you
-distribute copies of the software, or if you modify it.
-
-  For example, if you distribute copies of such a program, whether
-gratis or for a fee, you must give the recipients all the rights that
-you have.  You must make sure that they, too, receive or can get the
-source code.  And you must show them these terms so they know their
-rights.
-
-  We protect your rights with two steps: (1) copyright the software, and
-(2) offer you this license which gives you legal permission to copy,
-distribute and/or modify the software.
-
-  Also, for each author's protection and ours, we want to make certain
-that everyone understands that there is no warranty for this free
-software.  If the software is modified by someone else and passed on, we
-want its recipients to know that what they have is not the original, so
-that any problems introduced by others will not reflect on the original
-authors' reputations.
-
-  Finally, any free program is threatened constantly by software
-patents.  We wish to avoid the danger that redistributors of a free
-program will individually obtain patent licenses, in effect making the
-program proprietary.  To prevent this, we have made it clear that any
-patent must be licensed for everyone's free use or not licensed at all.
-
-  The precise terms and conditions for copying, distribution and
-modification follow.
-
-		    GNU GENERAL PUBLIC LICENSE
-   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
-
-  0. This License applies to any program or other work which contains
-a notice placed by the copyright holder saying it may be distributed
-under the terms of this General Public License.  The "Program", below,
-refers to any such program or work, and a "work based on the Program"
-means either the Program or any derivative work under copyright law:
-that is to say, a work containing the Program or a portion of it,
-either verbatim or with modifications and/or translated into another
-language.  (Hereinafter, translation is included without limitation in
-the term "modification".)  Each licensee is addressed as "you".
-
-Activities other than copying, distribution and modification are not
-covered by this License; they are outside its scope.  The act of
-running the Program is not restricted, and the output from the Program
-is covered only if its contents constitute a work based on the
-Program (independent of having been made by running the Program).
-Whether that is true depends on what the Program does.
-
-  1. You may copy and distribute verbatim copies of the Program's
-source code as you receive it, in any medium, provided that you
-conspicuously and appropriately publish on each copy an appropriate
-copyright notice and disclaimer of warranty; keep intact all the
-notices that refer to this License and to the absence of any warranty;
-and give any other recipients of the Program a copy of this License
-along with the Program.
-
-You may charge a fee for the physical act of transferring a copy, and
-you may at your option offer warranty protection in exchange for a fee.
-
-  2. You may modify your copy or copies of the Program or any portion
-of it, thus forming a work based on the Program, and copy and
-distribute such modifications or work under the terms of Section 1
-above, provided that you also meet all of these conditions:
-
-    a) You must cause the modified files to carry prominent notices
-    stating that you changed the files and the date of any change.
-
-    b) You must cause any work that you distribute or publish, that in
-    whole or in part contains or is derived from the Program or any
-    part thereof, to be licensed as a whole at no charge to all third
-    parties under the terms of this License.
-
-    c) If the modified program normally reads commands interactively
-    when run, you must cause it, when started running for such
-    interactive use in the most ordinary way, to print or display an
-    announcement including an appropriate copyright notice and a
-    notice that there is no warranty (or else, saying that you provide
-    a warranty) and that users may redistribute the program under
-    these conditions, and telling the user how to view a copy of this
-    License.  (Exception: if the Program itself is interactive but
-    does not normally print such an announcement, your work based on
-    the Program is not required to print an announcement.)
-
-These requirements apply to the modified work as a whole.  If
-identifiable sections of that work are not derived from the Program,
-and can be reasonably considered independent and separate works in
-themselves, then this License, and its terms, do not apply to those
-sections when you distribute them as separate works.  But when you
-distribute the same sections as part of a whole which is a work based
-on the Program, the distribution of the whole must be on the terms of
-this License, whose permissions for other licensees extend to the
-entire whole, and thus to each and every part regardless of who wrote it.
-
-Thus, it is not the intent of this section to claim rights or contest
-your rights to work written entirely by you; rather, the intent is to
-exercise the right to control the distribution of derivative or
-collective works based on the Program.
+GNU GENERAL PUBLIC LICENSE
+
+              Version 2, June 1991
+
+Copyright (C) 1989, 1991 Free Software Foundation, Inc. 675 Mass Ave,
+Cambridge, MA 02139, USA. Everyone is permitted to copy and distribute
+verbatim copies of this license document, but changing it is not allowed.
+
+                  Preamble
+
+The licenses for most software are designed to take away your freedom to
+share and change it. By contrast, the GNU General Public License is
+intended to guarantee your freedom to share and change free software--to
+make sure the software is free for all its users. This General Public License
+applies to most of the Free Software Foundation's software and to any other
+program whose authors commit to using it. (Some other Free Software
+Foundation software is covered by the GNU Library General Public License
+instead.) You can apply it to your programs, too.
+
+When we speak of free software, we are referring to freedom, not price. Our
+General Public Licenses are designed to make sure that you have the
+freedom to distribute copies of free software (and charge for this service if
+you wish), that you receive source code or can get it if you want it, that you
+can change the software or use pieces of it in new free programs; and that
+you know you can do these things.
+
+To protect your rights, we need to make restrictions that forbid anyone to
+deny you these rights or to ask you to surrender the rights. These restrictions
+translate to certain responsibilities for you if you distribute copies of the
+software, or if you modify it.
+
+For example, if you distribute copies of such a program, whether gratis or for
+a fee, you must give the recipients all the rights that you have. You must make
+sure that they, too, receive or can get the source code. And you must show
+them these terms so they know their rights.
+
+We protect your rights with two steps: (1) copyright the software, and (2)
+offer you this license which gives you legal permission to copy, distribute
+and/or modify the software.
+
+Also, for each author's protection and ours, we want to make certain that
+everyone understands that there is no warranty for this free software. If the
+software is modified by someone else and passed on, we want its recipients
+to know that what they have is not the original, so that any problems
+introduced by others will not reflect on the original authors' reputations.
+
+Finally, any free program is threatened constantly by software patents. We
+wish to avoid the danger that redistributors of a free program will individually
+obtain patent licenses, in effect making the program proprietary. To prevent
+this, we have made it clear that any patent must be licensed for everyone's
+free use or not licensed at all.
+
+The precise terms and conditions for copying, distribution and modification
+follow.
+
+           GNU GENERAL PUBLIC LICENSE
+ TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND
+               MODIFICATION
+
+0. This License applies to any program or other work which contains a notice
+placed by the copyright holder saying it may be distributed under the terms
+of this General Public License. The "Program", below, refers to any such
+program or work, and a "work based on the Program" means either the
+Program or any derivative work under copyright law: that is to say, a work
+containing the Program or a portion of it, either verbatim or with
+modifications and/or translated into another language. (Hereinafter, translation
+is included without limitation in the term "modification".) Each licensee is
+addressed as "you".
+
+Activities other than copying, distribution and modification are not covered
+by this License; they are outside its scope. The act of running the Program is
+not restricted, and the output from the Program is covered only if its contents
+constitute a work based on the Program (independent of having been made
+by running the Program). Whether that is true depends on what the Program
+does.
+
+1. You may copy and distribute verbatim copies of the Program's source
+code as you receive it, in any medium, provided that you conspicuously and
+appropriately publish on each copy an appropriate copyright notice and
+disclaimer of warranty; keep intact all the notices that refer to this License
+and to the absence of any warranty; and give any other recipients of the
+Program a copy of this License along with the Program.
+
+You may charge a fee for the physical act of transferring a copy, and you
+may at your option offer warranty protection in exchange for a fee.
+
+2. You may modify your copy or copies of the Program or any portion of it,
+thus forming a work based on the Program, and copy and distribute such
+modifications or work under the terms of Section 1 above, provided that you
+also meet all of these conditions:
+
+a) You must cause the modified files to carry prominent notices stating that
+you changed the files and the date of any change.
+
+b) You must cause any work that you distribute or publish, that in whole or in
+part contains or is derived from the Program or any part thereof, to be
+licensed as a whole at no charge to all third parties under the terms of this
+License.
+
+c) If the modified program normally reads commands interactively when run,
+you must cause it, when started running for such interactive use in the most
+ordinary way, to print or display an announcement including an appropriate
+copyright notice and a notice that there is no warranty (or else, saying that
+you provide a warranty) and that users may redistribute the program under
+these conditions, and telling the user how to view a copy of this License.
+(Exception: if the Program itself is interactive but does not normally print such
+an announcement, your work based on the Program is not required to print
+an announcement.)
+
+These requirements apply to the modified work as a whole. If identifiable
+sections of that work are not derived from the Program, and can be
+reasonably considered independent and separate works in themselves, then
+this License, and its terms, do not apply to those sections when you distribute
+them as separate works. But when you distribute the same sections as part
+of a whole which is a work based on the Program, the distribution of the
+whole must be on the terms of this License, whose permissions for other
+licensees extend to the entire whole, and thus to each and every part
+regardless of who wrote it.
+
+Thus, it is not the intent of this section to claim rights or contest your rights to
+work written entirely by you; rather, the intent is to exercise the right to
+control the distribution of derivative or collective works based on the
+Program.
 
 In addition, mere aggregation of another work not based on the Program
-with the Program (or with a work based on the Program) on a volume of
-a storage or distribution medium does not bring the other work under
-the scope of this License.
-
-  3. You may copy and distribute the Program (or a work based on it,
-under Section 2) in object code or executable form under the terms of
-Sections 1 and 2 above provided that you also do one of the following:
-
-    a) Accompany it with the complete corresponding machine-readable
-    source code, which must be distributed under the terms of Sections
-    1 and 2 above on a medium customarily used for software interchange; or,
-
-    b) Accompany it with a written offer, valid for at least three
-    years, to give any third party, for a charge no more than your
-    cost of physically performing source distribution, a complete
-    machine-readable copy of the corresponding source code, to be
-    distributed under the terms of Sections 1 and 2 above on a medium
-    customarily used for software interchange; or,
-
-    c) Accompany it with the information you received as to the offer
-    to distribute corresponding source code.  (This alternative is
-    allowed only for noncommercial distribution and only if you
-    received the program in object code or executable form with such
-    an offer, in accord with Subsection b above.)
+with the Program (or with a work based on the Program) on a volume of a
+storage or distribution medium does not bring the other work under the scope
+of this License.
+
+3. You may copy and distribute the Program (or a work based on it, under
+Section 2) in object code or executable form under the terms of Sections 1
+and 2 above provided that you also do one of the following:
+
+a) Accompany it with the complete corresponding machine-readable source
+code, which must be distributed under the terms of Sections 1 and 2 above
+on a medium customarily used for software interchange; or,
+
+b) Accompany it with a written offer, valid for at least three years, to give
+any third party, for a charge no more than your cost of physically performing
+source distribution, a complete machine-readable copy of the corresponding
+source code, to be distributed under the terms of Sections 1 and 2 above on
+a medium customarily used for software interchange; or,
+
+c) Accompany it with the information you received as to the offer to distribute
+corresponding source code. (This alternative is allowed only for
+noncommercial distribution and only if you received the program in object
+code or executable form with such an offer, in accord with Subsection b
+above.)
 
 The source code for a work means the preferred form of the work for
-making modifications to it.  For an executable work, complete source
-code means all the source code for all modules it contains, plus any
-associated interface definition files, plus the scripts used to
-control compilation and installation of the executable.  However, as a
-special exception, the source code distributed need not include
-anything that is normally distributed (in either source or binary
-form) with the major components (compiler, kernel, and so on) of the
-operating system on which the executable runs, unless that component
-itself accompanies the executable.
-
-If distribution of executable or object code is made by offering
-access to copy from a designated place, then offering equivalent
-access to copy the source code from the same place counts as
-distribution of the source code, even though third parties are not
-compelled to copy the source along with the object code.
-
-  4. You may not copy, modify, sublicense, or distribute the Program
-except as expressly provided under this License.  Any attempt
-otherwise to copy, modify, sublicense or distribute the Program is
-void, and will automatically terminate your rights under this License.
-However, parties who have received copies, or rights, from you under
-this License will not have their licenses terminated so long as such
-parties remain in full compliance.
-
-  5. You are not required to accept this License, since you have not
-signed it.  However, nothing else grants you permission to modify or
-distribute the Program or its derivative works.  These actions are
-prohibited by law if you do not accept this License.  Therefore, by
-modifying or distributing the Program (or any work based on the
-Program), you indicate your acceptance of this License to do so, and
-all its terms and conditions for copying, distributing or modifying
-the Program or works based on it.
-
-  6. Each time you redistribute the Program (or any work based on the
-Program), the recipient automatically receives a license from the
-original licensor to copy, distribute or modify the Program subject to
-these terms and conditions.  You may not impose any further
-restrictions on the recipients' exercise of the rights granted herein.
-You are not responsible for enforcing compliance by third parties to
-this License.
-
-  7. If, as a consequence of a court judgment or allegation of patent
-infringement or for any other reason (not limited to patent issues),
-conditions are imposed on you (whether by court order, agreement or
-otherwise) that contradict the conditions of this License, they do not
-excuse you from the conditions of this License.  If you cannot
-distribute so as to satisfy simultaneously your obligations under this
-License and any other pertinent obligations, then as a consequence you
-may not distribute the Program at all.  For example, if a patent
-license would not permit royalty-free redistribution of the Program by
-all those who receive copies directly or indirectly through you, then
-the only way you could satisfy both it and this License would be to
+making modifications to it. For an executable work, complete source code
+means all the source code for all modules it contains, plus any associated
+interface definition files, plus the scripts used to control compilation and
+installation of the executable. However, as a special exception, the source
+code distributed need not include anything that is normally distributed (in
+either source or binary form) with the major components (compiler, kernel,
+and so on) of the operating system on which the executable runs, unless that
+component itself accompanies the executable.
+
+If distribution of executable or object code is made by offering access to
+copy from a designated place, then offering equivalent access to copy the
+source code from the same place counts as distribution of the source code,
+even though third parties are not compelled to copy the source along with the
+object code.
+
+4. You may not copy, modify, sublicense, or distribute the Program except as
+expressly provided under this License. Any attempt otherwise to copy,
+modify, sublicense or distribute the Program is void, and will automatically
+terminate your rights under this License. However, parties who have received
+copies, or rights, from you under this License will not have their licenses
+terminated so long as such parties remain in full compliance.
+
+5. You are not required to accept this License, since you have not signed it.
+However, nothing else grants you permission to modify or distribute the
+Program or its derivative works. These actions are prohibited by law if you
+do not accept this License. Therefore, by modifying or distributing the
+Program (or any work based on the Program), you indicate your acceptance
+of this License to do so, and all its terms and conditions for copying,
+distributing or modifying the Program or works based on it.
+
+6. Each time you redistribute the Program (or any work based on the
+Program), the recipient automatically receives a license from the original
+licensor to copy, distribute or modify the Program subject to these terms and
+conditions. You may not impose any further restrictions on the recipients'
+exercise of the rights granted herein. You are not responsible for enforcing
+compliance by third parties to this License.
+
+7. If, as a consequence of a court judgment or allegation of patent
+infringement or for any other reason (not limited to patent issues), conditions
+are imposed on you (whether by court order, agreement or otherwise) that
+contradict the conditions of this License, they do not excuse you from the
+conditions of this License. If you cannot distribute so as to satisfy
+simultaneously your obligations under this License and any other pertinent
+obligations, then as a consequence you may not distribute the Program at all.
+For example, if a patent license would not permit royalty-free redistribution
+of the Program by all those who receive copies directly or indirectly through
+you, then the only way you could satisfy both it and this License would be to
 refrain entirely from distribution of the Program.
 
-If any portion of this section is held invalid or unenforceable under
-any particular circumstance, the balance of the section is intended to
-apply and the section as a whole is intended to apply in other
-circumstances.
-
-It is not the purpose of this section to induce you to infringe any
-patents or other property right claims or to contest validity of any
-such claims; this section has the sole purpose of protecting the
-integrity of the free software distribution system, which is
-implemented by public license practices.  Many people have made
-generous contributions to the wide range of software distributed
-through that system in reliance on consistent application of that
-system; it is up to the author/donor to decide if he or she is willing
-to distribute software through any other system and a licensee cannot
-impose that choice.
-
-This section is intended to make thoroughly clear what is believed to
-be a consequence of the rest of this License.
-
-  8. If the distribution and/or use of the Program is restricted in
-certain countries either by patents or by copyrighted interfaces, the
-original copyright holder who places the Program under this License
-may add an explicit geographical distribution limitation excluding
-those countries, so that distribution is permitted only in or among
-countries not thus excluded.  In such case, this License incorporates
-the limitation as if written in the body of this License.
-
-  9. The Free Software Foundation may publish revised and/or new versions
-of the General Public License from time to time.  Such new versions will
-be similar in spirit to the present version, but may differ in detail to
-address new problems or concerns.
-
-Each version is given a distinguishing version number.  If the Program
-specifies a version number of this License which applies to it and "any
-later version", you have the option of following the terms and conditions
-either of that version or of any later version published by the Free
-Software Foundation.  If the Program does not specify a version number of
-this License, you may choose any version ever published by the Free Software
-Foundation.
-
-  10. If you wish to incorporate parts of the Program into other free
-programs whose distribution conditions are different, write to the author
-to ask for permission.  For software which is copyrighted by the Free
-Software Foundation, write to the Free Software Foundation; we sometimes
-make exceptions for this.  Our decision will be guided by the two goals
-of preserving the free status of all derivatives of our free software and
-of promoting the sharing and reuse of software generally.
-
-			    NO WARRANTY
-
-  11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
-FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW.  EXCEPT WHEN
-OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES
-PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED
-OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
-MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  THE ENTIRE RISK AS
-TO THE QUALITY AND PERFORMANCE OF THE PROGRAM IS WITH YOU.  SHOULD THE
-PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING,
-REPAIR OR CORRECTION.
-
-  12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
-WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
-REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
-INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES ARISING
-OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT NOT LIMITED
-TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY
-YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM TO OPERATE WITH ANY OTHER
-PROGRAMS), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE
-POSSIBILITY OF SUCH DAMAGES.
-
-		     END OF TERMS AND CONDITIONS
-
-	    How to Apply These Terms to Your New Programs
-
-  If you develop a new program, and you want it to be of the greatest
-possible use to the public, the best way to achieve this is to make it
-free software which everyone can redistribute and change under these terms.
-
-  To do so, attach the following notices to the program.  It is safest
-to attach them to the start of each source file to most effectively
-convey the exclusion of warranty; and each file should have at least
-the "copyright" line and a pointer to where the full notice is found.
-
-    <one line to give the program's name and a brief idea of what it does.>
-    Copyright (C) <year>  <name of author>
-
-    This program is free software; you can redistribute it and/or modify
-    it under the terms of the GNU General Public License as published by
-    the Free Software Foundation; either version 2 of the License, or
-    (at your option) any later version.
-
-    This program is distributed in the hope that it will be useful,
-    but WITHOUT ANY WARRANTY; without even the implied warranty of
-    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-    GNU General Public License for more details.
-
-    You should have received a copy of the GNU General Public License along
-    with this program; if not, write to the Free Software Foundation, Inc.,
-    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
-
-Also add information on how to contact you by electronic and paper mail.
-
-If the program is interactive, make it output a short notice like this
-when it starts in an interactive mode:
-
-    Gnomovision version 69, Copyright (C) year name of author
-    Gnomovision comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
-    This is free software, and you are welcome to redistribute it
-    under certain conditions; type `show c' for details.
-
-The hypothetical commands `show w' and `show c' should show the appropriate
-parts of the General Public License.  Of course, the commands you use may
-be called something other than `show w' and `show c'; they could even be
-mouse-clicks or menu items--whatever suits your program.
-
-You should also get your employer (if you work as a programmer) or your
-school, if any, to sign a "copyright disclaimer" for the program, if
-necessary.  Here is a sample; alter the names:
-
-  Yoyodyne, Inc., hereby disclaims all copyright interest in the program
-  `Gnomovision' (which makes passes at compilers) written by James Hacker.
-
-  <signature of Ty Coon>, 1 April 1989
-  Ty Coon, President of Vice
-
-This General Public License does not permit incorporating your program into
-proprietary programs.  If your program is a subroutine library, you may
-consider it more useful to permit linking proprietary applications with the
-library.  If this is what you want to do, use the GNU Lesser General
-Public License instead of this License.
+If any portion of this section is held invalid or unenforceable under any
+particular circumstance, the balance of the section is intended to apply and
+the section as a whole is intended to apply in other circumstances.
+
+It is not the purpose of this section to induce you to infringe any patents or
+other property right claims or to contest validity of any such claims; this
+section has the sole purpose of protecting the integrity of the free software
+distribution system, which is implemented by public license practices. Many
+people have made generous contributions to the wide range of software
+distributed through that system in reliance on consistent application of that
+system; it is up to the author/donor to decide if he or she is willing to
+distribute software through any other system and a licensee cannot impose
+that choice.
+
+This section is intended to make thoroughly clear what is believed to be a
+consequence of the rest of this License.
+
+8. If the distribution and/or use of the Program is restricted in certain
+countries either by patents or by copyrighted interfaces, the original copyright
+holder who places the Program under this License may add an explicit
+geographical distribution limitation excluding those countries, so that
+distribution is permitted only in or among countries not thus excluded. In such
+case, this License incorporates the limitation as if written in the body of this
+License.
+
+9. The Free Software Foundation may publish revised and/or new versions
+of the General Public License from time to time. Such new versions will be
+similar in spirit to the present version, but may differ in detail to address new
+problems or concerns.
+
+Each version is given a distinguishing version number. If the Program specifies
+a version number of this License which applies to it and "any later version",
+you have the option of following the terms and conditions either of that
+version or of any later version published by the Free Software Foundation. If
+the Program does not specify a version number of this License, you may
+choose any version ever published by the Free Software Foundation.
+
+10. If you wish to incorporate parts of the Program into other free programs
+whose distribution conditions are different, write to the author to ask for
+permission. For software which is copyrighted by the Free Software
+Foundation, write to the Free Software Foundation; we sometimes make
+exceptions for this. Our decision will be guided by the two goals of
+preserving the free status of all derivatives of our free software and of
+promoting the sharing and reuse of software generally.
+
+               NO WARRANTY
+
+11. BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE,
+THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT
+PERMITTED BY APPLICABLE LAW. EXCEPT WHEN OTHERWISE
+STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR
+OTHER PARTIES PROVIDE THE PROGRAM "AS IS" WITHOUT
+WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED,
+INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
+PURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND
+PERFORMANCE OF THE PROGRAM IS WITH YOU. SHOULD THE
+PROGRAM PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL
+NECESSARY SERVICING, REPAIR OR CORRECTION.
+
+12. IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR
+AGREED TO IN WRITING WILL ANY COPYRIGHT HOLDER, OR
+ANY OTHER PARTY WHO MAY MODIFY AND/OR
+REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE
+LIABLE TO YOU FOR DAMAGES, INCLUDING ANY GENERAL,
+SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES
+ARISING OUT OF THE USE OR INABILITY TO USE THE
+PROGRAM (INCLUDING BUT NOT LIMITED TO LOSS OF DATA
+OR DATA BEING RENDERED INACCURATE OR LOSSES
+SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF THE
+PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS), EVEN
+IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF
+THE POSSIBILITY OF SUCH DAMAGES.
+
+          END OF TERMS AND CONDITIONS
diff --git a/MAINTAINERS.txt b/MAINTAINERS.txt
index 7a3a200..9c09f88 100644
--- a/MAINTAINERS.txt
+++ b/MAINTAINERS.txt
@@ -1,4 +1,3 @@
-// $Id: MAINTAINERS.txt,v 1.19.2.2 2009/04/29 17:15:10 goba Exp $
 
 List of maintainers
 --------------------------------------------------------------------------------
diff --git a/PRESSFLOW.txt b/PRESSFLOW.txt
index 57594fd..a3fc27d 100644
--- a/PRESSFLOW.txt
+++ b/PRESSFLOW.txt
@@ -1 +1 @@
-6.19.96
+6.22.104
diff --git a/UPGRADE.txt b/UPGRADE.txt
index e67b90e..4a1ac70 100644
--- a/UPGRADE.txt
+++ b/UPGRADE.txt
@@ -1,4 +1,3 @@
-// $Id: UPGRADE.txt,v 1.12.2.1 2010/05/11 09:39:36 goba Exp $
 
 UPGRADING
 ---------
diff --git a/cron.php b/cron.php
index bf1218a..79fd238 100644
--- a/cron.php
+++ b/cron.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: cron.php,v 1.36 2006/08/09 07:42:55 dries Exp $
 
 /**
  * @file
diff --git a/includes/actions.inc b/includes/actions.inc
index 3b990a3..f997535 100644
--- a/includes/actions.inc
+++ b/includes/actions.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: actions.inc,v 1.8.2.13 2010/08/11 20:35:47 goba Exp $
 
 /**
  * @file
diff --git a/includes/batch.inc b/includes/batch.inc
index fea418f..13e8500 100644
--- a/includes/batch.inc
+++ b/includes/batch.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: batch.inc,v 1.14.2.1 2010/08/06 11:52:19 goba Exp $
 
 /**
  * @file Batch processing API for processes to run in multiple HTTP requests.
@@ -245,7 +244,7 @@ function _batch_process() {
       '@percentage' => $percentage,
       );
     $message = strtr($progress_message, $values) .'<br/>';
-    $message .= $task_message ? $task_message : '&nbsp';
+    $message .= $task_message ? $task_message : '&nbsp;';
 
     return array($percentage, $message);
   }
diff --git a/includes/bootstrap.inc b/includes/bootstrap.inc
index c31b2e1..986ed1c 100644
--- a/includes/bootstrap.inc
+++ b/includes/bootstrap.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: bootstrap.inc,v 1.206.2.29 2010/08/06 11:50:24 goba Exp $
 
 /**
  * @file
@@ -384,7 +383,7 @@ function conf_init() {
   global $base_url, $base_path, $base_root;
 
   // Export the following settings.php variables to the global namespace
-  global $db_url, $db_slave_url, $db_prefix, $cookie_domain, $conf, $installed_profile, $update_free_access;
+  global $db_url, $db_slave_url, $db_prefix, $db_collation, $cookie_domain, $conf, $installed_profile, $update_free_access;
   $conf = array();
 
   if (isset($_SERVER['HTTP_HOST'])) {
@@ -500,7 +499,7 @@ function conf_init() {
  * the above, depending on where the module is located.
  *
  * @param $type
- *   The type of the item (i.e. theme, theme_engine, module).
+ *   The type of the item (i.e. theme, theme_engine, module, profile).
  * @param $name
  *   The name of the item for which the filename is requested.
  * @param $filename
@@ -755,7 +754,7 @@ function bootstrap_invoke_all($hook) {
  * including a theme, engine, module, etc., more than once.
  *
  * @param $type
- *   The type of item to load (i.e. theme, theme_engine, module).
+ *   The type of item to load (i.e. theme, theme_engine, module, profile).
  * @param $name
  *   The name of the item to load.
  *
diff --git a/includes/cache-install.inc b/includes/cache-install.inc
index 8112798..b7809fe 100644
--- a/includes/cache-install.inc
+++ b/includes/cache-install.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: cache-install.inc,v 1.2 2007/08/07 08:39:35 goba Exp $
 
 /**
  * A stub cache implementation to be used during the installation
diff --git a/includes/cache.inc b/includes/cache.inc
index d08a485..c02b063 100644
--- a/includes/cache.inc
+++ b/includes/cache.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: cache.inc,v 1.17.2.4 2009/12/16 17:30:00 goba Exp $
 
 /**
  * Return data from the persistent cache. Data may be stored as either plain text or as serialized data.
@@ -39,7 +38,7 @@ function cache_get($cid, $table = 'cache') {
     // cache timer. The cache variable is loaded into the $user object by
     // sess_read() in session.inc.
     else {
-      if ($user->cache > $cache->created) {
+      if (isset($user->cache) && $user->cache > $cache->created) {
         // This cache data is too old and thus not valid for us, ignore it.
         return 0;
       }
diff --git a/includes/common.inc b/includes/common.inc
index c3f7dc7..43f05d4 100644
--- a/includes/common.inc
+++ b/includes/common.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: common.inc,v 1.756.2.96 2010/08/11 20:35:47 goba Exp $
 
 /**
  * @file
@@ -194,7 +193,7 @@ function drupal_get_feeds($delimiter = "\n") {
 }
 
 /**
- * @name HTTP handling
+ * @defgroup http_handling HTTP handling
  * @{
  * Functions to properly handle HTTP responses.
  */
@@ -646,7 +645,7 @@ function drupal_error_handler($errno, $message, $filename, $line, $context) {
       }
     }
 
-    $entry = $types[$errno] .': '. $message .' in '. $filename .' on line '. $line .'.';
+    $entry = check_plain($types[$errno]) .': '. filter_xss($message) .' in '. check_plain($filename) .' on line '. check_plain($line) .'.';
 
     // Force display of error messages in update.php.
     if (variable_get('error_level', 1) == 1 || strstr($_SERVER['SCRIPT_NAME'], 'update.php')) {
@@ -946,14 +945,15 @@ function t($string, $args = array(), $langcode = NULL) {
  */
 
 /**
- * Verify the syntax of the given e-mail address.
+ * Verifies the syntax of the given e-mail address.
  *
- * Empty e-mail addresses are allowed. See RFC 2822 for details.
+ * See RFC 2822 for details.
  *
  * @param $mail
  *   A string containing an e-mail address.
  * @return
- *   TRUE if the address is in a valid format.
+ *   1 if the email address is valid, 0 if it is invalid or empty, and FALSE if
+ *   there is an input error (such as passing in an array instead of a string).
  */
 function valid_email_address($mail) {
   $user = '[a-zA-Z0-9_\-\.\+\^!#\$%&*+\/\=\?\`\|\{\}~\']+';
@@ -1636,7 +1636,8 @@ function drupal_page_footer() {
  *   A linear array.
  * @param $function
  *   A name of a function to apply to all values before output.
- * @result
+ *
+ * @return
  *   An associative array.
  */
 function drupal_map_assoc($array, $function = NULL) {
@@ -1704,7 +1705,7 @@ function drupal_eval($code) {
  * Returns the path to a system item (module, theme, etc.).
  *
  * @param $type
- *   The type of the item (i.e. theme, theme_engine, module).
+ *   The type of the item (i.e. theme, theme_engine, module, profile).
  * @param $name
  *   The name of the item for which the path is requested.
  *
@@ -1742,7 +1743,7 @@ function drupal_add_link($attributes) {
  *
  * @param $path
  *   (optional) The path to the CSS file relative to the base_path(), e.g.,
- *   /modules/devel/devel.css.
+ *   modules/devel/devel.css.
  *
  *   Modules should always prefix the names of their CSS files with the module
  *   name, for example: system-menus.css rather than simply menus.css. Themes
@@ -2022,12 +2023,12 @@ function drupal_load_stylesheet($file, $optimize = NULL) {
       // Regexp to match single quoted strings.
       $single_quot = "'[^'\\\\]*(?:\\\\.[^'\\\\]*)*'";
       $contents = preg_replace_callback(
-        "<$double_quot|$single_quot|$comment>Sus",  // Match all comment blocks along
-        "_process_comment",                         // with double/single quoted strings
-        $contents);                                 // and feed them to _process_comment().
+        "<$double_quot|$single_quot|$comment>Ss",  // Match all comment blocks along
+        "_process_comment",                        // with double/single quoted strings
+        $contents);                                // and feed them to _process_comment().
       $contents = preg_replace(
-        '<\s*([@{}:;,]|\)\s|\s\()\s*>S',            // Remove whitespace around separators,
-        '\1', $contents);                           // but keep space around parentheses.
+        '<\s*([@{}:;,]|\)\s|\s\()\s*>S',           // Remove whitespace around separators,
+        '\1', $contents);                          // but keep space around parentheses.
       // End the file with a new line.
       $contents .= "\n";
     }
@@ -2839,13 +2840,21 @@ function drupal_system_listing($mask, $directory, $key = 'name', $min_depth = 1)
  * interface for all altering operations.
  *
  * @param $type
- *   The data type of the structured array. 'form', 'links',
- *   'node_content', and so on are several examples.
+ *   A string describing the type of the alterable $data (e.g. 'form',
+ *   'profile').
  * @param $data
- *   The structured array to be altered.
+ *   The variable that will be passed to hook_TYPE_alter() implementations to
+ *   be altered. The type of this variable depends on $type. For example, when
+ *   altering a 'form', $data will be a structured array. When altering a
+ *   'profile', $data will be an object. If you need to pass additional
+ *   parameters by reference to the hook_TYPE_alter() functions, include them
+ *   as an array in $data['__drupal_alter_by_ref']. They will be unpacked and
+ *   passed to the hook_TYPE_alter() functions, before the additional
+ *   ... parameters (see below).
  * @param ...
- *   Any additional params will be passed on to the called
- *   hook_$type_alter functions.
+ *   Any additional parameters will be passed on to the hook_TYPE_alter()
+ *   functions (not by reference), after any by-reference parameters included
+ *   in $data (see above)
  */
 function drupal_alter($type, &$data) {
   // PHP's func_get_args() always returns copies of params, not references, so
@@ -3145,10 +3154,6 @@ function drupal_common_theme() {
     'pager_link' => array(
       'arguments' => array('text' => NULL, 'page_new' => NULL, 'element' => NULL, 'parameters' => array(), 'attributes' => array()),
     ),
-    // from locale.inc
-    'locale_admin_manage_screen' => array(
-      'arguments' => array('form' => NULL),
-    ),
     // from menu.inc
     'menu_item_link' => array(
       'arguments' => array('item' => NULL),
@@ -3264,7 +3269,10 @@ function drupal_get_schema($table = NULL, $rebuild = FALSE) {
 
       // Invoke hook_schema for all modules.
       foreach (module_implements('schema') as $module) {
-        $current = module_invoke($module, 'schema');
+        // Cast the result of hook_schema() to an array, as a NULL return value
+        // would cause array_merge() to set the $schema variable to NULL as well.
+        // That would break modules which use $schema further down the line.
+        $current = (array) module_invoke($module, 'schema');
         _drupal_initialize_schema($module, $current);
         $schema = array_merge($schema, $current);
       }
@@ -3367,9 +3375,11 @@ function drupal_get_schema_unprocessed($module, $table = NULL) {
   if (!is_null($table) && isset($schema[$table])) {
     return $schema[$table];
   }
-  else {
+  elseif (!empty($schema)) {
     return $schema;
   }
+
+  return array();
 }
 
 /**
diff --git a/includes/database.inc b/includes/database.inc
index 5733e1d..ad36f8e 100644
--- a/includes/database.inc
+++ b/includes/database.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: database.inc,v 1.92.2.10 2010/08/06 11:05:03 goba Exp $
 
 /**
  * @file
@@ -513,7 +512,6 @@ function db_escape_table($string) {
  *   - 'fields': An associative array ('fieldname' => specification)
  *     that describes the table's database columns.  The specification
  *     is also an array.  The following specification parameters are defined:
- *
  *     - 'description': A string describing this field and its purpose.
  *       References to other tables should be enclosed in
  *       curly-brackets.  For example, the node table vid field
@@ -532,7 +530,6 @@ function db_escape_table($string) {
  *       datatypes will be used (e.g. on MySQL, TINYINT vs. INT vs. BIGINT).
  *       'normal', the default, selects the base type (e.g. on MySQL,
  *       INT, VARCHAR, BLOB, etc.).
- *
  *       Not all sizes are available for all data types. See
  *       db_type_map() for possible combinations.
  *     - 'not null': If true, no NULL values will be allowed in this
@@ -551,10 +548,8 @@ function db_escape_table($string) {
  *       the precision (total number of significant digits) and scale
  *       (decimal digits right of the decimal point).  Both values are
  *       mandatory.  Ignored for other field types.
- *
  *     All parameters apart from 'type' are optional except that type
  *     'numeric' columns must specify 'precision' and 'scale'.
- *
  *  - 'primary key': An array of one or more key column specifiers (see below)
  *    that form the primary key.
  *  - 'unique keys': An associative array of unique keys ('keyname' =>
diff --git a/includes/database.mysql-common.inc b/includes/database.mysql-common.inc
index b322c8b..e3e0d85 100644
--- a/includes/database.mysql-common.inc
+++ b/includes/database.mysql-common.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: database.mysql-common.inc,v 1.17.2.4 2010/03/01 10:37:30 goba Exp $
 
 /**
  * @file
@@ -60,7 +59,16 @@ function db_query($query) {
 function db_create_table_sql($name, $table) {
 
   if (empty($table['mysql_suffix'])) {
-    $table['mysql_suffix'] = "/*!40100 DEFAULT CHARACTER SET UTF8 */";
+    $table['mysql_suffix'] = '/*!40100 DEFAULT CHARACTER SET utf8';
+    // By default, MySQL uses the default collation for new tables, which is
+    // 'utf8_general_ci' for utf8. If an alternate collation has been set, it
+    // needs to be explicitly specified.
+    // @see db_connect()
+    $collation = (!empty($table['collation']) ? $table['collation'] : (!empty($GLOBALS['db_collation']) ? $GLOBALS['db_collation'] : ''));
+    if ($collation) {
+      $table['mysql_suffix'] .= ' COLLATE ' . $collation;
+    }
+    $table['mysql_suffix'] .= ' */';
   }
 
   $sql = "CREATE TABLE {". $name ."} (\n";
@@ -281,7 +289,7 @@ function db_drop_table(&$ret, $table) {
  *   table along with adding the field. The format is the same as a
  *   table specification but without the 'fields' element.  If you are
  *   adding a type 'serial' field, you MUST specify at least one key
- *   or index including it in this array. @see db_change_field for more
+ *   or index including it in this array. See db_change_field() for more
  *   explanation why.
  */
 function db_add_field(&$ret, $table, $field, $spec, $keys_new = array()) {
diff --git a/includes/database.mysql.inc b/includes/database.mysql.inc
index e068598..ed4fb4f 100644
--- a/includes/database.mysql.inc
+++ b/includes/database.mysql.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: database.mysql.inc,v 1.89.2.2 2010/02/01 16:32:10 goba Exp $
 
 /**
  * @file
@@ -80,8 +79,16 @@ function db_connect($url) {
     _db_error_page(mysql_error());
   }
 
-  // Force UTF-8.
-  mysql_query('SET NAMES "utf8"', $connection);
+  // Force MySQL to use the UTF-8 character set. Also set the collation, if a
+  // certain one has been set; otherwise, MySQL defaults to 'utf8_general_ci'
+  // for UTF-8.
+  if (!empty($GLOBALS['db_collation'])) {
+    mysql_query('SET NAMES utf8 COLLATE '. $GLOBALS['db_collation'], $connection);
+  }
+  else {
+    mysql_query('SET NAMES utf8', $connection);
+  }
+
   return $connection;
 }
 
@@ -182,6 +189,7 @@ function db_fetch_array($result) {
  *
  * @param $result
  *   A database query result resource, as returned from db_query().
+ * 
  * @return
  *   The resulting field or FALSE.
  */
@@ -396,6 +404,12 @@ function db_unlock_tables() {
 
 /**
  * Check if a table exists.
+ *
+ * @param $table
+ *   The name of the table.
+ *
+ * @return
+ *   TRUE if the table exists, and FALSE if the table does not exist.
  */
 function db_table_exists($table) {
   return (bool) db_fetch_object(db_query("SHOW TABLES LIKE '{". db_escape_table($table) ."}'"));
@@ -403,6 +417,14 @@ function db_table_exists($table) {
 
 /**
  * Check if a column exists in the given table.
+ *
+ * @param $table
+ *   The name of the table.
+ * @param $column
+ *   The name of the column.
+ *
+ * @return
+ *   TRUE if the column exists, and FALSE if the column does not exist.
  */
 function db_column_exists($table, $column) {
   return (bool) db_fetch_object(db_query("SHOW COLUMNS FROM {". db_escape_table($table) ."} LIKE '". db_escape_table($column) ."'"));
diff --git a/includes/database.mysqli.inc b/includes/database.mysqli.inc
index 645211b..61a1da6 100644
--- a/includes/database.mysqli.inc
+++ b/includes/database.mysqli.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: database.mysqli.inc,v 1.54.2.2 2010/02/01 16:32:10 goba Exp $
 
 /**
  * @file
@@ -79,8 +78,15 @@ function db_connect($url) {
     _db_error_page(mysqli_connect_error());
   }
 
-  // Force UTF-8.
-  mysqli_query($connection, 'SET NAMES "utf8"');
+  // Force MySQL to use the UTF-8 character set. Also set the collation, if a
+  // certain one has been set; otherwise, MySQL defaults to 'utf8_general_ci'
+  // for UTF-8.
+  if (!empty($GLOBALS['db_collation'])) {
+    mysqli_query($connection, 'SET NAMES utf8 COLLATE ' . $GLOBALS['db_collation']);
+  }
+  else {
+    mysqli_query($connection, 'SET NAMES utf8');
+  }
 
   return $connection;
 }
@@ -398,6 +404,12 @@ function db_unlock_tables() {
 
 /**
  * Check if a table exists.
+ *
+ * @param $table
+ *   The name of the table.
+ *
+ * @return
+ *   TRUE if the table exists, and FALSE if the table does not exist.
  */
 function db_table_exists($table) {
   return (bool) db_fetch_object(db_query("SHOW TABLES LIKE '{". db_escape_table($table) ."}'"));
@@ -405,6 +417,14 @@ function db_table_exists($table) {
 
 /**
  * Check if a column exists in the given table.
+ *
+ * @param $table
+ *   The name of the table.
+ * @param $column
+ *   The name of the column.
+ *
+ * @return
+ *   TRUE if the column exists, and FALSE if the column does not exist.
  */
 function db_column_exists($table, $column) {
   return (bool) db_fetch_object(db_query("SHOW COLUMNS FROM {". db_escape_table($table) ."} LIKE '". db_escape_table($column) ."'"));
diff --git a/includes/database.pgsql.inc b/includes/database.pgsql.inc
index d533802..575f702 100644
--- a/includes/database.pgsql.inc
+++ b/includes/database.pgsql.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: database.pgsql.inc,v 1.68.2.9 2010/05/28 15:02:16 goba Exp $
 
 /**
  * @file
@@ -441,6 +440,12 @@ function db_unlock_tables() {
 
 /**
  * Check if a table exists.
+ *
+ * @param $table
+ *   The name of the table.
+ *
+ * @return
+ *   TRUE if the table exists, and FALSE if the table does not exist.
  */
 function db_table_exists($table) {
   return (bool) db_result(db_query("SELECT COUNT(*) FROM pg_class WHERE relname = '{". db_escape_table($table) ."}'"));
@@ -448,6 +453,14 @@ function db_table_exists($table) {
 
 /**
  * Check if a column exists in the given table.
+ *
+ * @param $table
+ *   The name of the table.
+ * @param $column
+ *   The name of the column.
+ *
+ * @return
+ *   TRUE if the column exists, and FALSE if the column does not exist.
  */
 function db_column_exists($table, $column) {
   return (bool) db_result(db_query("SELECT COUNT(pg_attribute.attname) FROM pg_class, pg_attribute WHERE pg_attribute.attrelid = pg_class.oid AND pg_class.relname = '{". db_escape_table($table) ."}' AND attname = '". db_escape_table($column) ."'"));
@@ -701,12 +714,12 @@ function db_drop_table(&$ret, $table) {
  *   created field will be set to the value of the key in all rows.
  *   This is most useful for creating NOT NULL columns with no default
  *   value in existing tables.
- * @param $keys_new
+ * @param $new_keys
  *   Optional keys and indexes specification to be created on the
  *   table along with adding the field. The format is the same as a
  *   table specification but without the 'fields' element.  If you are
  *   adding a type 'serial' field, you MUST specify at least one key
- *   or index including it in this array. @see db_change_field for more
+ *   or index including it in this array. See db_change_field() for more
  *   explanation why.
  */
 function db_add_field(&$ret, $table, $field, $spec, $new_keys = array()) {
diff --git a/includes/file.inc b/includes/file.inc
index 3c8f246..a30da01 100644
--- a/includes/file.inc
+++ b/includes/file.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: file.inc,v 1.121.2.13 2010/08/11 17:40:55 goba Exp $
 
 /**
  * @file
@@ -121,17 +120,28 @@ function file_create_path($dest = 0) {
 }
 
 /**
- * Check that the directory exists and is writable. Directories need to
- * have execute permissions to be considered a directory by FTP servers, etc.
+ * Checks whether a directory exists and is writable.
  *
- * @param $directory A string containing the name of a directory path.
- * @param $mode A Boolean value to indicate if the directory should be created
- *   if it does not exist or made writable if it is read-only.
- * @param $form_item An optional string containing the name of a form item that
- *   any errors will be attached to. This is useful for settings forms that
- *   require the user to specify a writable directory. If it can't be made to
- *   work, a form error will be set preventing them from saving the settings.
- * @return FALSE when directory not found, or TRUE when directory exists.
+ * Furthermore, the directory can optionally be created if it does not exist,
+ * and/or be set to writable if it is currently not. Directories need to have
+ * execute permission to be considered a directory by FTP servers.
+ *
+ * @param $directory
+ *   A string representing the directory path.
+ * @param $mode
+ *   An optional bitmask containing the actions, if any, to be carried out on
+ *   the directory. Any combination of the actions FILE_CREATE_DIRECTORY and
+ *   FILE_MODIFY_PERMISSIONS is allowed.
+ * @param $form_item
+ *   An optional string containing the name of a form item that any errors
+ *   will be attached to. Useful when the function validates a directory path
+ *   entered as a form value. An error will consequently prevent form submit
+ *   handlers from running, and instead display the form along with the
+ *   error messages.
+ *
+ * @return
+ *   FALSE if the directory does not exist or is not writable, even after
+ *   any optional actions have been carried out. Otherwise, TRUE is returned.
  */
 function file_check_directory(&$directory, $mode = 0, $form_item = NULL) {
   $directory = rtrim($directory, '/\\');
@@ -525,17 +535,17 @@ function file_space_used($uid = NULL) {
 }
 
 /**
- * Saves a file upload to a new location. The source file is validated as a
- * proper upload and handled as such.
+ * Saves a file upload to a new location.
  *
- * The file will be added to the files table as a temporary file. Temporary files
- * are periodically cleaned. To make the file permanent file call
+ * The source file is validated as a proper upload and handled as such.
+ * The file will be added to the files table as a temporary file. Temporary
+ * files are periodically cleaned. To make the file permanent file call
  * file_set_status() to change its status.
  *
  * @param $source
  *   A string specifying the name of the upload field to save.
  * @param $validators
- *   An optional, associative array of callback functions used to validate the
+ *   (optional) An associative array of callback functions used to validate the
  *   file. The keys are function names and the values arrays of callback
  *   parameters which will be passed in after the file object. The
  *   functions should return an array of error messages; an empty array
@@ -545,9 +555,12 @@ function file_space_used($uid = NULL) {
  *   A string containing the directory $source should be copied to. If this is
  *   not provided or is not writable, the temporary directory will be used.
  * @param $replace
- *   A boolean indicating whether an existing file of the same name in the
- *   destination directory should overwritten. A false value will generate a
- *   new, unique filename in the destination directory.
+ *   Replace behavior when the destination file already exists:
+ *   - FILE_EXISTS_REPLACE: Replace the existing file.
+ *   - FILE_EXISTS_RENAME: Append _{incrementing number} until the filename
+ *     is unique.
+ *   - FILE_EXISTS_ERROR: Do nothing and return FALSE.
+ *
  * @return
  *   An object containing the file information, or 0 in the event of an error.
  */
@@ -693,9 +706,12 @@ function file_validate_name_length($file) {
  * @param $file
  *   A Drupal file object.
  * @param $extensions
- *   A string with a space separated
+ *   A string with a space separated list of allowed file extensions, not
+ *   including the period. For example, 'bmp jpg gif png'.
+ *
  * @return
- *   An array. If the file extension is not allowed, it will contain an error message.
+ *   An array. If the file extension is not allowed, it will contain an error
+ *   message.
  */
 function file_validate_extensions($file, $extensions) {
   global $user;
@@ -876,6 +892,14 @@ function file_transfer($source, $headers) {
   if (ob_get_level()) {
     ob_end_clean();
   }
+  
+  // IE cannot download private files because it cannot store files downloaded
+  // over https in the browser cache. The problem can be solved by sending
+  // custom headers to IE. See http://support.microsoft.com/kb/323308/en-us
+  if (isset($_SERVER['HTTPS']) && ($_SERVER['HTTPS'] == 'on')) {
+    drupal_set_header('Cache-Control: private');
+    drupal_set_header('Pragma: private');
+  }
 
   foreach ($headers as $header) {
     // To prevent HTTP header injection, we delete new lines that are
diff --git a/includes/form.inc b/includes/form.inc
index 4f027b7..1529c19 100644
--- a/includes/form.inc
+++ b/includes/form.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: form.inc,v 1.265.2.34 2010/08/06 11:02:49 goba Exp $
 
 /**
  * @defgroup forms Form builder functions
@@ -62,7 +61,9 @@
  *   Any additional arguments are passed on to the functions called by
  *   drupal_get_form(), including the unique form constructor function.
  *   For example, the node_edit form requires that a node object be passed
- *   in here when it is called.
+ *   in here when it is called. These are available to implementations of
+ *   hook_form_alter() and hook_form_FORM_ID_alter() as the array
+ *   $form['#parameters'].
  * @return
  *   The rendered form.
  */
diff --git a/includes/image.gd.inc b/includes/image.gd.inc
index 53c651c..a62dbda 100644
--- a/includes/image.gd.inc
+++ b/includes/image.gd.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: image.gd.inc,v 1.4 2008/01/15 10:17:42 goba Exp $
 
 /**
  * @file
diff --git a/includes/image.inc b/includes/image.inc
index e23e9eb..1580d31 100644
--- a/includes/image.inc
+++ b/includes/image.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: image.inc,v 1.24 2008/01/28 16:05:17 goba Exp $
 
 /**
  * @file
@@ -114,7 +113,9 @@ function image_toolkit_invoke($method, $params = array()) {
  *    'file_size' - File size in bytes.
  */
 function image_get_info($file) {
-  if (!is_file($file)) {
+  // Proceed no further if this file doesn't exist. Some web servers (IIS) may
+  // not pass is_file() for newly uploaded files, so we need two checks here.
+  if (!is_file($file) && !is_uploaded_file($file)) {
     return FALSE;
   }
 
diff --git a/includes/install.inc b/includes/install.inc
index 17aa518..e70f87c 100644
--- a/includes/install.inc
+++ b/includes/install.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: install.inc,v 1.56.2.4 2009/02/16 10:25:02 goba Exp $
 
 define('SCHEMA_UNINSTALLED', -1);
 define('SCHEMA_INSTALLED', 0);
diff --git a/includes/install.mysql.inc b/includes/install.mysql.inc
index 2b2e0f3..e544294 100644
--- a/includes/install.mysql.inc
+++ b/includes/install.mysql.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: install.mysql.inc,v 1.9 2008/01/23 09:59:29 goba Exp $
 
 // MySQL specific install functions
 
diff --git a/includes/install.mysqli.inc b/includes/install.mysqli.inc
index 7aa6d1e..8920d01 100644
--- a/includes/install.mysqli.inc
+++ b/includes/install.mysqli.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: install.mysqli.inc,v 1.12 2008/01/23 09:59:29 goba Exp $
 
 // MySQLi specific install functions
 
diff --git a/includes/install.pgsql.inc b/includes/install.pgsql.inc
index e873ab7..fde97a3 100644
--- a/includes/install.pgsql.inc
+++ b/includes/install.pgsql.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: install.pgsql.inc,v 1.6 2007/10/22 15:22:39 dries Exp $
 
 // PostgreSQL specific install functions
 
diff --git a/includes/language.inc b/includes/language.inc
index abbc1cb..0409766 100644
--- a/includes/language.inc
+++ b/includes/language.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: language.inc,v 1.14.2.2 2010/03/22 12:18:04 goba Exp $
 
 /**
  * @file
diff --git a/includes/locale.inc b/includes/locale.inc
index a88033b..8c5461f 100644
--- a/includes/locale.inc
+++ b/includes/locale.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: locale.inc,v 1.174.2.14 2010/08/11 19:42:26 goba Exp $
 
 /**
  * @file
@@ -1672,7 +1671,7 @@ function _locale_import_shorten_comments($comment) {
       break;
     }
   }
-  return substr($comm, 0, -2);
+  return trim(substr($comm, 0, -2));
 }
 
 /**
diff --git a/includes/lock.inc b/includes/lock.inc
index e10629d..0bc6786 100644
--- a/includes/lock.inc
+++ b/includes/lock.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: lock.inc,v 1.1.2.4 2010/05/11 09:30:20 goba Exp $
 
 /**
  * @file
diff --git a/includes/mail.inc b/includes/mail.inc
index ce13469..92540e2 100644
--- a/includes/mail.inc
+++ b/includes/mail.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: mail.inc,v 1.8.2.8 2010/06/02 12:07:24 goba Exp $
 
 /**
  * Compose and optionally send an e-mail message.
diff --git a/includes/menu.inc b/includes/menu.inc
index 26c8052..86e1e60 100644
--- a/includes/menu.inc
+++ b/includes/menu.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: menu.inc,v 1.255.2.34 2010/02/01 18:00:49 goba Exp $
 
 /**
  * @file
@@ -72,7 +71,7 @@
  */
 
 /**
- * @name Menu flags
+ * @defgroup menu_flags Menu flags
  * @{
  * Flags for use in the "type" attribute of menu items.
  */
@@ -90,8 +89,10 @@ define('MENU_IS_LOCAL_TASK', 0x0080);
  */
 
 /**
- * @name Menu item types
+ * @defgroup menu_item_types Menu item types
  * @{
+ * Definitions for various menu item types.
+ *
  * Menu item definitions provide one of these constants, which are shortcuts for
  * combinations of the above flags.
  */
@@ -135,7 +136,7 @@ define('MENU_DEFAULT_LOCAL_TASK', MENU_IS_LOCAL_TASK | MENU_LINKS_TO_PARENT);
  */
 
 /**
- * @name Menu status codes
+ * @defgroup menu_status_codes Menu status codes
  * @{
  * Status codes for menu callbacks.
  */
@@ -150,9 +151,9 @@ define('MENU_SITE_OFFLINE', 4);
  */
 
 /**
- * @Name Menu tree parameters
+ * @defgroup menu_tree_parameters Menu tree parameters
  * @{
- * Menu tree
+ * Parameters for a menu tree.
  */
 
  /**
@@ -550,7 +551,7 @@ function _menu_item_localize(&$item, $map, $link_translate = FALSE) {
  *   path from the menu table, for example tabs.
  * @return
  *   Returns the map with objects loaded as defined in the
- *   $item['load_functions. $item['access'] becomes TRUE if the item is
+ *   $item['load_functions']. $item['access'] becomes TRUE if the item is
  *   accessible, FALSE otherwise. $item['href'] is set according to the map.
  *   If an error occurs during calling the load_functions (like trying to load
  *   a non existing node) then this function return FALSE.
@@ -1509,14 +1510,15 @@ function menu_set_active_item($path) {
  * @param $new_trail
  *   Menu trail to set, or NULL to use previously-set or calculated trail. If
  *   supplying a trail, use the same format as the return value (see below).
+ *
  * @return
  *   Path to menu root of the current page, as an array of menu link items,
  *   starting with the site's home page. Each link item is an associative array
  *   with the following components:
- *   - 'title': Title of the item.
- *   - 'href': Drupal path of the item.
- *   - 'localized_options': Options for passing into the l() function.
- *   - 'type': A menu type constant, such as MENU_DEFAULT_LOCAL_TASK, or 0 to
+ *   - title: Title of the item.
+ *   - href: Drupal path of the item.
+ *   - localized_options: Options for passing into the l() function.
+ *   - type: A menu type constant, such as MENU_DEFAULT_LOCAL_TASK, or 0 to
  *     indicate it's not really in the menu (used for the home page item).
  *   If $new_trail is supplied, the value is saved in a static variable and
  *   returned. If $new_trail is not supplied, and there is a saved value from
@@ -1892,13 +1894,14 @@ function _menu_delete_item($item, $force = FALSE) {
  * @param $item
  *   An array representing a menu link item. The only mandatory keys are
  *   link_path and link_title. Possible keys are:
- *   - menu_name   default is navigation
- *   - weight      default is 0
- *   - expanded    whether the item is expanded.
- *   - options     An array of options, @see l for more.
- *   - mlid        Set to an existing value, or 0 or NULL to insert a new link.
- *   - plid        The mlid of the parent.
- *   - router_path The path of the relevant router item.
+ *   - menu_name: Default is navigation.
+ *   - weight: Default is 0.
+ *   - expanded: Whether the item is expanded.
+ *   - options: An array of options, see l() for more.
+ *   - mlid: Set to an existing value, or 0 or NULL to insert a new link.
+ *   - plid: The mlid of the parent.
+ *   - router_path: The path of the relevant router item.
+ *
  * @return
  *   The mlid of the saved menu link, or FALSE if the menu link could not be 
  *   saved.
@@ -2443,6 +2446,7 @@ function _menu_router_build($callbacks) {
       'file' => '',
       'file path' => '',
       'include file' => '',
+      'module' => '',
     );
 
     // Calculate out the file to be included for each callback, if any.
diff --git a/includes/module.inc b/includes/module.inc
index 06b9d40..bc4fbea 100644
--- a/includes/module.inc
+++ b/includes/module.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: module.inc,v 1.115.2.3 2009/11/16 17:17:35 goba Exp $
 
 /**
  * @file
diff --git a/includes/pager.inc b/includes/pager.inc
index f0eaea4..0e17caf 100644
--- a/includes/pager.inc
+++ b/includes/pager.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: pager.inc,v 1.63.2.1 2009/07/01 20:51:55 goba Exp $
 
 /**
  * @file
@@ -227,10 +226,11 @@ function theme_pager($tags = array(), $limit = 10, $element = 0, $parameters = a
 
 
 /**
- * @name Pager pieces
+ * @defgroup pagerpieces Pager pieces
  * @{
- * Use these pieces to construct your own custom pagers in your theme. Note that
- * you should NOT modify this file to customize your pager.
+ * Theme functions for customizing pager elements.
+ *
+ * Note that you should NOT modify this file to customize your pager.
  */
 
 /**
diff --git a/includes/path.inc b/includes/path.inc
index 499f47d..c4afe04 100644
--- a/includes/path.inc
+++ b/includes/path.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: path.inc,v 1.19.2.4 2010/05/28 15:12:04 goba Exp $
 
 /**
  * @file
@@ -119,7 +118,7 @@ function _drupal_lookup_path_direct($action, $path = '', $path_language = '') {
     // isn't a path that has this alias
     elseif ($action == 'source' && !isset($no_src[$path_language][$path])) {
       // Look for the value $path within the cached $map
-      $src = '';
+      $src = FALSE;
       if (!isset($map[$path_language]) || !($src = array_search($path, $map[$path_language]))) {
         // Get the most fitting result falling back with alias without language
         if ($src = db_result(db_query("SELECT src FROM {url_alias} WHERE dst = '%s' AND language IN('%s', '') ORDER BY language DESC, pid DESC", $path, $path_language))) {
@@ -197,10 +196,13 @@ function drupal_get_normal_path($path, $path_language = '') {
  * @param $index
  *   The index of the component, where each component is separated by a '/'
  *   (forward-slash), and where the first component has an index of 0 (zero).
+ * @param $path
+ *   A path to break into components. Defaults to the path of the current page.
  *
  * @return
  *   The component specified by $index, or NULL if the specified component was
- *   not found.
+ *   not found. If called without arguments, it returns an array containing all
+ *   the components of the current path.
  */
 function arg($index = NULL, $path = NULL) {
   static $arguments;
diff --git a/includes/session.inc b/includes/session.inc
index a94251d..09e6439 100644
--- a/includes/session.inc
+++ b/includes/session.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: session.inc,v 1.44.2.7 2010/03/04 00:15:28 goba Exp $
 
 /**
  * @file
diff --git a/includes/tablesort.inc b/includes/tablesort.inc
index e43176c..3d9fb43 100644
--- a/includes/tablesort.inc
+++ b/includes/tablesort.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: tablesort.inc,v 1.47.2.1 2009/07/01 20:51:55 goba Exp $
 
 /**
  * @file
diff --git a/includes/theme.inc b/includes/theme.inc
index 5b20747..5928f9f 100644
--- a/includes/theme.inc
+++ b/includes/theme.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: theme.inc,v 1.415.2.27 2010/03/01 10:02:01 goba Exp $
 
 /**
  * @file
@@ -12,14 +11,27 @@
  */
 
 /**
- * @name Content markers
+ * @defgroup content_flags Content markers
  * @{
  * Markers used by theme_mark() and node_mark() to designate content.
  * @see theme_mark(), node_mark()
  */
-define('MARK_READ',    0);
-define('MARK_NEW',     1);
+
+/**
+ * Mark content as read.
+ */
+define('MARK_READ', 0);
+
+/**
+ * Mark content as being new.
+ */
+define('MARK_NEW', 1);
+
+/**
+ * Mark content as being updated.
+ */
 define('MARK_UPDATED', 2);
+
 /**
  * @} End of "Content markers".
  */
@@ -1244,6 +1256,7 @@ function theme_links($links, $attributes = array('class' => 'links')) {
  *
  * @param $path
  *   Either the path of the image file (relative to base_path()) or a full URL.
+ *   If this is a full URL, $getsize must be set to FALSE or nothing will be returned.
  * @param $alt
  *   The alternative text for text-based browsers.
  * @param $title
@@ -1252,6 +1265,8 @@ function theme_links($links, $attributes = array('class' => 'links')) {
  *   Associative array of attributes to be placed in the img tag.
  * @param $getsize
  *   If set to TRUE, the image's dimension are fetched and added as width/height attributes.
+ *   Defaults to TRUE. Must be set to FALSE if $path is a full URL.
+ * 
  * @return
  *   A string containing the image tag.
  */
diff --git a/includes/theme.maintenance.inc b/includes/theme.maintenance.inc
index da09835..2725057 100644
--- a/includes/theme.maintenance.inc
+++ b/includes/theme.maintenance.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: theme.maintenance.inc,v 1.10.2.2 2010/03/04 00:15:28 goba Exp $
 
 /**
  * @file
diff --git a/includes/unicode.entities.inc b/includes/unicode.entities.inc
new file mode 100644
index 0000000..486fd97
--- /dev/null
+++ b/includes/unicode.entities.inc
@@ -0,0 +1,266 @@
+<?php
+// $Id $
+
+/**
+ * @file
+ * (X)HTML entities, as defined in HTML 4.01.
+ *
+ * @see http://www.w3.org/TR/html401/sgml/entities.html
+ */
+
+$html_entities = array(
+  '&Aacute;' => '',
+  '&aacute;' => '',
+  '&Acirc;' => '',
+  '&acirc;' => '',
+  '&acute;' => '',
+  '&AElig;' => '',
+  '&aelig;' => '',
+  '&Agrave;' => '',
+  '&agrave;' => '',
+  '&alefsym;' => '',
+  '&Alpha;' => '',
+  '&alpha;' => '',
+  '&amp;' => '&',
+  '&and;' => '',
+  '&ang;' => '',
+  '&Aring;' => '',
+  '&aring;' => '',
+  '&asymp;' => '',
+  '&Atilde;' => '',
+  '&atilde;' => '',
+  '&Auml;' => '',
+  '&auml;' => '',
+  '&bdquo;' => '',
+  '&Beta;' => '',
+  '&beta;' => '',
+  '&brvbar;' => '',
+  '&bull;' => '',
+  '&cap;' => '',
+  '&Ccedil;' => '',
+  '&ccedil;' => '',
+  '&cedil;' => '',
+  '&cent;' => '',
+  '&Chi;' => '',
+  '&chi;' => '',
+  '&circ;' => '',
+  '&clubs;' => '',
+  '&cong;' => '',
+  '&copy;' => '',
+  '&crarr;' => '',
+  '&cup;' => '',
+  '&curren;' => '',
+  '&dagger;' => '',
+  '&Dagger;' => '',
+  '&darr;' => '',
+  '&dArr;' => '',
+  '&deg;' => '',
+  '&Delta;' => '',
+  '&delta;' => '',
+  '&diams;' => '',
+  '&divide;' => '',
+  '&Eacute;' => '',
+  '&eacute;' => '',
+  '&Ecirc;' => '',
+  '&ecirc;' => '',
+  '&Egrave;' => '',
+  '&egrave;' => '',
+  '&empty;' => '',
+  '&emsp;' => '',
+  '&ensp;' => '',
+  '&Epsilon;' => '',
+  '&epsilon;' => '',
+  '&equiv;' => '',
+  '&Eta;' => '',
+  '&eta;' => '',
+  '&ETH;' => '',
+  '&eth;' => '',
+  '&Euml;' => '',
+  '&euml;' => '',
+  '&euro;' => '',
+  '&exist;' => '',
+  '&fnof;' => '',
+  '&forall;' => '',
+  '&frac12;' => '',
+  '&frac14;' => '',
+  '&frac34;' => '',
+  '&frasl;' => '',
+  '&Gamma;' => '',
+  '&gamma;' => '',
+  '&ge;' => '',
+  '&harr;' => '',
+  '&hArr;' => '',
+  '&hearts;' => '',
+  '&hellip;' => '',
+  '&Iacute;' => '',
+  '&iacute;' => '',
+  '&Icirc;' => '',
+  '&icirc;' => '',
+  '&iexcl;' => '',
+  '&Igrave;' => '',
+  '&igrave;' => '',
+  '&image;' => '',
+  '&infin;' => '',
+  '&int;' => '',
+  '&Iota;' => '',
+  '&iota;' => '',
+  '&iquest;' => '',
+  '&isin;' => '',
+  '&Iuml;' => '',
+  '&iuml;' => '',
+  '&Kappa;' => '',
+  '&kappa;' => '',
+  '&Lambda;' => '',
+  '&lambda;' => '',
+  '&lang;' => '',
+  '&laquo;' => '',
+  '&larr;' => '',
+  '&lArr;' => '',
+  '&lceil;' => '',
+  '&ldquo;' => '',
+  '&le;' => '',
+  '&lfloor;' => '',
+  '&lowast;' => '',
+  '&loz;' => '',
+  '&lrm;' => '',
+  '&lsaquo;' => '',
+  '&lsquo;' => '',
+  '&macr;' => '',
+  '&mdash;' => '',
+  '&micro;' => '',
+  '&middot;' => '',
+  '&minus;' => '',
+  '&Mu;' => '',
+  '&mu;' => '',
+  '&nabla;' => '',
+  '&nbsp;' => '',
+  '&ndash;' => '',
+  '&ne;' => '',
+  '&ni;' => '',
+  '&not;' => '',
+  '&notin;' => '',
+  '&nsub;' => '',
+  '&Ntilde;' => '',
+  '&ntilde;' => '',
+  '&Nu;' => '',
+  '&nu;' => '',
+  '&Oacute;' => '',
+  '&oacute;' => '',
+  '&Ocirc;' => '',
+  '&ocirc;' => '',
+  '&OElig;' => '',
+  '&oelig;' => '',
+  '&Ograve;' => '',
+  '&ograve;' => '',
+  '&oline;' => '',
+  '&Omega;' => '',
+  '&omega;' => '',
+  '&Omicron;' => '',
+  '&omicron;' => '',
+  '&oplus;' => '',
+  '&or;' => '',
+  '&ordf;' => '',
+  '&ordm;' => '',
+  '&Oslash;' => '',
+  '&oslash;' => '',
+  '&Otilde;' => '',
+  '&otilde;' => '',
+  '&otimes;' => '',
+  '&Ouml;' => '',
+  '&ouml;' => '',
+  '&para;' => '',
+  '&part;' => '',
+  '&permil;' => '',
+  '&perp;' => '',
+  '&Phi;' => '',
+  '&phi;' => '',
+  '&Pi;' => '',
+  '&pi;' => '',
+  '&piv;' => '',
+  '&plusmn;' => '',
+  '&pound;' => '',
+  '&prime;' => '',
+  '&Prime;' => '',
+  '&prod;' => '',
+  '&prop;' => '',
+  '&Psi;' => '',
+  '&psi;' => '',
+  '&radic;' => '',
+  '&rang;' => '',
+  '&raquo;' => '',
+  '&rarr;' => '',
+  '&rArr;' => '',
+  '&rceil;' => '',
+  '&rdquo;' => '',
+  '&real;' => '',
+  '&reg;' => '',
+  '&rfloor;' => '',
+  '&Rho;' => '',
+  '&rho;' => '',
+  '&rlm;' => '',
+  '&rsaquo;' => '',
+  '&rsquo;' => '',
+  '&sbquo;' => '',
+  '&Scaron;' => '',
+  '&scaron;' => '',
+  '&sdot;' => '',
+  '&sect;' => '',
+  '&shy;' => '',
+  '&Sigma;' => '',
+  '&sigma;' => '',
+  '&sigmaf;' => '',
+  '&sim;' => '',
+  '&spades;' => '',
+  '&sub;' => '',
+  '&sube;' => '',
+  '&sum;' => '',
+  '&sup1;' => '',
+  '&sup2;' => '',
+  '&sup3;' => '',
+  '&sup;' => '',
+  '&supe;' => '',
+  '&szlig;' => '',
+  '&Tau;' => '',
+  '&tau;' => '',
+  '&there4;' => '',
+  '&Theta;' => '',
+  '&theta;' => '',
+  '&thetasym;' => '',
+  '&thinsp;' => '',
+  '&THORN;' => '',
+  '&thorn;' => '',
+  '&tilde;' => '',
+  '&times;' => '',
+  '&trade;' => '',
+  '&Uacute;' => '',
+  '&uacute;' => '',
+  '&uarr;' => '',
+  '&uArr;' => '',
+  '&Ucirc;' => '',
+  '&ucirc;' => '',
+  '&Ugrave;' => '',
+  '&ugrave;' => '',
+  '&uml;' => '',
+  '&upsih;' => '',
+  '&Upsilon;' => '',
+  '&upsilon;' => '',
+  '&Uuml;' => '',
+  '&uuml;' => '',
+  '&weierp;' => '',
+  '&Xi;' => '',
+  '&xi;' => '',
+  '&Yacute;' => '',
+  '&yacute;' => '',
+  '&yen;' => '',
+  '&yuml;' => '',
+  '&Yuml;' => '',
+  '&Zeta;' => '',
+  '&zeta;' => '',
+  '&zwj;' => '',
+  '&zwnj;' => '',
+  '&gt;' => '>',
+  '&lt;' => '<',
+  '&quot;' => '"',
+  // Add apostrophe (XML).
+  '&apos;' => "'",
+);
diff --git a/includes/unicode.inc b/includes/unicode.inc
index f60eb42..228981b 100644
--- a/includes/unicode.inc
+++ b/includes/unicode.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: unicode.inc,v 1.29.2.1 2010/06/30 09:04:38 goba Exp $
 
 /**
  * Indicates an error during check for PHP unicode support.
@@ -335,30 +334,30 @@ function _mime_header_decode($matches) {
  *   The input $text, with all HTML entities decoded once.
  */
 function decode_entities($text, $exclude = array()) {
-  static $table;
-  // We store named entities in a table for quick processing.
-  if (!isset($table)) {
-    // Get all named HTML entities.
-    $table = array_flip(get_html_translation_table(HTML_ENTITIES));
-    // PHP gives us ISO-8859-1 data, we need UTF-8.
-    $table = array_map('utf8_encode', $table);
-    // Add apostrophe (XML)
-    $table['&apos;'] = "'";
-  }
-  $newtable = array_diff($table, $exclude);
-
-  // Use a regexp to select all entities in one pass, to avoid decoding double-escaped entities twice.
-  return preg_replace('/&(#x?)?([A-Za-z0-9]+);/e', '_decode_entities("$1", "$2", "$0", $newtable, $exclude)', $text);
+  static $html_entities;
+  if (!isset($html_entities)) {
+    include_once './includes/unicode.entities.inc';
+  }
+
+  // Flip the exclude list so that we can do quick lookups later.
+  $exclude = array_flip($exclude);
+
+  // Use a regexp to select all entities in one pass, to avoid decoding 
+  // double-escaped entities twice. The PREG_REPLACE_EVAL modifier 'e' is
+  // being used to allow for a callback (see 
+  // http://php.net/manual/en/reference.pcre.pattern.modifiers).
+  return preg_replace('/&(#x?)?([A-Za-z0-9]+);/e', '_decode_entities("$1", "$2", "$0", $html_entities, $exclude)', $text);
 }
 
 /**
  * Helper function for decode_entities
  */
-function _decode_entities($prefix, $codepoint, $original, &$table, &$exclude) {
+function _decode_entities($prefix, $codepoint, $original, &$html_entities, &$exclude) {
   // Named entity
   if (!$prefix) {
-    if (isset($table[$original])) {
-      return $table[$original];
+    // A named entity not in the exclude list.
+    if (isset($html_entities[$original]) && !isset($exclude[$html_entities[$original]])) {
+      return $html_entities[$original];
     }
     else {
       return $original;
@@ -392,7 +391,7 @@ function _decode_entities($prefix, $codepoint, $original, &$table, &$exclude) {
          . chr(0x80 | ( $codepoint        & 0x3F));
   }
   // Check for excluded characters
-  if (in_array($str, $exclude)) {
+  if (isset($exclude[$str])) {
     return $original;
   }
   else {
diff --git a/includes/xmlrpc.inc b/includes/xmlrpc.inc
index 46b3ca5..13ebf09 100644
--- a/includes/xmlrpc.inc
+++ b/includes/xmlrpc.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: xmlrpc.inc,v 1.47.2.6 2010/06/02 12:22:02 goba Exp $
 
 /**
  * @file
diff --git a/includes/xmlrpcs.inc b/includes/xmlrpcs.inc
index 45304f6..049a92b 100644
--- a/includes/xmlrpcs.inc
+++ b/includes/xmlrpcs.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: xmlrpcs.inc,v 1.24.2.4 2010/06/02 12:52:07 goba Exp $
 
 /**
  * The main entry point for XML-RPC requests.
diff --git a/index.php b/index.php
index 6e66713..cc50460 100644
--- a/index.php
+++ b/index.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: index.php,v 1.94 2007/12/26 08:46:48 dries Exp $
 
 /**
  * @file
diff --git a/install.php b/install.php
index 5570fab..68b3540 100644
--- a/install.php
+++ b/install.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: install.php,v 1.113.2.12 2010/05/09 14:13:31 dries Exp $
 
 require_once './includes/install.inc';
 
@@ -537,7 +536,7 @@ function install_select_locale($profilename) {
       drupal_set_title(st('Choose language'));
       if (!empty($_GET['localize'])) {
         $output = '<p>'. st('With the addition of an appropriate translation package, this installer is capable of proceeding in another language of your choice. To install and use Drupal in a language other than English:') .'</p>';
-        $output .= '<ul><li>'. st('Determine if <a href="@translations" target="_blank">a translation of this Drupal version</a> is available in your language of choice. A translation is provided via a translation package; each translation package enables the display of a specific version of Drupal in a specific language. Not all languages are available for every version of Drupal.', array('@translations' => 'http://drupal.org/project/translations')) .'</li>';
+        $output .= '<ul><li>'. st('Determine if <a href="@translations" target="_blank">a translation of this Drupal version</a> is available in your language of choice. A translation is provided via a translation package; each translation package enables the display of a specific version of Drupal in a specific language. Not all languages are available for every version of Drupal.', array('@translations' => 'http://localize.drupal.org')) .'</li>';
         $output .= '<li>'. st('If an alternative translation package of your choice is available, download and extract its contents to your Drupal root directory.') .'</li>';
         $output .= '<li>'. st('Return to choose language using the second link below and select your desired language from the displayed list. Reloading the page allows the list to automatically adjust to the presence of new translation packages.') .'</li>';
         $output .= '</ul><p>'. st('Alternatively, to install and use Drupal in English, or to defer the selection of an alternative language until after installation, select the first link below.') .'</p>';
diff --git a/misc/ahah.js b/misc/ahah.js
index 4a895a8..118c4de 100644
--- a/misc/ahah.js
+++ b/misc/ahah.js
@@ -1,4 +1,3 @@
-// $Id: ahah.js,v 1.7.2.1 2008/02/11 14:46:27 goba Exp $
 
 /**
  * Provides AJAX-like page updating via AHAH (Asynchronous HTML and HTTP).
diff --git a/misc/autocomplete.js b/misc/autocomplete.js
index 86b6a31..8d0dcbe 100644
--- a/misc/autocomplete.js
+++ b/misc/autocomplete.js
@@ -1,4 +1,3 @@
-// $Id: autocomplete.js,v 1.23 2008/01/04 11:53:21 goba Exp $
 
 /**
  * Attaches the autocomplete behavior to all required fields
diff --git a/misc/batch.js b/misc/batch.js
index 9031a04..fe01554 100644
--- a/misc/batch.js
+++ b/misc/batch.js
@@ -1,4 +1,3 @@
-// $Id: batch.js,v 1.4 2007/10/21 18:59:01 goba Exp $
 
 /**
  * Attaches the batch behavior to progress bars.
diff --git a/misc/collapse.js b/misc/collapse.js
index 590a876..9581db9 100644
--- a/misc/collapse.js
+++ b/misc/collapse.js
@@ -1,4 +1,3 @@
-// $Id: collapse.js,v 1.17 2008/01/29 10:58:25 goba Exp $
 
 /**
  * Toggle the visibility of a fieldset using smooth animations
diff --git a/misc/drupal.js b/misc/drupal.js
index 07615a0..035da0c 100644
--- a/misc/drupal.js
+++ b/misc/drupal.js
@@ -1,4 +1,3 @@
-// $Id: drupal.js,v 1.41.2.4 2009/07/21 08:59:10 goba Exp $
 
 var Drupal = Drupal || { 'settings': {}, 'behaviors': {}, 'themes': {}, 'locale': {} };
 
diff --git a/misc/farbtastic/farbtastic.css b/misc/farbtastic/farbtastic.css
index cf86792..6942070 100644
--- a/misc/farbtastic/farbtastic.css
+++ b/misc/farbtastic/farbtastic.css
@@ -1,4 +1,3 @@
-/* $Id: farbtastic.css,v 1.3 2007/04/13 07:33:23 dries Exp $ */
 
 .farbtastic {
   position: relative;
diff --git a/misc/farbtastic/farbtastic.js b/misc/farbtastic/farbtastic.js
index 0093b16..0094a72 100644
--- a/misc/farbtastic/farbtastic.js
+++ b/misc/farbtastic/farbtastic.js
@@ -1,4 +1,3 @@
-// $Id: farbtastic.js,v 1.4.2.1 2008/06/25 09:34:17 goba Exp $
 // Farbtastic 1.2
 
 jQuery.fn.farbtastic = function (callback) {
diff --git a/misc/farbtastic/marker.png b/misc/farbtastic/marker.png
old mode 100755
new mode 100644
diff --git a/misc/form.js b/misc/form.js
index fa0eb4a..3b0bb9c 100644
--- a/misc/form.js
+++ b/misc/form.js
@@ -1,4 +1,3 @@
-// $Id: form.js,v 1.1 2007/09/12 18:29:32 goba Exp $
 
 Drupal.behaviors.multiselectSelector = function() {
   // Automatically selects the right radio button in a multiselect control.
diff --git a/misc/jquery.form.js b/misc/jquery.form.js
index 51225ea..9e956e3 100644
--- a/misc/jquery.form.js
+++ b/misc/jquery.form.js
@@ -1,4 +1,3 @@
-// $Id: jquery.form.js,v 1.2 2007/11/19 10:05:48 goba Exp $
 
 /*
  * jQuery Form Plugin
diff --git a/misc/jquery.js b/misc/jquery.js
index 4c38852..01aa089 100644
--- a/misc/jquery.js
+++ b/misc/jquery.js
@@ -1,4 +1,3 @@
-// $Id: jquery.js,v 1.12.2.3 2008/06/25 09:38:39 goba Exp $ 
 
 /*
  * jQuery 1.2.6 - New Wave Javascript
diff --git a/misc/print-rtl.css b/misc/print-rtl.css
index ceae596..f99287a 100644
--- a/misc/print-rtl.css
+++ b/misc/print-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: print-rtl.css,v 1.1 2007/06/10 08:55:55 goba Exp $ */
 
 body {
   direction: rtl;
diff --git a/misc/print.css b/misc/print.css
index c2c22cd..0a56ef1 100644
--- a/misc/print.css
+++ b/misc/print.css
@@ -1,4 +1,3 @@
-/* $Id: print.css,v 1.6 2007/06/10 08:55:55 goba Exp $ */
 
 body {
   margin: 1em;
diff --git a/misc/progress.js b/misc/progress.js
index 27c67d0..b588948 100644
--- a/misc/progress.js
+++ b/misc/progress.js
@@ -1,4 +1,3 @@
-// $Id: progress.js,v 1.20 2008/01/04 11:53:21 goba Exp $
 
 /**
  * A progressbar object. Initialized with the given id. Must be inserted into
diff --git a/misc/tabledrag.js b/misc/tabledrag.js
index 3be8f67..9916821 100644
--- a/misc/tabledrag.js
+++ b/misc/tabledrag.js
@@ -1,4 +1,3 @@
-// $Id: tabledrag.js,v 1.13.2.5 2009/06/18 12:24:24 goba Exp $
 
 /**
  * Drag and drop table rows with field manipulation.
diff --git a/misc/tableheader.js b/misc/tableheader.js
index f572e29..9d05e23 100644
--- a/misc/tableheader.js
+++ b/misc/tableheader.js
@@ -1,4 +1,3 @@
-// $Id: tableheader.js,v 1.16.2.2 2009/03/30 12:48:09 goba Exp $
 
 Drupal.tableHeaderDoScroll = function() {
   if (typeof(Drupal.tableHeaderOnScroll)=='function') {
diff --git a/misc/tableselect.js b/misc/tableselect.js
index c2f5bcd..d085a9b 100644
--- a/misc/tableselect.js
+++ b/misc/tableselect.js
@@ -1,4 +1,3 @@
-// $Id: tableselect.js,v 1.8 2007/11/19 12:15:16 goba Exp $
 
 Drupal.behaviors.tableSelect = function (context) {
   $('form table:has(th.select-all):not(.tableSelect-processed)', context).each(Drupal.tableSelect);
diff --git a/misc/teaser.js b/misc/teaser.js
index a976510..da1acfb 100644
--- a/misc/teaser.js
+++ b/misc/teaser.js
@@ -1,4 +1,3 @@
-// $Id: teaser.js,v 1.12.2.2 2010/03/01 10:13:18 goba Exp $
 
 /**
  * Auto-attach for teaser behavior.
diff --git a/misc/textarea.js b/misc/textarea.js
index e29dfe0..067586b 100644
--- a/misc/textarea.js
+++ b/misc/textarea.js
@@ -1,4 +1,3 @@
-// $Id: textarea.js,v 1.22 2008/01/17 19:31:56 goba Exp $
 
 Drupal.behaviors.textarea = function(context) {
   $('textarea.resizable:not(.textarea-processed)', context).each(function() {
diff --git a/modules/aggregator/aggregator-feed-source.tpl.php b/modules/aggregator/aggregator-feed-source.tpl.php
index c91279b..5863fd2 100644
--- a/modules/aggregator/aggregator-feed-source.tpl.php
+++ b/modules/aggregator/aggregator-feed-source.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: aggregator-feed-source.tpl.php,v 1.1 2007/09/13 08:02:38 goba Exp $
 
 /**
  * @file aggregator-feed-source.tpl.php
diff --git a/modules/aggregator/aggregator-item.tpl.php b/modules/aggregator/aggregator-item.tpl.php
index cb6de4e..032e034 100644
--- a/modules/aggregator/aggregator-item.tpl.php
+++ b/modules/aggregator/aggregator-item.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: aggregator-item.tpl.php,v 1.1 2007/09/13 08:02:38 goba Exp $
 
 /**
  * @file aggregator-item.tpl.php
diff --git a/modules/aggregator/aggregator-rtl.css b/modules/aggregator/aggregator-rtl.css
index 7de7e65..ea59ca3 100644
--- a/modules/aggregator/aggregator-rtl.css
+++ b/modules/aggregator/aggregator-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: aggregator-rtl.css,v 1.1 2007/05/27 17:57:47 goba Exp $ */
 
 #aggregator .feed-source .feed-icon {
   float: left;
diff --git a/modules/aggregator/aggregator-summary-item.tpl.php b/modules/aggregator/aggregator-summary-item.tpl.php
index 6602ee6..08ba2ab 100644
--- a/modules/aggregator/aggregator-summary-item.tpl.php
+++ b/modules/aggregator/aggregator-summary-item.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: aggregator-summary-item.tpl.php,v 1.1 2007/09/13 08:02:38 goba Exp $
 
 /**
  * @file aggregator-summary-item.tpl.php
diff --git a/modules/aggregator/aggregator-summary-items.tpl.php b/modules/aggregator/aggregator-summary-items.tpl.php
index 1b63db9..43a10d3 100644
--- a/modules/aggregator/aggregator-summary-items.tpl.php
+++ b/modules/aggregator/aggregator-summary-items.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: aggregator-summary-items.tpl.php,v 1.1 2007/09/13 08:02:38 goba Exp $
 
 /**
  * @file aggregator-summary-items.tpl.php
diff --git a/modules/aggregator/aggregator-wrapper.tpl.php b/modules/aggregator/aggregator-wrapper.tpl.php
index a3aefdb..bb8c8b8 100644
--- a/modules/aggregator/aggregator-wrapper.tpl.php
+++ b/modules/aggregator/aggregator-wrapper.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: aggregator-wrapper.tpl.php,v 1.1 2007/09/13 08:02:38 goba Exp $
 
 /**
  * @file comment-wrapper.tpl.php
diff --git a/modules/aggregator/aggregator.admin.inc b/modules/aggregator/aggregator.admin.inc
index 13f309c..221d0ab 100644
--- a/modules/aggregator/aggregator.admin.inc
+++ b/modules/aggregator/aggregator.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: aggregator.admin.inc,v 1.7.2.1 2008/04/25 21:11:57 goba Exp $
 
 /**
  * @file
diff --git a/modules/aggregator/aggregator.css b/modules/aggregator/aggregator.css
index b289271..9d2f4bd 100644
--- a/modules/aggregator/aggregator.css
+++ b/modules/aggregator/aggregator.css
@@ -1,4 +1,3 @@
-/* $Id: aggregator.css,v 1.2 2007/05/27 17:57:47 goba Exp $ */
 
 #aggregator .feed-source .feed-title {
   margin-top: 0;
diff --git a/modules/aggregator/aggregator.info b/modules/aggregator/aggregator.info
index ee13b7f..6deb9da 100644
--- a/modules/aggregator/aggregator.info
+++ b/modules/aggregator/aggregator.info
@@ -1,12 +1,11 @@
-; $Id: aggregator.info,v 1.4 2007/06/08 05:50:53 dries Exp $
 name = Aggregator
 description = "Aggregates syndicated content (RSS, RDF, and Atom feeds)."
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/aggregator/aggregator.install b/modules/aggregator/aggregator.install
index 652a926..2e918ed 100644
--- a/modules/aggregator/aggregator.install
+++ b/modules/aggregator/aggregator.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: aggregator.install,v 1.14.2.2 2009/01/06 15:46:36 goba Exp $
 
 /**
  * Implementation of hook_install().
diff --git a/modules/aggregator/aggregator.module b/modules/aggregator/aggregator.module
index 9ca46d4..e87b579 100644
--- a/modules/aggregator/aggregator.module
+++ b/modules/aggregator/aggregator.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: aggregator.module,v 1.374.2.6 2010/05/28 16:06:59 goba Exp $
 
 /**
  * @file
@@ -783,6 +782,11 @@ function aggregator_parse_feed(&$data, $feed) {
       }
     }
 
+    // Resolve dc:creator tag as the item author if author tag is not set.
+    if (empty($item['AUTHOR']) && !empty($item['DC:CREATOR'])) {
+      $item['AUTHOR'] = $item['DC:CREATOR'];
+    }
+
     // Save this item. Try to avoid duplicate entries as much as possible. If
     // we find a duplicate entry, we resolve it and pass along its ID is such
     // that we can update it if needed.
diff --git a/modules/aggregator/aggregator.pages.inc b/modules/aggregator/aggregator.pages.inc
index 6b32b0e..d3e1634 100644
--- a/modules/aggregator/aggregator.pages.inc
+++ b/modules/aggregator/aggregator.pages.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: aggregator.pages.inc,v 1.12.2.1 2008/08/16 21:13:48 dries Exp $
 
 /**
  * @file
diff --git a/modules/block/block-admin-display-form.tpl.php b/modules/block/block-admin-display-form.tpl.php
index 6a664dd..3862f4d 100644
--- a/modules/block/block-admin-display-form.tpl.php
+++ b/modules/block/block-admin-display-form.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: block-admin-display-form.tpl.php,v 1.3 2008/01/16 22:57:26 goba Exp $
 
 /**
  * @file block-admin-display-form.tpl.php
diff --git a/modules/block/block.admin.inc b/modules/block/block.admin.inc
index c954e7f..3fd8280 100644
--- a/modules/block/block.admin.inc
+++ b/modules/block/block.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: block.admin.inc,v 1.14.2.5 2008/11/24 06:00:02 dries Exp $
 
 /**
  * @file
@@ -386,6 +385,7 @@ function template_preprocess_block_admin_display_form(&$variables) {
       $variables['form'][$i]['region']['#attributes']['class'] = 'block-region-select block-region-'. $region;
       $variables['form'][$i]['weight']['#attributes']['class'] = 'block-weight block-weight-'. $region;
 
+      $variables['block_listing'][$region][$i] = new stdClass();
       $variables['block_listing'][$region][$i]->row_class = isset($block['#attributes']['class']) ? $block['#attributes']['class'] : '';
       $variables['block_listing'][$region][$i]->block_modified = isset($block['#attributes']['class']) && strpos($block['#attributes']['class'], 'block-modified') !== FALSE ? TRUE : FALSE;
       $variables['block_listing'][$region][$i]->block_title =  drupal_render($block['info']);
diff --git a/modules/block/block.css b/modules/block/block.css
index 658db58..5ffcc2d 100644
--- a/modules/block/block.css
+++ b/modules/block/block.css
@@ -1,4 +1,3 @@
-/* $Id: block.css,v 1.6 2007/11/14 09:49:30 dries Exp $ */
 
 #blocks td.region {
   font-weight: bold;
diff --git a/modules/block/block.info b/modules/block/block.info
index 03bf089..4a94c53 100644
--- a/modules/block/block.info
+++ b/modules/block/block.info
@@ -1,12 +1,11 @@
-; $Id: block.info,v 1.4 2007/06/08 05:50:53 dries Exp $
 name = Block
 description = Controls the boxes that are displayed around the main content.
 package = Core - required
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/block/block.install b/modules/block/block.install
index 71616d5..45d6710 100644
--- a/modules/block/block.install
+++ b/modules/block/block.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: block.install,v 1.8.2.2 2009/01/06 15:46:36 goba Exp $
 
 /**
  * Implementation of hook_schema().
diff --git a/modules/block/block.js b/modules/block/block.js
index 0576023..c1b7eb6 100644
--- a/modules/block/block.js
+++ b/modules/block/block.js
@@ -1,4 +1,3 @@
-// $Id: block.js,v 1.2 2007/12/16 10:36:53 goba Exp $
 
 /**
  * Move a block in the blocks table from one region to another via select list.
diff --git a/modules/block/block.module b/modules/block/block.module
index 79720a8..9eecda7 100644
--- a/modules/block/block.module
+++ b/modules/block/block.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: block.module,v 1.299.2.4 2009/10/06 12:13:01 goba Exp $
 
 /**
  * @file
@@ -224,15 +223,22 @@ function block_block($op = 'list', $delta = 0, $edit = array()) {
 /**
  * Update the 'blocks' DB table with the blocks currently exported by modules.
  *
+ * @param $theme
+ *   The theme to rehash blocks for. If not provided, defaults to the currently
+ *   used theme.
+ *
  * @return
  *   Blocks currently exported by modules.
  */
-function _block_rehash() {
+function _block_rehash($theme = NULL) {
   global $theme_key;
 
   init_theme();
+  if (!isset($theme)) {
+    $theme = $theme_key;
+  }
 
-  $result = db_query("SELECT * FROM {blocks} WHERE theme = '%s'", $theme_key);
+  $result = db_query("SELECT * FROM {blocks} WHERE theme = '%s'", $theme);
   $old_blocks = array();
   while ($old_block = db_fetch_array($result)) {
     $old_blocks[$old_block['module']][$old_block['delta']] = $old_block;
@@ -240,7 +246,7 @@ function _block_rehash() {
 
   $blocks = array();
   // Valid region names for the theme.
-  $regions = system_region_list($theme_key);
+  $regions = system_region_list($theme);
 
   foreach (module_list() as $module) {
     $module_blocks = module_invoke($module, 'block', 'list');
@@ -250,7 +256,7 @@ function _block_rehash() {
           // If it's a new block, add identifiers.
           $block['module'] = $module;
           $block['delta']  = $delta;
-          $block['theme']  = $theme_key;
+          $block['theme']  = $theme;
           if (!isset($block['pages'])) {
             // {block}.pages is type 'text', so it cannot have a
             // default value, and not null, so we need to provide
@@ -266,9 +272,13 @@ function _block_rehash() {
         }
         else {
           // If it's an existing block, database settings should overwrite
-          // the code. But aside from 'info' everything that's definable in
-          // code is stored in the database and we do not store 'info', so we
-          // do not need to update the database here.
+          // the code. The only exceptions are 'cache' which is only definable
+          // and updatable in the code, and 'info' which is not stored in
+          // the database.
+          // Update the cache mode only; the other values don't need to change.
+          if (isset($block['cache']) && $block['cache'] != $old_blocks[$module][$delta]['cache']) {
+            db_query("UPDATE {blocks} SET cache = %d WHERE bid = %d", $block['cache'], $old_blocks[$module][$delta]['bid']);
+          }
           // Add 'info' to this block.
           $old_blocks[$module][$delta]['info'] = $block['info'];
           // If the region name does not exist, disable the block and assign it to none.
@@ -292,13 +302,26 @@ function _block_rehash() {
   // Remove blocks that are no longer defined by the code from the database.
   foreach ($old_blocks as $module => $old_module_blocks) {
     foreach ($old_module_blocks as $delta => $block) {
-      db_query("DELETE FROM {blocks} WHERE module = '%s' AND delta = '%s' AND theme = '%s'", $module, $delta, $theme_key);
+      db_query("DELETE FROM {blocks} WHERE module = '%s' AND delta = '%s' AND theme = '%s'", $module, $delta, $theme);
     }
   }
   return $blocks;
 }
 
 /**
+ * Implementation of hook_flush_caches().
+ */
+function block_flush_caches() {
+  // Rehash blocks for active themes. We don't use list_themes() here,
+  // because if MAINTENANCE_MODE is defined it skips reading the database,
+  // and we can't tell which themes are active.
+  $result = db_query("SELECT name FROM {system} WHERE type = 'theme' AND status = 1");
+  while ($theme = db_result($result)) {
+    _block_rehash($theme);
+  }
+}
+
+/**
  * Returns information from database about a user-created (custom) block.
  *
  * @param $bid
diff --git a/modules/blog/blog.info b/modules/blog/blog.info
index 7902560..c453dbb 100644
--- a/modules/blog/blog.info
+++ b/modules/blog/blog.info
@@ -1,12 +1,11 @@
-; $Id: blog.info,v 1.5 2007/06/08 05:50:53 dries Exp $
 name = Blog
 description = Enables keeping easily and regularly updated user web pages or blogs.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/blog/blog.module b/modules/blog/blog.module
index 6e7d998..4a9788c 100644
--- a/modules/blog/blog.module
+++ b/modules/blog/blog.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: blog.module,v 1.297.2.4 2009/02/25 12:21:53 goba Exp $
 
 /**
  * @file
diff --git a/modules/blog/blog.pages.inc b/modules/blog/blog.pages.inc
index d03fde8..d04ba8f 100644
--- a/modules/blog/blog.pages.inc
+++ b/modules/blog/blog.pages.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: blog.pages.inc,v 1.6.2.3 2009/09/14 15:08:00 goba Exp $
 
 /**
  * @file
diff --git a/modules/blogapi/blogapi.info b/modules/blogapi/blogapi.info
index c8526f3..1197eac 100644
--- a/modules/blogapi/blogapi.info
+++ b/modules/blogapi/blogapi.info
@@ -1,12 +1,11 @@
-; $Id: blogapi.info,v 1.4 2007/06/08 05:50:53 dries Exp $
 name = Blog API
 description = Allows users to post content using applications that support XML-RPC blog APIs.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/blogapi/blogapi.install b/modules/blogapi/blogapi.install
index b2d4f34..bd2f67d 100644
--- a/modules/blogapi/blogapi.install
+++ b/modules/blogapi/blogapi.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: blogapi.install,v 1.1.2.2 2009/01/06 15:46:36 goba Exp $
 
 /**
  * Implementation of hook_install().
diff --git a/modules/blogapi/blogapi.module b/modules/blogapi/blogapi.module
index 6decb19..6781382 100644
--- a/modules/blogapi/blogapi.module
+++ b/modules/blogapi/blogapi.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: blogapi.module,v 1.115.2.5 2008/10/08 20:12:17 goba Exp $
 
 /**
  * @file
diff --git a/modules/book/book-all-books-block.tpl.php b/modules/book/book-all-books-block.tpl.php
index 03f6365..4f8300e 100644
--- a/modules/book/book-all-books-block.tpl.php
+++ b/modules/book/book-all-books-block.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: book-all-books-block.tpl.php,v 1.1 2007/11/04 14:29:09 goba Exp $
 
 /**
  * @file book-all-books-block.tpl.php
diff --git a/modules/book/book-export-html.tpl.php b/modules/book/book-export-html.tpl.php
index 0cb55c0..401c309 100644
--- a/modules/book/book-export-html.tpl.php
+++ b/modules/book/book-export-html.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: book-export-html.tpl.php,v 1.1.2.1 2009/05/13 19:11:04 goba Exp $
 
 /**
  * @file book-export-html.tpl.php
diff --git a/modules/book/book-navigation.tpl.php b/modules/book/book-navigation.tpl.php
index aaf9c8a..9382af6 100644
--- a/modules/book/book-navigation.tpl.php
+++ b/modules/book/book-navigation.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: book-navigation.tpl.php,v 1.1 2007/11/04 14:29:09 goba Exp $
 
 /**
  * @file book-navigation.tpl.php
diff --git a/modules/book/book-node-export-html.tpl.php b/modules/book/book-node-export-html.tpl.php
index 20cb8a2..44cb75f 100644
--- a/modules/book/book-node-export-html.tpl.php
+++ b/modules/book/book-node-export-html.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: book-node-export-html.tpl.php,v 1.1 2007/11/04 14:29:09 goba Exp $
 
 /**
  * @file book-node-export-html.tpl.php
diff --git a/modules/book/book-rtl.css b/modules/book/book-rtl.css
index 45d3aa7..ccac94c 100644
--- a/modules/book/book-rtl.css
+++ b/modules/book/book-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: book-rtl.css,v 1.1 2007/05/27 17:57:48 goba Exp $ */
 
 .book-navigation .page-previous {
   float: right;
diff --git a/modules/book/book.admin.inc b/modules/book/book.admin.inc
index 1f0b662..84cbe13 100644
--- a/modules/book/book.admin.inc
+++ b/modules/book/book.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: book.admin.inc,v 1.8.2.3 2008/10/22 19:26:01 goba Exp $
 
 /**
  * @file
diff --git a/modules/book/book.css b/modules/book/book.css
index 2ee4990..3b687b8 100644
--- a/modules/book/book.css
+++ b/modules/book/book.css
@@ -1,4 +1,3 @@
-/* $Id: book.css,v 1.6 2007/11/26 16:19:37 dries Exp $ */
 
 .book-navigation .menu {
   border-top: 1px solid #888;
diff --git a/modules/book/book.info b/modules/book/book.info
index a7daa74..bce254b 100644
--- a/modules/book/book.info
+++ b/modules/book/book.info
@@ -1,12 +1,11 @@
-; $Id: book.info,v 1.5 2007/07/30 18:20:21 dries Exp $
 name = Book
 description = Allows users to structure site pages in a hierarchy or outline.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/book/book.install b/modules/book/book.install
index ab92c7d..e3172f8 100644
--- a/modules/book/book.install
+++ b/modules/book/book.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: book.install,v 1.20.2.1 2009/01/06 15:46:36 goba Exp $
 
 /**
  * Implementation of hook_install().
diff --git a/modules/book/book.module b/modules/book/book.module
index 9389b2f..966330b 100644
--- a/modules/book/book.module
+++ b/modules/book/book.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: book.module,v 1.454.2.6 2009/02/25 11:47:37 goba Exp $
 
 /**
  * @file
diff --git a/modules/book/book.pages.inc b/modules/book/book.pages.inc
index 35c7fdd..46eb86a 100644
--- a/modules/book/book.pages.inc
+++ b/modules/book/book.pages.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: book.pages.inc,v 1.5.2.2 2010/08/06 11:00:49 goba Exp $
 
 /**
  * @file
@@ -78,8 +77,11 @@ function book_export_html($nid) {
     if (isset($node->book)) {
       $tree = book_menu_subtree_data($node->book);
       $contents = book_export_traverse($tree, 'book_node_export');
+      return theme('book_export_html', $node->title, $contents, $node->book['depth']);
+    }
+    else {
+      drupal_not_found();
     }
-    return theme('book_export_html', $node->title, $contents, $node->book['depth']);
   }
   else {
     drupal_access_denied();
diff --git a/modules/color/color-rtl.css b/modules/color/color-rtl.css
index cf5c442..319a634 100644
--- a/modules/color/color-rtl.css
+++ b/modules/color/color-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: color-rtl.css,v 1.2 2007/11/27 12:09:25 goba Exp $ */
 
 #placeholder {
   left: 0;
diff --git a/modules/color/color.css b/modules/color/color.css
index 745e7d4..441961f 100644
--- a/modules/color/color.css
+++ b/modules/color/color.css
@@ -1,4 +1,3 @@
-/* $Id: color.css,v 1.4 2007/05/27 17:57:48 goba Exp $ */
 
 /* Farbtastic placement */
 .color-form {
diff --git a/modules/color/color.info b/modules/color/color.info
index 862140c..dc62a80 100644
--- a/modules/color/color.info
+++ b/modules/color/color.info
@@ -1,12 +1,11 @@
-; $Id: color.info,v 1.3 2007/06/08 05:50:54 dries Exp $
 name = Color
 description = Allows the user to change the color scheme of certain themes.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/color/color.install b/modules/color/color.install
index 97e3537..33b1f41 100644
--- a/modules/color/color.install
+++ b/modules/color/color.install
@@ -1,5 +1,4 @@
 <?php
-/* $Id: color.install,v 1.2 2006/12/05 05:49:50 dries Exp $ */
 
 function color_requirements($phase) {
   $requirements = array();
@@ -33,3 +32,20 @@ function color_requirements($phase) {
 
   return $requirements;
 }
+
+/**
+ * Warn site administrator if unsafe CSS color codes are found in the database.
+ */
+function color_update_6001() {
+  $ret = array();
+  $result = db_query("SELECT name FROM {variable} WHERE name LIKE 'color_%_palette'");
+  while ($variable = db_fetch_array($result)) {
+    $palette = variable_get($variable['name'], array());
+    foreach ($palette as $key => $color) {
+      if (!preg_match('/^#([a-f0-9]{3}){1,2}$/iD', $color)) {
+        drupal_set_message('Some of the custom CSS color codes specified via the color module are invalid. Please examine the themes which are making use of the color module at the <a href="'. url('admin/appearance/settings') .'">Appearance settings</a> page to verify their CSS color values.', 'warning');
+      }
+    }
+  }
+  return $ret;
+}
diff --git a/modules/color/color.js b/modules/color/color.js
index 4211409..e024cf5 100644
--- a/modules/color/color.js
+++ b/modules/color/color.js
@@ -1,4 +1,3 @@
-// $Id: color.js,v 1.6 2007/09/12 18:29:32 goba Exp $
 
 Drupal.behaviors.color = function (context) {
   // This behavior attaches by ID, so is only valid once on a page.
diff --git a/modules/color/color.module b/modules/color/color.module
index 993b5d0..63fad7a 100644
--- a/modules/color/color.module
+++ b/modules/color/color.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: color.module,v 1.39.2.2 2009/05/16 16:09:21 dries Exp $
 
 /**
  * Implementation of hook_help().
@@ -46,6 +45,7 @@ function color_form_alter(&$form, $form_state, $form_id) {
         '#theme' => 'color_scheme_form',
       );
       $form['color'] += color_scheme_form($form_state, arg(4));
+      $form['#validate'][] = 'color_scheme_form_validate';
       $form['#submit'][] = 'color_scheme_form_submit';
     }
   }
@@ -237,6 +237,18 @@ function theme_color_scheme_form($form) {
 }
 
 /**
+ * Validation handler for color change form.
+ */
+function color_scheme_form_validate($form, &$form_state) {
+  // Only accept hexadecimal CSS color strings to avoid XSS upon use.
+  foreach ($form_state['values']['palette'] as $key => $color) {
+    if (!preg_match('/^#([a-f0-9]{3}){1,2}$/iD', $color)) {
+      form_set_error('palette][' . $key, t('%name must be a valid hexadecimal CSS color value.', array('%name' => $form['color']['palette'][$key]['#title'])));
+    }
+  }
+}
+
+/**
  * Submit handler for color change form.
  */
 function color_scheme_form_submit($form, &$form_state) {
diff --git a/modules/comment/comment-folded.tpl.php b/modules/comment/comment-folded.tpl.php
index ac14878..97f54e3 100644
--- a/modules/comment/comment-folded.tpl.php
+++ b/modules/comment/comment-folded.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: comment-folded.tpl.php,v 1.2 2007/08/07 08:39:35 goba Exp $
 
 /**
  * @file comment-folded.tpl.php
diff --git a/modules/comment/comment-rtl.css b/modules/comment/comment-rtl.css
index c40a859..39c3929 100644
--- a/modules/comment/comment-rtl.css
+++ b/modules/comment/comment-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: comment-rtl.css,v 1.2 2007/11/27 12:09:25 goba Exp $ */
 
 .indented {
   margin-left: 0;
diff --git a/modules/comment/comment-wrapper.tpl.php b/modules/comment/comment-wrapper.tpl.php
index c95bafb..6b6defc 100644
--- a/modules/comment/comment-wrapper.tpl.php
+++ b/modules/comment/comment-wrapper.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: comment-wrapper.tpl.php,v 1.2 2007/08/07 08:39:35 goba Exp $
 
 /**
  * @file comment-wrapper.tpl.php
diff --git a/modules/comment/comment.admin.inc b/modules/comment/comment.admin.inc
index cdf2e63..6212049 100644
--- a/modules/comment/comment.admin.inc
+++ b/modules/comment/comment.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: comment.admin.inc,v 1.4.2.3 2010/01/28 10:15:11 goba Exp $
 
 /**
  * @file
diff --git a/modules/comment/comment.css b/modules/comment/comment.css
index 2ffe0cc..429480f 100644
--- a/modules/comment/comment.css
+++ b/modules/comment/comment.css
@@ -1,4 +1,3 @@
-/* $Id: comment.css,v 1.4 2007/07/24 21:33:53 goba Exp $ */
 
 .indented {
   margin-left: 25px; /* LTR */
diff --git a/modules/comment/comment.info b/modules/comment/comment.info
index c05608a..0979541 100644
--- a/modules/comment/comment.info
+++ b/modules/comment/comment.info
@@ -1,12 +1,11 @@
-; $Id: comment.info,v 1.4 2007/06/08 05:50:54 dries Exp $
 name = Comment
 description = Allows users to comment on and discuss published content.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/comment/comment.install b/modules/comment/comment.install
index 15955a5..e5ac7d0 100644
--- a/modules/comment/comment.install
+++ b/modules/comment/comment.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: comment.install,v 1.19.2.1 2009/01/06 15:46:36 goba Exp $
 
 /**
  * Implementation of hook_enable().
diff --git a/modules/comment/comment.js b/modules/comment/comment.js
index cd3e8b4..451bc8a 100644
--- a/modules/comment/comment.js
+++ b/modules/comment/comment.js
@@ -1,4 +1,3 @@
-// $Id: comment.js,v 1.5 2007/09/12 18:29:32 goba Exp $
 
 Drupal.behaviors.comment = function (context) {
   var parts = new Array("name", "homepage", "mail");
diff --git a/modules/comment/comment.module b/modules/comment/comment.module
index c0d7900..e76f235 100644
--- a/modules/comment/comment.module
+++ b/modules/comment/comment.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: comment.module,v 1.617.2.17 2010/08/11 20:35:47 goba Exp $
 
 /**
  * @file
diff --git a/modules/comment/comment.pages.inc b/modules/comment/comment.pages.inc
index b74d7d8..7aec87c 100644
--- a/modules/comment/comment.pages.inc
+++ b/modules/comment/comment.pages.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: comment.pages.inc,v 1.2.2.2 2009/07/01 20:51:55 goba Exp $
 
 /**
  * @file
diff --git a/modules/comment/comment.tpl.php b/modules/comment/comment.tpl.php
index 42c3f9c..9aea1c7 100644
--- a/modules/comment/comment.tpl.php
+++ b/modules/comment/comment.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: comment.tpl.php,v 1.4.2.1 2008/03/21 21:58:28 goba Exp $
 
 /**
  * @file comment.tpl.php
diff --git a/modules/contact/contact.admin.inc b/modules/contact/contact.admin.inc
index 32cafcf..e7a5def 100644
--- a/modules/contact/contact.admin.inc
+++ b/modules/contact/contact.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: contact.admin.inc,v 1.3.2.1 2009/12/16 20:47:10 goba Exp $
 
 /**
  * @file
diff --git a/modules/contact/contact.info b/modules/contact/contact.info
index f4aac1f..d83c889 100644
--- a/modules/contact/contact.info
+++ b/modules/contact/contact.info
@@ -1,12 +1,11 @@
-; $Id: contact.info,v 1.4 2007/06/08 05:50:54 dries Exp $
 name = Contact
 description = Enables the use of both personal and site-wide contact forms.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/contact/contact.install b/modules/contact/contact.install
index cebdf8c..6b67f52 100644
--- a/modules/contact/contact.install
+++ b/modules/contact/contact.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: contact.install,v 1.10.2.1 2009/01/06 15:46:36 goba Exp $
 
 /**
  * Implementation of hook_install().
diff --git a/modules/contact/contact.module b/modules/contact/contact.module
index 03e4cd5..f77d0bc 100644
--- a/modules/contact/contact.module
+++ b/modules/contact/contact.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: contact.module,v 1.103.2.2 2009/11/06 07:36:34 goba Exp $
 
 /**
  * @file
diff --git a/modules/contact/contact.pages.inc b/modules/contact/contact.pages.inc
index 7c6b8b9..db9c942 100644
--- a/modules/contact/contact.pages.inc
+++ b/modules/contact/contact.pages.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: contact.pages.inc,v 1.6.2.2 2009/04/27 14:48:21 goba Exp $
 
 /**
  * @file
diff --git a/modules/dblog/dblog-rtl.css b/modules/dblog/dblog-rtl.css
index 1dd5a7e..60a402d 100644
--- a/modules/dblog/dblog-rtl.css
+++ b/modules/dblog/dblog-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: dblog-rtl.css,v 1.2.2.1 2008/09/02 16:56:49 dries Exp $ */
 
 #edit-type-wrapper, #edit-severity-wrapper {
   float: right;
diff --git a/modules/dblog/dblog.admin.inc b/modules/dblog/dblog.admin.inc
index 698b48f..ee577a4 100644
--- a/modules/dblog/dblog.admin.inc
+++ b/modules/dblog/dblog.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: dblog.admin.inc,v 1.6.2.1 2008/09/17 05:47:53 goba Exp $
 
 /**
  * @file
@@ -215,7 +214,7 @@ function dblog_filters() {
   $filters = array();
 
   foreach (_dblog_get_message_types() as $type) {
-    $types[$type] = $type;
+    $types[$type] = t($type);
   }
 
   if (!empty($types)) {
diff --git a/modules/dblog/dblog.css b/modules/dblog/dblog.css
index af488b4..52f62a4 100644
--- a/modules/dblog/dblog.css
+++ b/modules/dblog/dblog.css
@@ -1,4 +1,3 @@
-/* $Id: dblog.css,v 1.4.2.1 2008/09/02 16:56:49 dries Exp $ */
 
 #edit-type-wrapper, #edit-severity-wrapper {
   float: left; /* LTR */
diff --git a/modules/dblog/dblog.info b/modules/dblog/dblog.info
index fdde5b6..8326e75 100644
--- a/modules/dblog/dblog.info
+++ b/modules/dblog/dblog.info
@@ -1,12 +1,11 @@
-; $Id: dblog.info,v 1.2 2007/06/08 05:50:54 dries Exp $
 name = Database logging
 description = Logs and records system events to the database.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/dblog/dblog.install b/modules/dblog/dblog.install
index 495ffe2..80c4584 100644
--- a/modules/dblog/dblog.install
+++ b/modules/dblog/dblog.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: dblog.install,v 1.6.2.3 2009/09/14 08:19:24 goba Exp $
 
 /**
  * Implementation of hook_install().
diff --git a/modules/dblog/dblog.module b/modules/dblog/dblog.module
index f64e21b..4a1326c 100644
--- a/modules/dblog/dblog.module
+++ b/modules/dblog/dblog.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: dblog.module,v 1.21.2.3 2010/03/01 10:26:48 goba Exp $
 
 /**
  * @file
diff --git a/modules/filter/filter.admin.inc b/modules/filter/filter.admin.inc
index 205b1e6..36f3d67 100644
--- a/modules/filter/filter.admin.inc
+++ b/modules/filter/filter.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: filter.admin.inc,v 1.8.2.1 2008/02/12 14:25:34 goba Exp $
 
 /**
  * @file
diff --git a/modules/filter/filter.info b/modules/filter/filter.info
index 493c4cc..cfc59f4 100644
--- a/modules/filter/filter.info
+++ b/modules/filter/filter.info
@@ -1,12 +1,11 @@
-; $Id: filter.info,v 1.4 2007/06/08 05:50:54 dries Exp $
 name = Filter
 description = Handles the filtering of content in preparation for display.
 package = Core - required
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/filter/filter.install b/modules/filter/filter.install
index 8820d40..c6dc8ed 100644
--- a/modules/filter/filter.install
+++ b/modules/filter/filter.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: filter.install,v 1.5.2.1 2009/01/06 15:46:36 goba Exp $
 
 /**
  * Implementation of hook_schema().
diff --git a/modules/filter/filter.module b/modules/filter/filter.module
index 37dec60..5962c53 100644
--- a/modules/filter/filter.module
+++ b/modules/filter/filter.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: filter.module,v 1.204.2.16 2010/08/06 11:20:12 goba Exp $
 
 /**
  * @file
@@ -397,10 +396,9 @@ function filter_list_format($format) {
 }
 
 /**
- * @name Filtering functions
+ * @defgroup filtering_functions Filtering functions
  * @{
- * Modules which need to have content filtered can use these functions to
- * interact with the filter system.
+ * Functions for interacting with the content filtering system.
  *
  * For more info, see the hook_filter() documentation.
  *
@@ -604,19 +602,20 @@ function theme_filter_tips_more_info() {
 }
 
 /**
- * @name Standard filters
+ * @defgroup standard_filters Standard filters
  * @{
  * Filters implemented by the filter.module.
  */
 
 /**
- * Implementation of hook_filter(). Contains a basic set of essential filters.
- * - HTML filter:
- *     Validates user-supplied HTML, transforming it as necessary.
- * - Line break converter:
- *     Converts newlines into paragraph and break tags.
- * - URL and e-mail address filter:
- *     Converts newlines into paragraph and break tags.
+ * Implementation of hook_filter().
+ *
+ * Sets up a basic set of essential filters.
+ * - HTML filter: Restricts user-supplied HTML to certain tags, and removes
+ *   dangerous components in allowed tags.
+ * - Line break converter: Converts newlines into paragraph and break tags.
+ * - URL filter: Converts URLs and e-mail addresses into links.
+ * - HTML corrector: Fixes faulty HTML.
  */
 function filter_filter($op, $delta = 0, $format = -1, $text = '') {
   switch ($op) {
@@ -1219,7 +1218,7 @@ function _filter_xss_attributes($attr) {
 function filter_xss_bad_protocol($string, $decode = TRUE) {
   static $allowed_protocols;
   if (!isset($allowed_protocols)) {
-    $allowed_protocols = array_flip(variable_get('filter_allowed_protocols', array('http', 'https', 'ftp', 'news', 'nntp', 'telnet', 'mailto', 'irc', 'ssh', 'sftp', 'webcal', 'rtsp')));
+    $allowed_protocols = array_flip(variable_get('filter_allowed_protocols', array('http', 'https', 'ftp', 'news', 'nntp', 'tel', 'telnet', 'mailto', 'irc', 'ssh', 'sftp', 'webcal', 'rtsp')));
   }
 
   // Get the plain text representation of the attribute value (i.e. its meaning).
diff --git a/modules/filter/filter.pages.inc b/modules/filter/filter.pages.inc
index 064b4ef..24613fa 100644
--- a/modules/filter/filter.pages.inc
+++ b/modules/filter/filter.pages.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: filter.pages.inc,v 1.2 2007/11/10 17:41:18 dries Exp $
 
 /**
  * @file
diff --git a/modules/forum/forum-icon.tpl.php b/modules/forum/forum-icon.tpl.php
index f39aa1f..d2b987a 100644
--- a/modules/forum/forum-icon.tpl.php
+++ b/modules/forum/forum-icon.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: forum-icon.tpl.php,v 1.3 2007/12/20 09:35:09 goba Exp $
 
 /**
  * @file forum-icon.tpl.php
diff --git a/modules/forum/forum-list.tpl.php b/modules/forum/forum-list.tpl.php
index 5898f41..c3b809c 100644
--- a/modules/forum/forum-list.tpl.php
+++ b/modules/forum/forum-list.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: forum-list.tpl.php,v 1.4 2007/08/30 18:58:12 goba Exp $
 
 /**
  * @file forum-list.tpl.php
diff --git a/modules/forum/forum-rtl.css b/modules/forum/forum-rtl.css
index 575250e..d31c9e7 100644
--- a/modules/forum/forum-rtl.css
+++ b/modules/forum/forum-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: forum-rtl.css,v 1.3 2007/11/27 12:09:26 goba Exp $ */
 
 #forum tr td.forum {
   padding-left: 0.5em;
diff --git a/modules/forum/forum-submitted.tpl.php b/modules/forum/forum-submitted.tpl.php
index 6a07d26..11a6e91 100644
--- a/modules/forum/forum-submitted.tpl.php
+++ b/modules/forum/forum-submitted.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: forum-submitted.tpl.php,v 1.3 2007/08/07 08:39:35 goba Exp $
 
 /**
  * @file forum-submitted.tpl.php
diff --git a/modules/forum/forum-topic-list.tpl.php b/modules/forum/forum-topic-list.tpl.php
index adde1d9..d3e0090 100644
--- a/modules/forum/forum-topic-list.tpl.php
+++ b/modules/forum/forum-topic-list.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: forum-topic-list.tpl.php,v 1.4.2.1 2008/10/22 18:22:51 dries Exp $
 
 /**
  * @file forum-topic-list.tpl.php
diff --git a/modules/forum/forum-topic-navigation.tpl.php b/modules/forum/forum-topic-navigation.tpl.php
index 6630126..1b42b11 100644
--- a/modules/forum/forum-topic-navigation.tpl.php
+++ b/modules/forum/forum-topic-navigation.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: forum-topic-navigation.tpl.php,v 1.2 2007/08/07 08:39:35 goba Exp $
 
 /**
  * @file forum-topic-navigation.tpl.php
diff --git a/modules/forum/forum.admin.inc b/modules/forum/forum.admin.inc
index b0df7ee..6eff8b3 100644
--- a/modules/forum/forum.admin.inc
+++ b/modules/forum/forum.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: forum.admin.inc,v 1.8.2.1 2009/05/26 08:13:00 goba Exp $
 
 /**
  * @file
diff --git a/modules/forum/forum.css b/modules/forum/forum.css
index f03ba4c..f4fcc87 100644
--- a/modules/forum/forum.css
+++ b/modules/forum/forum.css
@@ -1,4 +1,3 @@
-/* $Id: forum.css,v 1.5 2007/07/22 07:01:07 dries Exp $ */
 
 #forum .description {
   font-size: 0.9em;
diff --git a/modules/forum/forum.info b/modules/forum/forum.info
index d35e5c9..46f7f0a 100644
--- a/modules/forum/forum.info
+++ b/modules/forum/forum.info
@@ -1,4 +1,3 @@
-; $Id: forum.info,v 1.6 2007/06/08 05:50:54 dries Exp $
 name = Forum
 description = Enables threaded discussions about general topics.
 dependencies[] = taxonomy
@@ -7,8 +6,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/forum/forum.install b/modules/forum/forum.install
index 1deffdd..f4c73ae 100644
--- a/modules/forum/forum.install
+++ b/modules/forum/forum.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: forum.install,v 1.16.2.2 2009/01/06 15:46:37 goba Exp $
 
 /**
  * Implementation of hook_install().
diff --git a/modules/forum/forum.module b/modules/forum/forum.module
index 71b8b46..1d8f4a4 100644
--- a/modules/forum/forum.module
+++ b/modules/forum/forum.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: forum.module,v 1.448.2.8 2010/03/01 11:32:00 goba Exp $
 
 /**
  * @file
@@ -255,7 +254,7 @@ function forum_nodeapi(&$node, $op, $teaser, $page) {
             $node->tid = $term_id;
           }
         }
-        $old_tid = db_result(db_query_range("SELECT t.tid FROM {term_node} t INNER JOIN {node} n ON t.vid = n.vid WHERE n.nid = %d ORDER BY t.vid DESC", $node->nid, 0, 1));
+        $old_tid = db_result(db_query_range("SELECT f.tid FROM {forum} f INNER JOIN {node} n ON f.vid = n.vid WHERE n.nid = %d ORDER BY f.vid DESC", $node->nid, 0, 1));
         if ($old_tid && isset($node->tid) && ($node->tid != $old_tid) && !empty($node->shadow)) {
           // A shadow copy needs to be created. Retain new term and add old term.
           $node->taxonomy[] = $old_tid;
@@ -495,11 +494,31 @@ function forum_get_forums($tid = 0) {
   $_forums = taxonomy_get_tree($vid, $tid);
 
   if (count($_forums)) {
-
-    $counts = array();
-
-    $sql = "SELECT r.tid, COUNT(n.nid) AS topic_count, SUM(l.comment_count) AS comment_count FROM {node} n INNER JOIN {node_comment_statistics} l ON n.nid = l.nid INNER JOIN {term_node} r ON n.vid = r.vid WHERE n.status = 1 GROUP BY r.tid";
-    $sql = db_rewrite_sql($sql);
+  $counts = array();
+    $sql = "
+      SELECT r.tid AS tid, n.nid AS nid, l.comment_count AS nid_comment_count
+        FROM {node} n
+        INNER JOIN {node_comment_statistics} l ON n.nid = l.nid
+        INNER JOIN {term_node} r ON n.vid = r.vid
+        WHERE n.status = 1
+        GROUP BY r.tid, n.nid, l.comment_count";
+    $sql_rewritten = db_rewrite_sql($sql);
+    if ($sql_rewritten == $sql) {
+      $sql = "
+        SELECT r.tid, COUNT(n.nid) AS topic_count, SUM(l.comment_count) AS comment_count
+          FROM {node} n
+          INNER JOIN {node_comment_statistics} l ON n.nid = l.nid
+          INNER JOIN {term_node} r ON n.vid = r.vid
+          WHERE n.status = 1
+          GROUP BY r.tid";
+      $sql = db_rewrite_sql($sql);
+    }
+    else {
+      $sql = "
+        SELECT tid, COUNT(nid) AS topic_count, SUM(nid_comment_count) AS comment_count
+          FROM ($sql_rewritten) AS forum_content_list
+          GROUP BY tid";
+    }
     $_counts = db_query($sql);
     while ($count = db_fetch_object($_counts)) {
       $counts[$count->tid] = $count;
@@ -546,7 +565,7 @@ function forum_get_forums($tid = 0) {
  * than NODE_NEW_LIMIT.
  */
 function _forum_topics_unread($term, $uid) {
-  $sql = "SELECT COUNT(n.nid) FROM {node} n INNER JOIN {term_node} tn ON n.vid = tn.vid AND tn.tid = %d LEFT JOIN {history} h ON n.nid = h.nid AND h.uid = %d WHERE n.status = 1 AND n.created > %d AND h.nid IS NULL";
+  $sql = "SELECT COUNT(DISTINCT n.nid) FROM {node} n INNER JOIN {term_node} tn ON n.vid = tn.vid AND tn.tid = %d LEFT JOIN {history} h ON n.nid = h.nid AND h.uid = %d WHERE n.status = 1 AND n.created > %d AND h.nid IS NULL";
   $sql = db_rewrite_sql($sql);
   return db_result(db_query($sql, $term, $uid, NODE_NEW_LIMIT));
 }
@@ -575,7 +594,7 @@ function forum_get_topics($tid, $sortby, $forum_per_page) {
   $sql .= tablesort_sql($forum_topic_list_header, 'n.sticky DESC,');
   $sql .= ', n.created DESC';  // Always add a secondary sort order so that the news forum topics are on top.
 
-  $sql_count = db_rewrite_sql("SELECT COUNT(n.nid) FROM {node} n INNER JOIN {term_node} r ON n.vid = r.vid AND r.tid = %d WHERE n.status = 1");
+  $sql_count = db_rewrite_sql("SELECT COUNT(DISTINCT n.nid) FROM {node} n INNER JOIN {term_node} r ON n.vid = r.vid AND r.tid = %d WHERE n.status = 1");
 
   $result = pager_query($sql, $forum_per_page, 0, $sql_count, $tid);
   $topics = array();
diff --git a/modules/forum/forum.pages.inc b/modules/forum/forum.pages.inc
index 6d7db19..35fbff2 100644
--- a/modules/forum/forum.pages.inc
+++ b/modules/forum/forum.pages.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: forum.pages.inc,v 1.2.2.1 2009/07/01 20:51:55 goba Exp $
 
 /**
  * @file
diff --git a/modules/forum/forums.tpl.php b/modules/forum/forums.tpl.php
index c952d2e..7139bad 100644
--- a/modules/forum/forums.tpl.php
+++ b/modules/forum/forums.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: forums.tpl.php,v 1.4 2007/08/07 08:39:35 goba Exp $
 
 /**
  * @file forums.tpl.php
diff --git a/modules/help/help-rtl.css b/modules/help/help-rtl.css
index 61487af..8e40a8c 100644
--- a/modules/help/help-rtl.css
+++ b/modules/help/help-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: help-rtl.css,v 1.2 2007/11/27 12:09:26 goba Exp $ */
 
 .help-items {
   float: right;
diff --git a/modules/help/help.admin.inc b/modules/help/help.admin.inc
index d8276ae..87e869d 100644
--- a/modules/help/help.admin.inc
+++ b/modules/help/help.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: help.admin.inc,v 1.5 2007/11/25 11:11:17 goba Exp $
 
 /**
  * @file
diff --git a/modules/help/help.css b/modules/help/help.css
index 592390f..9228170 100644
--- a/modules/help/help.css
+++ b/modules/help/help.css
@@ -1,4 +1,3 @@
-/* $Id: help.css,v 1.2 2007/05/27 17:57:48 goba Exp $ */
 
 .help-items {
   float: left; /* LTR */
diff --git a/modules/help/help.info b/modules/help/help.info
index fb54b1b..346c6ba 100644
--- a/modules/help/help.info
+++ b/modules/help/help.info
@@ -1,12 +1,11 @@
-; $Id: help.info,v 1.4 2007/06/08 05:50:54 dries Exp $
 name = Help
 description = Manages the display of online help.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/help/help.module b/modules/help/help.module
index 57a07cc..3cf1f4e 100644
--- a/modules/help/help.module
+++ b/modules/help/help.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: help.module,v 1.78.2.1 2008/04/09 21:11:48 goba Exp $
 
 /**
  * @file
diff --git a/modules/locale/locale.css b/modules/locale/locale.css
index acffad6..9f451a7 100644
--- a/modules/locale/locale.css
+++ b/modules/locale/locale.css
@@ -1,4 +1,3 @@
-/* $Id: locale.css,v 1.1 2006/08/14 07:14:49 drumm Exp $ */
 
 .locale-untranslated {
   font-style: normal;
diff --git a/modules/locale/locale.info b/modules/locale/locale.info
index a458d3c..fefef2b 100644
--- a/modules/locale/locale.info
+++ b/modules/locale/locale.info
@@ -1,12 +1,11 @@
-; $Id: locale.info,v 1.6 2007/11/05 08:43:48 goba Exp $
 name = Locale
 description = Adds language handling functionality and enables the translation of the user interface to languages other than English.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/locale/locale.install b/modules/locale/locale.install
index 3729554..9c54105 100644
--- a/modules/locale/locale.install
+++ b/modules/locale/locale.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: locale.install,v 1.27.2.3 2010/03/04 00:15:28 goba Exp $
 
 /**
  * Implementation of hook_install().
diff --git a/modules/locale/locale.module b/modules/locale/locale.module
index dfffb2e..092eb48 100644
--- a/modules/locale/locale.module
+++ b/modules/locale/locale.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: locale.module,v 1.212.2.10 2010/03/04 00:15:28 goba Exp $
 
 /**
  * @file
@@ -25,14 +24,14 @@ function locale_help($path, $arg) {
       $output .= '<p>'. t('Beyond translation of the Drupal interface, the locale module provides a feature set tailored to the needs of a multi-lingual site. Language negotiation allows your site to automatically change language based on the domain or path used for each request. Users may (optionally) select their preferred language on their <em>My account</em> page, and your site can be configured to honor a web browser\'s preferred language settings. Your site content can be created in (and translated to) any enabled language, and each post may have a language-appropriate alias for each of its translations. The locale module works in concert with the <a href="@content-help">content translation module</a> to manage translated content.', array('@content-help' => url('admin/help/translation'))) .'</p>';
       $output .= '<p>'. t('Translations may be provided by:') .'</p>';
       $output .= '<ul><li>'. t("translating the original text via the locale module's integrated web interface, or") .'</li>';
-      $output .= '<li>'. t('importing files from a set of existing translations, known as a translation package. A translation package enables the display of a specific version of Drupal in a specific language, and contain files in the Gettext Portable Object (<em>.po</em>) format. Although not all languages are available for every version of Drupal, translation packages for many languages are available for download from the <a href="@translations">Drupal translation page</a>.', array('@translations' => 'http://drupal.org/project/translations')) .'</li></ul>';
+      $output .= '<li>'. t('importing files from a set of existing translations, known as a translation package. A translation package enables the display of a specific version of Drupal in a specific language, and contain files in the Gettext Portable Object (<em>.po</em>) format. Although not all languages are available for every version of Drupal, translation packages for many languages are available for download from the <a href="@translations">Drupal translation page</a>.', array('@translations' => 'http://localize.drupal.org')) .'</li></ul>';
       $output .= '<p>'. t('If an existing translation package does not meet your needs, the Gettext Portable Object (<em>.po</em>) files within a package may be modified, or new <em>.po</em> files may be created, using a desktop Gettext editor. The locale module\'s <a href="@import">import</a> feature allows the translated strings from a new or modified <em>.po</em> file to be added to your site. The locale module\'s <a href="@export">export</a> feature generates files from your site\'s translated strings, that can either be shared with others or edited offline by a Gettext translation editor.', array('@import' => url('admin/build/translate/import'), '@export' => url('admin/build/translate/export'))) .'</p>';
       $output .= '<p>'. t('For more information, see the online handbook entry for <a href="@locale">Locale module</a>.', array('@locale' => 'http://drupal.org/handbook/modules/locale/')) .'</p>';
       return $output;
     case 'admin/settings/language':
       $output = '<p>'. t("This page provides an overview of your site's enabled languages. If multiple languages are available and enabled, the text on your site interface may be translated, registered users may select their preferred language on the <em>My account</em> page, and site authors may indicate a specific language when creating posts. The site's default language is used for anonymous visitors and for users who have not selected a preferred language.") .'</p>';
       $output .= '<p>'. t('For each language available on the site, use the <em>edit</em> link to configure language details, including name, an optional language-specific path or domain, and whether the language is natively presented either left-to-right or right-to-left. These languages also appear in the <em>Language</em> selection when creating a post of a content type with multilingual support.') .'</p>';
-      $output .= '<p>'. t('Use the <a href="@add-language">add language page</a> to enable additional languages (and automatically import files from a translation package, if available), the <a href="@search">translate interface page</a> to locate strings for manual translation, or the <a href="@import">import page</a> to add translations from individual <em>.po</em> files. A number of contributed translation packages containing <em>.po</em> files are available on the <a href="@translations">Drupal.org translations page</a>.', array('@add-language' => url('admin/settings/language/add'), '@search' => url('admin/build/translate/search'), '@import' => url('admin/build/translate/import'), '@translations' => 'http://drupal.org/project/translations')) .'</p>';
+      $output .= '<p>'. t('Use the <a href="@add-language">add language page</a> to enable additional languages (and automatically import files from a translation package, if available), the <a href="@search">translate interface page</a> to locate strings for manual translation, or the <a href="@import">import page</a> to add translations from individual <em>.po</em> files. A number of contributed translation packages containing <em>.po</em> files are available on the <a href="@translations">Drupal.org translations page</a>.', array('@add-language' => url('admin/settings/language/add'), '@search' => url('admin/build/translate/search'), '@import' => url('admin/build/translate/import'), '@translations' => 'http://localize.drupal.org')) .'</p>';
       return $output;
     case 'admin/settings/language/add':
       return '<p>'. t('Add all languages to be supported by your site. If your desired language is not available in the <em>Language name</em> drop-down, click <em>Custom language</em> and provide a language code and other details manually. When providing a language code manually, be sure to enter a standardized language code, since this code may be used by browsers to determine an appropriate display language.') .'</p>';
@@ -50,7 +49,7 @@ function locale_help($path, $arg) {
       return $output;
     case 'admin/build/translate/import':
       $output = '<p>'. t('This page imports the translated strings contained in an individual Gettext Portable Object (<em>.po</em>) file. Normally distributed as part of a translation package (each translation package may contain several <em>.po</em> files), a <em>.po</em> file may need to be imported after off-line editing in a Gettext translation editor. Importing an individual <em>.po</em> file may be a lengthy process.') .'</p>';
-      $output .= '<p>'. t('Note that the <em>.po</em> files within a translation package are imported automatically (if available) when new modules or themes are enabled, or as new languages are added. Since this page only allows the import of one <em>.po</em> file at a time, it may be simpler to download and extract a translation package into your Drupal installation directory and <a href="@language-add">add the language</a> (which automatically imports all <em>.po</em> files within the package). Translation packages are available for download on the <a href="@translations">Drupal translation page</a>.', array('@language-add' => url('admin/settings/language/add'), '@translations' => 'http://drupal.org/project/translations')) .'</p>';
+      $output .= '<p>'. t('Note that the <em>.po</em> files within a translation package are imported automatically (if available) when new modules or themes are enabled, or as new languages are added. Since this page only allows the import of one <em>.po</em> file at a time, it may be simpler to download and extract a translation package into your Drupal installation directory and <a href="@language-add">add the language</a> (which automatically imports all <em>.po</em> files within the package). Translation packages are available for download on the <a href="@translations">Drupal translation page</a>.', array('@language-add' => url('admin/settings/language/add'), '@translations' => 'http://localize.drupal.org')) .'</p>';
       return $output;
     case 'admin/build/translate/export':
       return '<p>'. t('This page exports the translated strings used by your site. An export file may be in Gettext Portable Object (<em>.po</em>) form, which includes both the original string and the translation (used to share translations with others), or in Gettext Portable Object Template (<em>.pot</em>) form, which includes the original strings only (used to create new translations with a Gettext translation editor).') .'</p>';
diff --git a/modules/menu/menu.admin.inc b/modules/menu/menu.admin.inc
index f39a677..a62f246 100644
--- a/modules/menu/menu.admin.inc
+++ b/modules/menu/menu.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: menu.admin.inc,v 1.26.2.7 2010/06/02 12:56:20 goba Exp $
 
 /**
  * @file
@@ -410,7 +409,7 @@ function menu_edit_menu(&$form_state, $type, $menu = array()) {
     $form['menu_name'] = array(
       '#type' => 'textfield',
       '#title' => t('Menu name'),
-      '#maxsize' => MENU_MAX_MENU_NAME_LENGTH_UI,
+      '#maxlength' => MENU_MAX_MENU_NAME_LENGTH_UI,
       '#description' => t('The machine-readable name of this menu. This text will be used for constructing the URL of the <em>menu overview</em> page for this menu. This name must contain only lowercase letters, numbers, and hyphens, and must be unique.'),
       '#required' => TRUE,
     );
@@ -510,9 +509,6 @@ function menu_edit_menu_validate($form, &$form_state) {
   if (preg_match('/[^a-z0-9-]/', $item['menu_name'])) {
     form_set_error('menu_name', t('The menu name may only consist of lowercase letters, numbers, and hyphens.'));
   }
-  if (strlen($item['menu_name']) > MENU_MAX_MENU_NAME_LENGTH_UI) {
-    form_set_error('menu_name', format_plural(MENU_MAX_MENU_NAME_LENGTH_UI, "The menu name can't be longer than 1 character.", "The menu name can't be longer than @count characters."));
-  }
   if ($form['#insert']) {
     // We will add 'menu-' to the menu name to help avoid name-space conflicts.
     $item['menu_name'] = 'menu-'. $item['menu_name'];
diff --git a/modules/menu/menu.info b/modules/menu/menu.info
index a22fc79..3b58654 100644
--- a/modules/menu/menu.info
+++ b/modules/menu/menu.info
@@ -1,12 +1,11 @@
-; $Id: menu.info,v 1.4 2007/06/08 05:50:55 dries Exp $
 name = Menu
 description = Allows administrators to customize the site navigation menu.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/menu/menu.install b/modules/menu/menu.install
index bdfa8ba..3c69c40 100644
--- a/modules/menu/menu.install
+++ b/modules/menu/menu.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: menu.install,v 1.9.2.1 2009/01/06 15:46:37 goba Exp $
 
 /**
  * Implementation of hook_install().
diff --git a/modules/menu/menu.module b/modules/menu/menu.module
index b25d173..cfe17b1 100644
--- a/modules/menu/menu.module
+++ b/modules/menu/menu.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: menu.module,v 1.157.2.6 2009/04/27 12:50:13 goba Exp $
 
 /**
  * @file
@@ -46,7 +45,7 @@ function menu_perm() {
 function menu_menu() {
   $items['admin/build/menu'] = array(
     'title' => 'Menus',
-    'description' => "Control your site's navigation menu, primary links and secondary links. as well as rename and reorganize menu items.",
+    'description' => "Control your site's navigation menu, primary links and secondary links, as well as rename and reorganize menu items.",
     'page callback' => 'menu_overview_page',
     'access callback' => 'user_access',
     'access arguments' => array('administer menu'),
diff --git a/modules/node/content_types.inc b/modules/node/content_types.inc
index fbf8ec8..7442949 100644
--- a/modules/node/content_types.inc
+++ b/modules/node/content_types.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: content_types.inc,v 1.50.2.3 2009/09/14 11:51:23 goba Exp $
 
 /**
  * @file
diff --git a/modules/node/node-rtl.css b/modules/node/node-rtl.css
index 6cd1236..3ecb0ea 100644
--- a/modules/node/node-rtl.css
+++ b/modules/node/node-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: node-rtl.css,v 1.3 2007/11/27 12:09:26 goba Exp $ */
 
 #node-admin-buttons {
   float: right;
diff --git a/modules/node/node.admin.inc b/modules/node/node.admin.inc
index 5782fdd..f20c12f 100644
--- a/modules/node/node.admin.inc
+++ b/modules/node/node.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: node.admin.inc,v 1.19.2.3 2009/06/08 16:45:34 goba Exp $
 
 /**
  * @file
diff --git a/modules/node/node.css b/modules/node/node.css
index 3bd7b73..60d0130 100644
--- a/modules/node/node.css
+++ b/modules/node/node.css
@@ -1,4 +1,3 @@
-/* $Id: node.css,v 1.5 2008/01/25 21:21:44 goba Exp $ */
 
 .node-unpublished {
   background-color: #fff4f4;
diff --git a/modules/node/node.info b/modules/node/node.info
index b81f2ce..ef05a2b 100644
--- a/modules/node/node.info
+++ b/modules/node/node.info
@@ -1,12 +1,11 @@
-; $Id: node.info,v 1.4 2007/06/08 05:50:55 dries Exp $
 name = Node
 description = Allows content to be submitted to the site and displayed on pages.
 package = Core - required
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/node/node.install b/modules/node/node.install
index 71d9f06..a0b1ce3 100644
--- a/modules/node/node.install
+++ b/modules/node/node.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: node.install,v 1.4.2.3 2009/01/06 15:46:37 goba Exp $
 
 /**
  * Implementation of hook_schema().
diff --git a/modules/node/node.module b/modules/node/node.module
index 1b28b85..4842e43 100644
--- a/modules/node/node.module
+++ b/modules/node/node.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: node.module,v 1.947.2.26 2010/08/06 11:41:13 goba Exp $
 
 /**
  * @file
@@ -816,7 +815,13 @@ function node_validate($node, $form = array()) {
 }
 
 /**
- * Prepare node for save and allow modules to make changes.
+ * Prepares a node for saving by populating teaser, author, and creation date.
+ *
+ * @param object|array $node
+ *   A node object or array.
+ *
+ * @return
+ *   A validated node object with a populated teaser, author, and creation date.
  */
 function node_submit($node) {
   global $user;
@@ -968,6 +973,7 @@ function node_delete($nid) {
   if (node_access('delete', $node)) {
     db_query('DELETE FROM {node} WHERE nid = %d', $node->nid);
     db_query('DELETE FROM {node_revisions} WHERE nid = %d', $node->nid);
+    db_query('DELETE FROM {node_access} WHERE nid = %d', $node->nid);
 
     // Call the node-specific callback (if any):
     node_invoke($node, 'delete');
@@ -1233,9 +1239,9 @@ function node_search($op = 'search', $keys = NULL) {
       if ($weight = (int)variable_get('node_rank_recent', 5)) {
         // Exponential decay with half-life of 6 months, starting at last indexed node
         // c.last_comment_timestamp may be NULL. Since both MAX(anynumber, NULL) and
-        // GREATEST(anynumber, NULL) return NULL, we OR MAX(c.last_comment_timestamp) with 1
+        // GREATEST(anynumber, NULL) return NULL, we use COALESCE(MAX(c.last_comment_timestamp), 0)
         // to prevent it from being NULL.
-        $ranking[] = '%d * POW(2, (GREATEST(MAX(n.created), MAX(n.changed), MAX(c.last_comment_timestamp) || 1) - %d) * 6.43e-8)';
+        $ranking[] = '%d * POW(2, (GREATEST(MAX(n.created), MAX(n.changed), COALESCE(MAX(c.last_comment_timestamp), 0)) - %d) * 6.43e-8)';
         $arguments2[] = $weight;
         $arguments2[] = (int)variable_get('node_cron_last', 0);
         $join2 .= ' LEFT JOIN {node_comment_statistics} c ON c.nid = i.sid';
@@ -2688,7 +2694,7 @@ function node_save_action($node) {
 function node_assign_owner_action(&$node, $context) {
   $node->uid = $context['owner_uid'];
   $owner_name = db_result(db_query("SELECT name FROM {users} WHERE uid = %d", $context['owner_uid']));
-  watchdog('action', 'Changed owner of @type %title to uid %name.', array('@type' => node_get_types('type', $node), '%title' => $node->title, '%name' => $owner_name));
+  watchdog('action', 'Changed owner of @type %title to uid %name.', array('@type' => node_get_types('name', $node), '%title' => $node->title, '%name' => $owner_name));
 }
 
 function node_assign_owner_action_form($context) {
diff --git a/modules/node/node.pages.inc b/modules/node/node.pages.inc
index 72decf3..f5bbdfc 100644
--- a/modules/node/node.pages.inc
+++ b/modules/node/node.pages.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: node.pages.inc,v 1.28.2.4 2009/04/27 11:35:01 goba Exp $
 
 /**
  * @file
diff --git a/modules/node/node.tpl.php b/modules/node/node.tpl.php
index 1884f44..0ae6fd9 100644
--- a/modules/node/node.tpl.php
+++ b/modules/node/node.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: node.tpl.php,v 1.4.2.1 2009/08/10 10:48:33 goba Exp $
 
 /**
  * @file node.tpl.php
diff --git a/modules/openid/openid.css b/modules/openid/openid.css
index 8c2dfc2..900c0d4 100644
--- a/modules/openid/openid.css
+++ b/modules/openid/openid.css
@@ -1,4 +1,3 @@
-/* $Id: openid.css,v 1.5.2.1 2009/03/31 10:48:22 dries Exp $ */
 
 #edit-openid-identifier {
   background-image: url("login-bg.png");
diff --git a/modules/openid/openid.inc b/modules/openid/openid.inc
index 9223a4d..44cdde2 100644
--- a/modules/openid/openid.inc
+++ b/modules/openid/openid.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: openid.inc,v 1.8.2.3 2010/03/01 11:06:41 goba Exp $
 
 /**
  * @file
diff --git a/modules/openid/openid.info b/modules/openid/openid.info
index 4516b2e..3c3dcea 100644
--- a/modules/openid/openid.info
+++ b/modules/openid/openid.info
@@ -1,12 +1,11 @@
-; $Id: openid.info,v 1.2 2007/06/22 22:26:43 unconed Exp $
 name = OpenID
 description = "Allows users to log into your site using OpenID."
 version = VERSION
 package = Core - optional
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/openid/openid.install b/modules/openid/openid.install
index 8c4ac89..595310b 100644
--- a/modules/openid/openid.install
+++ b/modules/openid/openid.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: openid.install,v 1.3.2.2 2010/08/11 20:35:48 goba Exp $
 
 /**
  * Implementation of hook_install().
diff --git a/modules/openid/openid.js b/modules/openid/openid.js
index dea6d21..ce9de89 100644
--- a/modules/openid/openid.js
+++ b/modules/openid/openid.js
@@ -1,4 +1,3 @@
-// $Id: openid.js,v 1.6 2008/01/30 22:11:22 goba Exp $
 
 Drupal.behaviors.openid = function (context) {
   var $loginElements = $("#edit-name-wrapper, #edit-pass-wrapper, li.openid-link");
diff --git a/modules/openid/openid.module b/modules/openid/openid.module
index 0ac8674..b803d9d 100644
--- a/modules/openid/openid.module
+++ b/modules/openid/openid.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: openid.module,v 1.19.2.11 2010/08/11 20:35:48 goba Exp $
 
 /**
  * @file
diff --git a/modules/openid/openid.pages.inc b/modules/openid/openid.pages.inc
index 388734c..5ac1671 100644
--- a/modules/openid/openid.pages.inc
+++ b/modules/openid/openid.pages.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: openid.pages.inc,v 1.5.2.2 2009/09/16 19:34:14 goba Exp $
 
 /**
  * @file
diff --git a/modules/openid/xrds.inc b/modules/openid/xrds.inc
index dbed783..36f5282 100644
--- a/modules/openid/xrds.inc
+++ b/modules/openid/xrds.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: xrds.inc,v 1.2 2007/10/15 09:40:42 goba Exp $
 
 // Global variables to track parsing state
 $xrds_open_elements = array();
diff --git a/modules/path/path.admin.inc b/modules/path/path.admin.inc
index 6533202..dba0d03 100644
--- a/modules/path/path.admin.inc
+++ b/modules/path/path.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: path.admin.inc,v 1.7.2.1 2008/11/22 10:49:15 dries Exp $
 
 /**
  * @file
diff --git a/modules/path/path.info b/modules/path/path.info
index 47f5fbd..b34214c 100644
--- a/modules/path/path.info
+++ b/modules/path/path.info
@@ -1,12 +1,11 @@
-; $Id: path.info,v 1.4 2007/06/08 05:50:55 dries Exp $
 name = Path
 description = Allows users to rename URLs.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/path/path.module b/modules/path/path.module
index 5c66e06..a267fd6 100644
--- a/modules/path/path.module
+++ b/modules/path/path.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: path.module,v 1.138.2.3 2008/11/22 10:49:15 dries Exp $
 
 /**
  * @file
diff --git a/modules/php/php.info b/modules/php/php.info
index 3172b7a..cdd83f1 100644
--- a/modules/php/php.info
+++ b/modules/php/php.info
@@ -1,12 +1,11 @@
-; $Id: php.info,v 1.2 2007/06/08 05:50:55 dries Exp $
 name = PHP filter
 description = Allows embedded PHP code/snippets to be evaluated.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/php/php.install b/modules/php/php.install
index 2f15d29..b41d054 100644
--- a/modules/php/php.install
+++ b/modules/php/php.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: php.install,v 1.1 2007/04/24 10:54:34 dries Exp $
 
 /**
  * Implementation of hook_install().
diff --git a/modules/php/php.module b/modules/php/php.module
index 6408645..0533d43 100644
--- a/modules/php/php.module
+++ b/modules/php/php.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: php.module,v 1.8.2.1 2008/02/05 09:29:50 goba Exp $
 
 /**
  * @file
diff --git a/modules/ping/ping.info b/modules/ping/ping.info
index 7ded5ca..1fdd90f 100644
--- a/modules/ping/ping.info
+++ b/modules/ping/ping.info
@@ -1,12 +1,11 @@
-; $Id: ping.info,v 1.4 2007/06/08 05:50:55 dries Exp $
 name = Ping
 description = Alerts other sites when your site has been updated.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/ping/ping.module b/modules/ping/ping.module
index cca981a..6553960 100644
--- a/modules/ping/ping.module
+++ b/modules/ping/ping.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: ping.module,v 1.52.2.1 2009/11/06 07:46:22 goba Exp $
 
 /**
  * @file
diff --git a/modules/poll/poll-bar-block.tpl.php b/modules/poll/poll-bar-block.tpl.php
index cb5afb3..d5fbaee 100644
--- a/modules/poll/poll-bar-block.tpl.php
+++ b/modules/poll/poll-bar-block.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: poll-bar-block.tpl.php,v 1.2 2007/08/07 08:39:35 goba Exp $
 
 /**
  * @file poll-bar-block.tpl.php
diff --git a/modules/poll/poll-bar.tpl.php b/modules/poll/poll-bar.tpl.php
index 750c888..cb4dbc8 100644
--- a/modules/poll/poll-bar.tpl.php
+++ b/modules/poll/poll-bar.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: poll-bar.tpl.php,v 1.2 2007/08/07 08:39:35 goba Exp $
 
 /**
  * @file poll-bar.tpl.php
diff --git a/modules/poll/poll-results-block.tpl.php b/modules/poll/poll-results-block.tpl.php
index 051bf36..12ec6d9 100644
--- a/modules/poll/poll-results-block.tpl.php
+++ b/modules/poll/poll-results-block.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: poll-results-block.tpl.php,v 1.2 2007/08/02 20:08:53 dries Exp $
 /**
  * @file poll-results-block.tpl.php
  * Display the poll results in a block.
diff --git a/modules/poll/poll-results.tpl.php b/modules/poll/poll-results.tpl.php
index 25b1a3b..bb57f12 100644
--- a/modules/poll/poll-results.tpl.php
+++ b/modules/poll/poll-results.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: poll-results.tpl.php,v 1.2 2007/08/07 08:39:35 goba Exp $
 
 /**
  * @file poll-results-block.tpl.php
diff --git a/modules/poll/poll-rtl.css b/modules/poll/poll-rtl.css
index 3e78755..14d42e6 100644
--- a/modules/poll/poll-rtl.css
+++ b/modules/poll/poll-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: poll-rtl.css,v 1.2 2007/05/30 18:28:13 goba Exp $ */
 
 .poll .bar .foreground {
   float: right;
diff --git a/modules/poll/poll-vote.tpl.php b/modules/poll/poll-vote.tpl.php
index f43d7de..5ab1cb5 100644
--- a/modules/poll/poll-vote.tpl.php
+++ b/modules/poll/poll-vote.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: poll-vote.tpl.php,v 1.2 2007/08/07 08:39:35 goba Exp $
 
 /**
  * @file poll-vote.tpl.php
diff --git a/modules/poll/poll.css b/modules/poll/poll.css
index 3ab576f..7ee0beb 100644
--- a/modules/poll/poll.css
+++ b/modules/poll/poll.css
@@ -1,4 +1,3 @@
-/* $Id: poll.css,v 1.6 2008/01/22 07:47:57 goba Exp $ */
 
 .poll .bar {
   height: 1em;
diff --git a/modules/poll/poll.info b/modules/poll/poll.info
index 0f5be4a..89d73ac 100644
--- a/modules/poll/poll.info
+++ b/modules/poll/poll.info
@@ -1,12 +1,11 @@
-; $Id: poll.info,v 1.4 2007/06/08 05:50:55 dries Exp $
 name = Poll
 description = Allows your site to capture votes on different topics in the form of multiple choice questions.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/poll/poll.install b/modules/poll/poll.install
index 200c936..5dd977d 100644
--- a/modules/poll/poll.install
+++ b/modules/poll/poll.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: poll.install,v 1.13.2.1 2009/01/06 15:46:37 goba Exp $
 
 /**
  * Implementation of hook_install().
diff --git a/modules/poll/poll.module b/modules/poll/poll.module
index c1266ab..a312eca 100644
--- a/modules/poll/poll.module
+++ b/modules/poll/poll.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: poll.module,v 1.263.2.5 2010/05/11 12:40:43 goba Exp $
 
 /**
  * @file
diff --git a/modules/poll/poll.pages.inc b/modules/poll/poll.pages.inc
index ff4f4d6..e3fb5de 100644
--- a/modules/poll/poll.pages.inc
+++ b/modules/poll/poll.pages.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: poll.pages.inc,v 1.4 2007/12/14 09:50:41 goba Exp $
 
 /**
  * @file
diff --git a/modules/profile/profile-block.tpl.php b/modules/profile/profile-block.tpl.php
index 517b87c..174598c 100644
--- a/modules/profile/profile-block.tpl.php
+++ b/modules/profile/profile-block.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: profile-block.tpl.php,v 1.2 2007/08/07 08:39:35 goba Exp $
 
 /**
  * @file profile-block.tpl.php
diff --git a/modules/profile/profile-listing.tpl.php b/modules/profile/profile-listing.tpl.php
index 8f975c7..c0046d8 100644
--- a/modules/profile/profile-listing.tpl.php
+++ b/modules/profile/profile-listing.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: profile-listing.tpl.php,v 1.2 2007/08/07 08:39:35 goba Exp $
 
 /**
  * @file profile-listing.tpl.php
diff --git a/modules/profile/profile-wrapper.tpl.php b/modules/profile/profile-wrapper.tpl.php
index a8856ab..5b10d47 100644
--- a/modules/profile/profile-wrapper.tpl.php
+++ b/modules/profile/profile-wrapper.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: profile-wrapper.tpl.php,v 1.2 2007/08/07 08:39:35 goba Exp $
 
 /**
  * @file profile-wrapper.tpl.php
diff --git a/modules/profile/profile.admin.inc b/modules/profile/profile.admin.inc
index a0bc4e3..9a4bd2f 100644
--- a/modules/profile/profile.admin.inc
+++ b/modules/profile/profile.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: profile.admin.inc,v 1.8.2.2 2010/03/01 10:20:28 goba Exp $
 
 /**
  * @file
diff --git a/modules/profile/profile.css b/modules/profile/profile.css
index 4b02e7e..c3132f9 100644
--- a/modules/profile/profile.css
+++ b/modules/profile/profile.css
@@ -1,4 +1,3 @@
-/* $Id: profile.css,v 1.3 2007/11/30 09:02:51 goba Exp $ */
 
 #profile-fields td.category {
   font-weight: bold;
diff --git a/modules/profile/profile.info b/modules/profile/profile.info
index b252930..607cc4a 100644
--- a/modules/profile/profile.info
+++ b/modules/profile/profile.info
@@ -1,12 +1,11 @@
-; $Id: profile.info,v 1.4 2007/06/08 05:50:55 dries Exp $
 name = Profile
 description = Supports configurable user profiles.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/profile/profile.install b/modules/profile/profile.install
index e43695e..e2a7612 100644
--- a/modules/profile/profile.install
+++ b/modules/profile/profile.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: profile.install,v 1.12.2.1 2009/01/06 15:46:37 goba Exp $
 
 /**
  * Implementation of hook_install().
diff --git a/modules/profile/profile.js b/modules/profile/profile.js
index 21936ec..7661d23 100644
--- a/modules/profile/profile.js
+++ b/modules/profile/profile.js
@@ -1,4 +1,3 @@
-// $Id: profile.js,v 1.2 2007/12/08 14:06:22 goba Exp $
 
 /**
  * Add functionality to the profile drag and drop table.
diff --git a/modules/profile/profile.module b/modules/profile/profile.module
index 89c949a..e8c0539 100644
--- a/modules/profile/profile.module
+++ b/modules/profile/profile.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: profile.module,v 1.236.2.3 2009/01/12 10:09:19 goba Exp $
 
 /**
  * @file
diff --git a/modules/profile/profile.pages.inc b/modules/profile/profile.pages.inc
index e64ceff..da1b8c5 100644
--- a/modules/profile/profile.pages.inc
+++ b/modules/profile/profile.pages.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: profile.pages.inc,v 1.2 2007/12/08 14:06:22 goba Exp $
 
 /**
  * @file
diff --git a/modules/search/search-block-form.tpl.php b/modules/search/search-block-form.tpl.php
index 8a70145..2de4bfa 100644
--- a/modules/search/search-block-form.tpl.php
+++ b/modules/search/search-block-form.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: search-block-form.tpl.php,v 1.1 2007/10/31 18:06:38 dries Exp $
 
 /**
  * @file search-block-form.tpl.php
diff --git a/modules/search/search-result.tpl.php b/modules/search/search-result.tpl.php
index a16faa8..78c0d34 100644
--- a/modules/search/search-result.tpl.php
+++ b/modules/search/search-result.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: search-result.tpl.php,v 1.1.2.1 2008/08/28 08:21:44 dries Exp $
 
 /**
  * @file search-result.tpl.php
diff --git a/modules/search/search-results.tpl.php b/modules/search/search-results.tpl.php
index 03907d9..f2d95d4 100644
--- a/modules/search/search-results.tpl.php
+++ b/modules/search/search-results.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: search-results.tpl.php,v 1.1 2007/10/31 18:06:38 dries Exp $
 
 /**
  * @file search-results.tpl.php
diff --git a/modules/search/search-rtl.css b/modules/search/search-rtl.css
index 8f3c150..fb22300 100644
--- a/modules/search/search-rtl.css
+++ b/modules/search/search-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: search-rtl.css,v 1.3 2007/11/27 12:09:26 goba Exp $ */
 
 .search-advanced .criterion {
   float: right;
diff --git a/modules/search/search-theme-form.tpl.php b/modules/search/search-theme-form.tpl.php
index 0b05d40..ab1e97e 100644
--- a/modules/search/search-theme-form.tpl.php
+++ b/modules/search/search-theme-form.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: search-theme-form.tpl.php,v 1.1 2007/10/31 18:06:38 dries Exp $
 
 /**
  * @file search-theme-form.tpl.php
diff --git a/modules/search/search.admin.inc b/modules/search/search.admin.inc
index 4c21695..3b374bb 100644
--- a/modules/search/search.admin.inc
+++ b/modules/search/search.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: search.admin.inc,v 1.4 2008/01/08 10:35:42 goba Exp $
 
 /**
  * @file
diff --git a/modules/search/search.css b/modules/search/search.css
index ab88636..a6eccc9 100644
--- a/modules/search/search.css
+++ b/modules/search/search.css
@@ -1,4 +1,3 @@
-/* $Id: search.css,v 1.3 2007/10/31 18:06:38 dries Exp $ */
 
 .search-form {
   margin-bottom: 1em;
diff --git a/modules/search/search.info b/modules/search/search.info
index 44605cb..bbfb6d4 100644
--- a/modules/search/search.info
+++ b/modules/search/search.info
@@ -1,12 +1,11 @@
-; $Id: search.info,v 1.4 2007/06/08 05:50:55 dries Exp $
 name = Search
 description = Enables site-wide keyword searching.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/search/search.install b/modules/search/search.install
index e9e4f4e..0d9d748 100644
--- a/modules/search/search.install
+++ b/modules/search/search.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: search.install,v 1.14.2.1 2009/01/06 15:46:37 goba Exp $
 
 /**
  * Implementation of hook_install().
diff --git a/modules/search/search.module b/modules/search/search.module
index d33cefe..a0860d4 100644
--- a/modules/search/search.module
+++ b/modules/search/search.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: search.module,v 1.250.2.11 2010/08/06 11:18:01 goba Exp $
 
 /**
  * @file
@@ -911,7 +910,7 @@ function _search_parse_query(&$word, &$scores, $not = FALSE) {
  *              Default: 'ORDER BY score DESC'
  *
  * @return
- *   An array of SIDs for the search results.
+ *   An array of objects for the search results.
  *
  * @ingroup search
  */
@@ -1018,7 +1017,7 @@ function search_get_keys() {
  * @param $prompt
  *   A piece of text to put before the form (e.g. "Enter your keywords")
  * @return
- *   An HTML string containing the search form.
+ *   A Form API array for the search form.
  */
 function search_form(&$form_state, $action = '', $keys = '', $type = NULL, $prompt = NULL) {
 
diff --git a/modules/search/search.pages.inc b/modules/search/search.pages.inc
index 5879425..9faa1c9 100644
--- a/modules/search/search.pages.inc
+++ b/modules/search/search.pages.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: search.pages.inc,v 1.4 2007/12/06 09:51:01 goba Exp $
 
 /**
  * @file
diff --git a/modules/statistics/statistics.admin.inc b/modules/statistics/statistics.admin.inc
index bfe9b3c..f69d6a9 100644
--- a/modules/statistics/statistics.admin.inc
+++ b/modules/statistics/statistics.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: statistics.admin.inc,v 1.6.2.2 2010/06/02 12:14:48 goba Exp $
 
 /**
  * @file
diff --git a/modules/statistics/statistics.info b/modules/statistics/statistics.info
index 8d80be0..2969d87 100644
--- a/modules/statistics/statistics.info
+++ b/modules/statistics/statistics.info
@@ -1,12 +1,11 @@
-; $Id: statistics.info,v 1.4 2007/06/08 05:50:56 dries Exp $
 name = Statistics
 description = Logs access statistics for your site.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/statistics/statistics.install b/modules/statistics/statistics.install
index 4ae25b2..515796a 100644
--- a/modules/statistics/statistics.install
+++ b/modules/statistics/statistics.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: statistics.install,v 1.13.2.3 2009/09/14 08:19:24 goba Exp $
 
 /**
  * Implementation of hook_install().
diff --git a/modules/statistics/statistics.module b/modules/statistics/statistics.module
index 30561b2..ba964ef 100644
--- a/modules/statistics/statistics.module
+++ b/modules/statistics/statistics.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: statistics.module,v 1.272.2.2 2010/06/02 12:14:48 goba Exp $
 
 /**
  * @file
diff --git a/modules/statistics/statistics.pages.inc b/modules/statistics/statistics.pages.inc
index 9b0633e..f10e81c 100644
--- a/modules/statistics/statistics.pages.inc
+++ b/modules/statistics/statistics.pages.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: statistics.pages.inc,v 1.2.2.1 2009/04/27 12:08:29 goba Exp $
 
 /**
  * @file
diff --git a/modules/syslog/syslog.info b/modules/syslog/syslog.info
index 8be2dfc..560c73f 100644
--- a/modules/syslog/syslog.info
+++ b/modules/syslog/syslog.info
@@ -1,12 +1,11 @@
-; $Id: syslog.info,v 1.2 2007/06/08 05:50:56 dries Exp $
 name = Syslog
 description = Logs and records system events to syslog.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/syslog/syslog.install b/modules/syslog/syslog.install
new file mode 100644
index 0000000..12ff4fb
--- /dev/null
+++ b/modules/syslog/syslog.install
@@ -0,0 +1,15 @@
+<?php
+
+/**
+ * @file
+ * Install, update and uninstall functions for the syslog module.
+ */
+
+/**
+ * Implements hook_uninstall().
+ */
+function syslog_uninstall() {
+  variable_del('syslog_identity');
+  variable_del('syslog_facility');
+  variable_del('syslog_format');
+}
diff --git a/modules/syslog/syslog.module b/modules/syslog/syslog.module
index 912fba9..ad2929d 100644
--- a/modules/syslog/syslog.module
+++ b/modules/syslog/syslog.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: syslog.module,v 1.14.2.2 2008/07/24 06:52:43 dries Exp $
 
 /**
  * @file
@@ -38,6 +37,13 @@ function syslog_menu() {
 }
 
 function syslog_admin_settings() {
+  $form['syslog_identity'] = array(
+    '#type'          => 'textfield',
+    '#title'         => t('Syslog identity'),
+    '#default_value' => variable_get('syslog_identity', 'drupal'),
+    '#description'   => t('A string that will be prepended to every message logged to Syslog. If you have multiple sites logging to the same Syslog log file, a unique identity per site makes it easy to tell the log entries apart. For more information on syslog, see <a href="@syslog_help">Syslog help</a>.', array(
+      '@syslog_help' => url('admin/help/syslog'))),
+  );
   $form['syslog_facility'] = array(
     '#type'          => 'select',
     '#title'         => t('Send events to this syslog facility'),
@@ -73,7 +79,7 @@ function syslog_watchdog($entry) {
 
   if (!$log_init) {
     $log_init = TRUE;
-    openlog('drupal', LOG_NDELAY, variable_get('syslog_facility', DEFAULT_SYSLOG_FACILITY));
+    openlog(variable_get('syslog_identity', 'drupal'), LOG_NDELAY, variable_get('syslog_facility', DEFAULT_SYSLOG_FACILITY));
   }
 
   syslog($entry['severity'], theme('syslog_format', $entry));
diff --git a/modules/system/admin-rtl.css b/modules/system/admin-rtl.css
index 721b75b..4a9ee2c 100644
--- a/modules/system/admin-rtl.css
+++ b/modules/system/admin-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: admin-rtl.css,v 1.5 2007/12/22 23:24:25 goba Exp $ */
 
 div.admin-panel .body {
   padding: 0 8px 2px 4px;
diff --git a/modules/system/admin.css b/modules/system/admin.css
index b5b1fd3..3d5c52f 100644
--- a/modules/system/admin.css
+++ b/modules/system/admin.css
@@ -1,4 +1,3 @@
-/* $Id: admin.css,v 1.18.2.1 2008/04/25 21:01:54 goba Exp $ */
 
 /*
 ** Formatting for administration page
diff --git a/modules/system/block.tpl.php b/modules/system/block.tpl.php
index eb3c629..0f7f1e1 100644
--- a/modules/system/block.tpl.php
+++ b/modules/system/block.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: block.tpl.php,v 1.4 2007/09/01 05:42:48 dries Exp $
 
 /**
  * @file block.tpl.php
diff --git a/modules/system/box.tpl.php b/modules/system/box.tpl.php
index 1d08ee9..ac4df35 100644
--- a/modules/system/box.tpl.php
+++ b/modules/system/box.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: box.tpl.php,v 1.3 2007/12/16 21:01:45 goba Exp $
 
 /**
  * @file box.tpl.php
diff --git a/modules/system/defaults-rtl.css b/modules/system/defaults-rtl.css
index 4280bc1..924ac5f 100644
--- a/modules/system/defaults-rtl.css
+++ b/modules/system/defaults-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: defaults-rtl.css,v 1.3 2007/11/27 12:09:26 goba Exp $ */
 
 th {
   text-align: right;
diff --git a/modules/system/defaults.css b/modules/system/defaults.css
index 2d4e539..eb983b7 100644
--- a/modules/system/defaults.css
+++ b/modules/system/defaults.css
@@ -1,4 +1,3 @@
-/* $Id: defaults.css,v 1.5 2007/10/02 12:10:40 dries Exp $ */
 
 /*
 ** HTML elements
diff --git a/modules/system/maintenance-page.tpl.php b/modules/system/maintenance-page.tpl.php
index 5360f62..750c1e2 100644
--- a/modules/system/maintenance-page.tpl.php
+++ b/modules/system/maintenance-page.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: maintenance-page.tpl.php,v 1.2.2.1 2009/04/30 00:13:31 goba Exp $
 
 /**
  * @file maintenance-page.tpl.php
diff --git a/modules/system/maintenance.css b/modules/system/maintenance.css
index 3ac4d57..c234932 100644
--- a/modules/system/maintenance.css
+++ b/modules/system/maintenance.css
@@ -1,4 +1,3 @@
-/* $Id: maintenance.css,v 1.1 2007/11/30 12:19:10 goba Exp $ */
 
 /* Update styles */
 #update-results {
diff --git a/modules/system/page.tpl.php b/modules/system/page.tpl.php
index a2afa66..c9ff36c 100644
--- a/modules/system/page.tpl.php
+++ b/modules/system/page.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: page.tpl.php,v 1.11.2.2 2010/08/06 11:13:42 goba Exp $
 
 /**
  * @file
diff --git a/modules/system/system-menus-rtl.css b/modules/system/system-menus-rtl.css
index b34be52..3b92bfb 100644
--- a/modules/system/system-menus-rtl.css
+++ b/modules/system/system-menus-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: system-menus-rtl.css,v 1.1 2007/10/05 14:50:25 goba Exp $ */
 
 ul.menu {
   text-align:right;
diff --git a/modules/system/system-menus.css b/modules/system/system-menus.css
index 237013f..05eb2de 100644
--- a/modules/system/system-menus.css
+++ b/modules/system/system-menus.css
@@ -1,4 +1,3 @@
-/* $Id: system-menus.css,v 1.1 2007/10/05 14:50:25 goba Exp $ */
 
 ul.menu {
   list-style: none;
diff --git a/modules/system/system-rtl.css b/modules/system/system-rtl.css
index 5c7790d..a0fc51e 100644
--- a/modules/system/system-rtl.css
+++ b/modules/system/system-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: system-rtl.css,v 1.12 2008/01/10 18:08:19 goba Exp $ */
 
 thead th {
   text-align: right;
diff --git a/modules/system/system.admin.inc b/modules/system/system.admin.inc
index 7f0aae9..b7c8df4 100644
--- a/modules/system/system.admin.inc
+++ b/modules/system/system.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: system.admin.inc,v 1.63.2.14 2010/03/01 10:20:28 goba Exp $
 
 /**
  * @file
@@ -62,6 +61,7 @@ function system_main_admin_page($arg = NULL) {
 
 /**
  * Provide a single block from the administration menu as a page.
+ *
  * This function is often a destination for these blocks.
  * For example, 'admin/content/types' needs to have a destination to be valid
  * in the Drupal menu system, but too much information there might be
@@ -503,17 +503,6 @@ function system_theme_settings(&$form_state, $key = '') {
   }
 
   if ($key) {
-    // Include the theme's theme-settings.php file
-    $filename = './'. str_replace("/$key.info", '', $themes[$key]->filename) .'/theme-settings.php';
-    if (!file_exists($filename) and !empty($themes[$key]->info['base theme'])) {
-      // If the theme doesn't have a theme-settings.php file, use the base theme's.
-      $base = $themes[$key]->info['base theme'];
-      $filename = './'. str_replace("/$base.info", '', $themes[$base]->filename) .'/theme-settings.php';
-    }
-    if (file_exists($filename)) {
-      require_once $filename;
-    }
-
     // Call engine-specific settings.
     $function = $themes[$key]->prefix .'_engine_settings';
     if (function_exists($function)) {
@@ -523,16 +512,36 @@ function system_theme_settings(&$form_state, $key = '') {
         $form['engine_specific'] = array_merge($form['engine_specific'], $group);
       }
     }
-    // Call theme-specific settings.
-    $function = $key .'_settings';
-    if (!function_exists($function)) {
-      $function = $themes[$key]->prefix .'_settings';
+
+    // Create a list which includes the current theme and all its base themes.
+    if (isset($themes[$key]->base_themes)) {
+      $theme_keys = array_keys($themes[$key]->base_themes);
+      $theme_keys[] = $key;
     }
-    if (function_exists($function)) {
-      $group = $function($settings);
-      if (!empty($group)) {
-        $form['theme_specific'] = array('#type' => 'fieldset', '#title' => t('Theme-specific settings'), '#description' => t('These settings only exist for the %theme theme and all the styles based on it.', array('%theme' => $themes[$key]->info['name'])));
-        $form['theme_specific'] = array_merge($form['theme_specific'], $group);
+    else {
+      $theme_keys = array($key);
+    }
+
+    // Process the theme and all its base themes.
+    foreach ($theme_keys as $theme) {
+      // Include the theme-settings.php file.
+      $filename = './'. str_replace("/$theme.info", '', $themes[$theme]->filename) .'/theme-settings.php';
+      if (file_exists($filename)) {
+        require_once $filename;
+      }
+
+      $function = $theme .'_settings';
+      if (!function_exists($function)) {
+        $function = $themes[$theme]->prefix .'_settings';
+      }
+      if (function_exists($function)) {
+        $group = $function($settings);
+        if (!empty($group)) {
+          $form['theme_specific']['#type'] = 'fieldset';
+          $form['theme_specific']['#title'] = t('Theme-specific settings');
+          $form['theme_specific']['#description'] = t('These settings only exist for the %theme theme and all the styles based on it.', array('%theme' => $themes[$theme]->info['name']));
+          $form['theme_specific'] = array_merge($form['theme_specific'], $group);
+        }
       }
     }
   }
@@ -629,21 +638,22 @@ function system_modules($form_state = array()) {
   $files = module_rebuild_cache();
 
   // Remove hidden modules from display list.
-  foreach ($files as $filename => $file) {
+  $visible_files = $files;
+  foreach ($visible_files as $filename => $file) {
     if (!empty($file->info['hidden'])) {
-      unset($files[$filename]);
+      unset($visible_files[$filename]);
     }
   }
 
-  uasort($files, 'system_sort_modules_by_info_name');
+  uasort($visible_files, 'system_sort_modules_by_info_name');
 
   if (!empty($form_state['storage'])) {
-    return system_modules_confirm_form($files, $form_state['storage']);
+    return system_modules_confirm_form($visible_files, $form_state['storage']);
   }
   $dependencies = array();
 
   // Store module list for validation callback.
-  $form['validation_modules'] = array('#type' => 'value', '#value' => $files);
+  $form['validation_modules'] = array('#type' => 'value', '#value' => $visible_files);
 
   // Create storage for disabled modules as browser will disable checkboxes.
   $form['disabled_modules'] = array('#type' => 'value', '#value' => array());
@@ -651,7 +661,7 @@ function system_modules($form_state = array()) {
   // Traverse the files, checking for compatibility
   $incompatible_core = array();
   $incompatible_php = array();
-  foreach ($files as $filename => $file) {
+  foreach ($visible_files as $filename => $file) {
     // Ensure this module is compatible with this version of core.
     if (!isset($file->info['core']) || $file->info['core'] != DRUPAL_CORE_COMPATIBILITY) {
       $incompatible_core[$file->name] = $file->name;
@@ -666,7 +676,7 @@ function system_modules($form_state = array()) {
   $disabled = array();
   $throttle = array();
   // Traverse the files retrieved and build the form.
-  foreach ($files as $filename => $file) {
+  foreach ($visible_files as $filename => $file) {
     $form['name'][$filename] = array('#value' => $file->info['name']);
     $form['version'][$filename] = array('#value' => $file->info['version']);
     $form['description'][$filename] = array('#value' => t($file->info['description']));
@@ -688,19 +698,20 @@ function system_modules($form_state = array()) {
     // Check for missing dependencies.
     if (is_array($file->info['dependencies'])) {
       foreach ($file->info['dependencies'] as $dependency) {
-        if (!isset($files[$dependency]) || !$files[$dependency]->status) {
-          if (isset($files[$dependency])) {
-            $dependencies[] = t('@module (<span class="admin-disabled">disabled</span>)', array('@module' => $files[$dependency]->info['name']));
+        if (!isset($files[$dependency])) {
+          $dependencies[] = t('@module (<span class="admin-missing">missing</span>)', array('@module' => drupal_ucfirst($dependency)));
+          $disabled[] = $filename;
+          $form['disabled_modules']['#value'][$filename] = FALSE;
+        }
+        // Only display visible modules.
+        elseif (isset($visible_files[$dependency])) {
+          if ($files[$dependency]->status) {
+            $dependencies[] = t('@module (<span class="admin-enabled">enabled</span>)', array('@module' => $files[$dependency]->info['name']));
           }
           else {
-            $dependencies[] = t('@module (<span class="admin-missing">missing</span>)', array('@module' => drupal_ucfirst($dependency)));
-            $disabled[] = $filename;
-            $form['disabled_modules']['#value'][$filename] = FALSE;
+            $dependencies[] = t('@module (<span class="admin-disabled">disabled</span>)', array('@module' => $files[$dependency]->info['name']));
           }
         }
-        else {
-          $dependencies[] = t('@module (<span class="admin-enabled">enabled</span>)', array('@module' => $files[$dependency]->info['name']));
-        }
       }
 
       // Add text for dependencies.
@@ -716,13 +727,16 @@ function system_modules($form_state = array()) {
     // Mark dependents disabled so user can not remove modules being depended on.
     $dependents = array();
     foreach ($file->info['dependents'] as $dependent) {
-      if ($files[$dependent]->status == 1) {
-        $dependents[] = t('@module (<span class="admin-enabled">enabled</span>)', array('@module' => $files[$dependent]->info['name']));
-        $disabled[] = $filename;
-        $form['disabled_modules']['#value'][$filename] = TRUE;
-      }
-      else {
-        $dependents[] = t('@module (<span class="admin-disabled">disabled</span>)', array('@module' => $files[$dependent]->info['name']));
+      // Hidden modules are unset already.
+      if (isset($visible_files[$dependent])) {
+        if ($files[$dependent]->status == 1) {
+          $dependents[] = t('@module (<span class="admin-enabled">enabled</span>)', array('@module' => $files[$dependent]->info['name']));
+          $disabled[] = $filename;
+          $form['disabled_modules']['#value'][$filename] = TRUE;
+        }
+        else {
+          $dependents[] = t('@module (<span class="admin-disabled">disabled</span>)', array('@module' => $files[$dependent]->info['name']));
+        }
       }
     }
 
diff --git a/modules/system/system.css b/modules/system/system.css
index 4bc92f2..9371bb4 100644
--- a/modules/system/system.css
+++ b/modules/system/system.css
@@ -1,4 +1,3 @@
-/* $Id: system.css,v 1.48 2008/01/09 09:56:39 goba Exp $ */
 
 /*
 ** HTML elements
@@ -189,7 +188,7 @@ dl.multiselect dd.b, dl.multiselect dd.b .form-item, dl.multiselect dd.b select
   width: 14em;
 }
 dl.multiselect dd.a, dl.multiselect dd.a .form-item {
-  width: 8em;
+  width: 10em;
 }
 dl.multiselect dt, dl.multiselect dd {
   float: left; /* LTR */
diff --git a/modules/system/system.info b/modules/system/system.info
index c4213b7..47292aa 100644
--- a/modules/system/system.info
+++ b/modules/system/system.info
@@ -1,12 +1,11 @@
-; $Id: system.info,v 1.4 2007/06/08 05:50:56 dries Exp $
 name = System
 description = Handles general site configuration for administrators.
 package = Core - required
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/system/system.install b/modules/system/system.install
index 4c92026..bb47862 100644
--- a/modules/system/system.install
+++ b/modules/system/system.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: system.install,v 1.238.2.24 2010/08/06 10:54:12 goba Exp $
 
 /**
  * Test and report Drupal installation requirements.
@@ -2686,27 +2685,31 @@ function system_update_6054() {
     db_drop_table($ret, 'pf_semaphore');
   }
 
-  $schema['semaphore'] = array(
-    'fields' => array(
-      'name' => array(
-        'type' => 'varchar',
-        'length' => 255,
-        'not null' => TRUE,
-        'default' => ''),
-      'value' => array(
-        'type' => 'varchar',
-        'length' => 255,
-        'not null' => TRUE,
-        'default' => ''),
-      'expire' => array(
-        'type' => 'float',
-        'size' => 'big',
-        'not null' => TRUE),
-      ),
-    'indexes' => array('expire' => array('expire')),
-    'primary key' => array('name'),
-  );
-  db_create_table($ret, 'semaphore', $schema['semaphore']);
+  // The table may have already been added by update_fix_d6_requirements(), so
+  // check for its existence before creating.
+  if (!db_table_exists('semaphore')) {
+    $schema['semaphore'] = array(
+      'fields' => array(
+        'name' => array(
+          'type' => 'varchar',
+          'length' => 255,
+          'not null' => TRUE,
+          'default' => ''),
+        'value' => array(
+          'type' => 'varchar',
+          'length' => 255,
+          'not null' => TRUE,
+          'default' => ''),
+        'expire' => array(
+          'type' => 'float',
+          'size' => 'big',
+          'not null' => TRUE),
+        ),
+      'indexes' => array('expire' => array('expire')),
+      'primary key' => array('name'),
+    );
+    db_create_table($ret, 'semaphore', $schema['semaphore']);
+  }
 
   return $ret;
 }
diff --git a/modules/system/system.js b/modules/system/system.js
index 7217a4b..48fd016 100644
--- a/modules/system/system.js
+++ b/modules/system/system.js
@@ -1,4 +1,3 @@
-// $Id: system.js,v 1.14.2.2 2009/07/21 08:59:12 goba Exp $
 
 /**
  * Internal function to check using Ajax if clean URLs can be enabled on the
diff --git a/modules/system/system.module b/modules/system/system.module
index e7f8ca6..5282418 100644
--- a/modules/system/system.module
+++ b/modules/system/system.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: system.module,v 1.585.2.54 2010/08/11 20:35:48 goba Exp $
 
 /**
  * @file
@@ -9,7 +8,7 @@
 /**
  * The current system version.
  */
-define('VERSION', '6.19');
+define('VERSION', '6.22');
 
 /**
  * Core API compatibility.
@@ -920,7 +919,13 @@ function _system_theme_data() {
     $themes_info = $themes;
   }
 
-  return $themes_info;
+  // To avoid side effects, we don't return the original objects.
+  $themes_info_cloned = array();
+  foreach ($themes_info as $key => $theme) {
+    $themes_info_cloned[$key] = drupal_clone($theme);
+  }
+
+  return $themes_info_cloned;
 }
 
 /**
@@ -1923,7 +1928,7 @@ function _system_zonelist() {
  */
 function system_check_http_request() {
   // Try to get the content of the front page via drupal_http_request().
-  $result = drupal_http_request(url('', array('absolute' => TRUE)));
+  $result = drupal_http_request(url('', array('absolute' => TRUE)), array(), 'GET', NULL, 0);
   // We only care that we get a http response - this means that Drupal
   // can make a http request.
   $works = isset($result->code) && ($result->code >= 100) && ($result->code < 600);
diff --git a/modules/taxonomy/taxonomy.admin.inc b/modules/taxonomy/taxonomy.admin.inc
index 2fa542b..4bd58b5 100644
--- a/modules/taxonomy/taxonomy.admin.inc
+++ b/modules/taxonomy/taxonomy.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: taxonomy.admin.inc,v 1.22.2.4 2010/05/28 16:16:45 goba Exp $
 
 /**
  * @file
diff --git a/modules/taxonomy/taxonomy.css b/modules/taxonomy/taxonomy.css
index 4240850..36cd641 100644
--- a/modules/taxonomy/taxonomy.css
+++ b/modules/taxonomy/taxonomy.css
@@ -1,4 +1,3 @@
-/* $Id: taxonomy.css,v 1.5 2008/01/25 21:20:26 goba Exp $ */
 
 tr.taxonomy-term-preview {
   background-color: #EEE;
diff --git a/modules/taxonomy/taxonomy.info b/modules/taxonomy/taxonomy.info
index f07b326..1bcb759 100644
--- a/modules/taxonomy/taxonomy.info
+++ b/modules/taxonomy/taxonomy.info
@@ -1,12 +1,11 @@
-; $Id: taxonomy.info,v 1.4 2007/06/08 05:50:56 dries Exp $
 name = Taxonomy
 description = Enables the categorization of content.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/taxonomy/taxonomy.install b/modules/taxonomy/taxonomy.install
index c96f442..5ae3650 100644
--- a/modules/taxonomy/taxonomy.install
+++ b/modules/taxonomy/taxonomy.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: taxonomy.install,v 1.7.2.1 2009/01/06 15:46:38 goba Exp $
 
 /**
  * Implementation of hook_schema().
diff --git a/modules/taxonomy/taxonomy.js b/modules/taxonomy/taxonomy.js
index 5c19b2a..34ae84a 100644
--- a/modules/taxonomy/taxonomy.js
+++ b/modules/taxonomy/taxonomy.js
@@ -1,4 +1,3 @@
-// $Id: taxonomy.js,v 1.2 2007/12/16 10:36:53 goba Exp $
 
 /**
  * Move a block in the blocks table from one region to another via select list.
diff --git a/modules/taxonomy/taxonomy.module b/modules/taxonomy/taxonomy.module
index 20c367b..add3f69 100644
--- a/modules/taxonomy/taxonomy.module
+++ b/modules/taxonomy/taxonomy.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: taxonomy.module,v 1.414.2.16 2010/08/06 11:10:57 goba Exp $
 
 /**
  * @file
diff --git a/modules/taxonomy/taxonomy.pages.inc b/modules/taxonomy/taxonomy.pages.inc
index a912191..cc54390 100644
--- a/modules/taxonomy/taxonomy.pages.inc
+++ b/modules/taxonomy/taxonomy.pages.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: taxonomy.pages.inc,v 1.9.2.1 2009/04/27 11:49:05 goba Exp $
 
 /**
  * @file
diff --git a/modules/throttle/throttle.admin.inc b/modules/throttle/throttle.admin.inc
index 7c0ef41..367009a 100644
--- a/modules/throttle/throttle.admin.inc
+++ b/modules/throttle/throttle.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: throttle.admin.inc,v 1.2 2008/01/08 10:35:43 goba Exp $
 
 /**
  * @file
diff --git a/modules/throttle/throttle.info b/modules/throttle/throttle.info
index 116e7e4..f4f3eb7 100644
--- a/modules/throttle/throttle.info
+++ b/modules/throttle/throttle.info
@@ -1,12 +1,11 @@
-; $Id: throttle.info,v 1.4 2007/06/08 05:50:57 dries Exp $
 name = Throttle
 description = Handles the auto-throttling mechanism, to control site congestion.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/throttle/throttle.module b/modules/throttle/throttle.module
index 688315b..ecb57aa 100644
--- a/modules/throttle/throttle.module
+++ b/modules/throttle/throttle.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: throttle.module,v 1.83 2007/12/14 18:08:49 goba Exp $
 
 /**
  * @file
diff --git a/modules/tracker/tracker.css b/modules/tracker/tracker.css
index de38ba8..138be88 100644
--- a/modules/tracker/tracker.css
+++ b/modules/tracker/tracker.css
@@ -1,4 +1,3 @@
-/* $Id: tracker.css,v 1.1 2006/08/14 07:14:50 drumm Exp $ */
 
 #tracker td.replies {
   text-align: center;
diff --git a/modules/tracker/tracker.info b/modules/tracker/tracker.info
index cd833ad..ea4cdad 100644
--- a/modules/tracker/tracker.info
+++ b/modules/tracker/tracker.info
@@ -1,4 +1,3 @@
-; $Id: tracker.info,v 1.5 2007/07/04 10:54:26 goba Exp $
 name = Tracker
 description = Enables tracking of recent posts for users.
 dependencies[] = comment
@@ -6,8 +5,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/tracker/tracker.module b/modules/tracker/tracker.module
index 14db39e..18726c0 100644
--- a/modules/tracker/tracker.module
+++ b/modules/tracker/tracker.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: tracker.module,v 1.154.2.1 2008/04/09 21:11:51 goba Exp $
 
 /**
  * @file
diff --git a/modules/tracker/tracker.pages.inc b/modules/tracker/tracker.pages.inc
index 4ee2060..64c9383 100644
--- a/modules/tracker/tracker.pages.inc
+++ b/modules/tracker/tracker.pages.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: tracker.pages.inc,v 1.5 2007/11/28 10:29:20 dries Exp $
 
 /**
  * @file
diff --git a/modules/translation/translation.info b/modules/translation/translation.info
index 2a7ee81..776a206 100644
--- a/modules/translation/translation.info
+++ b/modules/translation/translation.info
@@ -1,4 +1,3 @@
-; $Id: translation.info,v 1.1 2007/06/15 18:40:14 goba Exp $
 name = Content translation
 description = Allows content to be translated into different languages.
 dependencies[] = locale
@@ -6,8 +5,8 @@ package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/translation/translation.module b/modules/translation/translation.module
index 8d560a2..a701e1a 100644
--- a/modules/translation/translation.module
+++ b/modules/translation/translation.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: translation.module,v 1.23.2.4 2009/01/14 23:34:07 goba Exp $
 
 /**
  * @file
@@ -163,7 +162,7 @@ function translation_link($type, $node = NULL, $teaser = FALSE) {
     unset($translations[$node->language]);
     $languages = language_list();
     foreach ($languages as $langcode => $language) {
-      if (isset($translations[$langcode])) {
+      if (isset($translations[$langcode]) && $translations[$langcode]->status) {
         $links["node_translation_$langcode"] = array(
           'title' => $language->native,
           'href' => 'node/'. $translations[$langcode]->nid,
@@ -227,6 +226,7 @@ function translation_nodeapi(&$node, $op, $teaser, $page) {
           db_query("UPDATE {node} SET tnid = %d, translate = %d WHERE nid = %d", $tnid, 0, $node->translation_source->nid);
         }
         db_query("UPDATE {node} SET tnid = %d, translate = %d WHERE nid = %d", $tnid, 0, $node->nid);
+        $node->tnid = $tnid;
       }
       break;
 
@@ -289,7 +289,7 @@ function translation_node_get_translations($tnid) {
   if (is_numeric($tnid) && $tnid) {
     if (!isset($translations[$tnid])) {
       $translations[$tnid] = array();
-      $result = db_query(db_rewrite_sql('SELECT n.nid, n.title, n.language FROM {node} n WHERE n.tnid = %d'), $tnid);
+      $result = db_query(db_rewrite_sql('SELECT n.nid, n.type, n.uid, n.status, n.title, n.language FROM {node} n WHERE n.tnid = %d'), $tnid);
       while ($node = db_fetch_object($result)) {
         $translations[$tnid][$node->language] = $node;
       }
@@ -336,8 +336,12 @@ function translation_path_get_translations($path) {
  */
 function translation_translation_link_alter(&$links, $path) {
   if ($paths = translation_path_get_translations($path)) {
+    // Path can only start with "node/$nid" or "node/$nid/" here.
+    $path = explode('/', $path);
+    $node = node_load($path[1]);
+    $translations = translation_node_get_translations($node->tnid);  
     foreach ($links as $langcode => $link) {
-      if (isset($paths[$langcode])) {
+      if (isset($paths[$langcode]) && $translations[$langcode]->status) {
         // Translation in a different node.
         $links[$langcode]['href'] = $paths[$langcode];
       }
diff --git a/modules/translation/translation.pages.inc b/modules/translation/translation.pages.inc
index 5a39fae..ad0fac0 100644
--- a/modules/translation/translation.pages.inc
+++ b/modules/translation/translation.pages.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: translation.pages.inc,v 1.2.2.1 2008/09/30 10:50:43 goba Exp $
 
 /**
  * @file
diff --git a/modules/trigger/trigger.admin.inc b/modules/trigger/trigger.admin.inc
index d329b11..2201c7e 100644
--- a/modules/trigger/trigger.admin.inc
+++ b/modules/trigger/trigger.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: trigger.admin.inc,v 1.5.2.1 2010/08/11 20:35:48 goba Exp $
 
 /**
  * @file
diff --git a/modules/trigger/trigger.info b/modules/trigger/trigger.info
index 6e35a6f..a662ba0 100644
--- a/modules/trigger/trigger.info
+++ b/modules/trigger/trigger.info
@@ -1,12 +1,11 @@
-; $Id: trigger.info,v 1.1 2007/09/11 14:50:05 goba Exp $
 name = Trigger
 description = Enables actions to be fired on certain system events, such as when new content is created.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/trigger/trigger.install b/modules/trigger/trigger.install
index 5107c86..5d78dd1 100644
--- a/modules/trigger/trigger.install
+++ b/modules/trigger/trigger.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: trigger.install,v 1.5.2.1 2009/01/06 15:46:38 goba Exp $
 
 /**
  * Implementation of hook_install().
diff --git a/modules/trigger/trigger.module b/modules/trigger/trigger.module
index 8a64381..7c7ff4b 100644
--- a/modules/trigger/trigger.module
+++ b/modules/trigger/trigger.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: trigger.module,v 1.13.2.4 2010/06/30 09:38:50 goba Exp $
 
 /**
  * @file
diff --git a/modules/update/update-rtl.css b/modules/update/update-rtl.css
index 623e76a..5fc83d1 100644
--- a/modules/update/update-rtl.css
+++ b/modules/update/update-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: update-rtl.css,v 1.3 2007/11/27 16:22:22 goba Exp $ */
 
 .update .project {
   padding-right: .25em;
diff --git a/modules/update/update.compare.inc b/modules/update/update.compare.inc
index 9a20b29..1c2e818 100644
--- a/modules/update/update.compare.inc
+++ b/modules/update/update.compare.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: update.compare.inc,v 1.8.2.9 2010/03/05 09:10:49 goba Exp $
 
 /**
  * @file
diff --git a/modules/update/update.css b/modules/update/update.css
index 14595af..57cef84 100644
--- a/modules/update/update.css
+++ b/modules/update/update.css
@@ -1,4 +1,3 @@
-/* $Id: update.css,v 1.3.2.2 2009/04/29 17:17:20 goba Exp $ */
 
 .update .project {
   font-weight: bold;
diff --git a/modules/update/update.fetch.inc b/modules/update/update.fetch.inc
index 41beef1..5cf70f3 100644
--- a/modules/update/update.fetch.inc
+++ b/modules/update/update.fetch.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: update.fetch.inc,v 1.7.2.7 2009/07/21 08:59:12 goba Exp $
 
 /**
  * @file
diff --git a/modules/update/update.info b/modules/update/update.info
index 7f8f24d..d92da58 100644
--- a/modules/update/update.info
+++ b/modules/update/update.info
@@ -1,12 +1,11 @@
-; $Id: update.info,v 1.1 2007/07/11 15:15:40 dries Exp $
 name = Update status
 description = Checks the status of available updates for Drupal and your installed modules and themes.
 version = VERSION
 package = Core - optional
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/update/update.install b/modules/update/update.install
index 734fcbb..8aa86f1 100644
--- a/modules/update/update.install
+++ b/modules/update/update.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: update.install,v 1.4.2.3 2010/05/19 15:03:58 goba Exp $
 
 /**
  * Implementation of hook_install().
diff --git a/modules/update/update.module b/modules/update/update.module
index ce6d7ce..fd45ed5 100644
--- a/modules/update/update.module
+++ b/modules/update/update.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: update.module,v 1.17.2.6 2009/12/16 17:30:00 goba Exp $
 
 /**
  * @file
diff --git a/modules/update/update.report.inc b/modules/update/update.report.inc
index 147d978..5565563 100644
--- a/modules/update/update.report.inc
+++ b/modules/update/update.report.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: update.report.inc,v 1.10.2.6 2009/11/06 07:26:21 goba Exp $
 
 /**
  * @file
diff --git a/modules/update/update.settings.inc b/modules/update/update.settings.inc
index 5eab866..117e9f7 100644
--- a/modules/update/update.settings.inc
+++ b/modules/update/update.settings.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: update.settings.inc,v 1.3.2.1 2009/04/29 17:17:21 goba Exp $
 
 /**
  * @file
diff --git a/modules/upload/upload.admin.inc b/modules/upload/upload.admin.inc
index bab92b2..fe46db2 100644
--- a/modules/upload/upload.admin.inc
+++ b/modules/upload/upload.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: upload.admin.inc,v 1.7 2008/01/10 20:22:57 goba Exp $
 
 /**
  * Form API callback to validate the upload settings form.
diff --git a/modules/upload/upload.info b/modules/upload/upload.info
index 0e80e0d..76732ca 100644
--- a/modules/upload/upload.info
+++ b/modules/upload/upload.info
@@ -1,12 +1,11 @@
-; $Id: upload.info,v 1.4 2007/06/08 05:50:57 dries Exp $
 name = Upload
 description = Allows users to upload and attach files to content.
 package = Core - optional
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/upload/upload.install b/modules/upload/upload.install
index 4c23f0c..421883b 100644
--- a/modules/upload/upload.install
+++ b/modules/upload/upload.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: upload.install,v 1.6.2.2 2009/01/06 15:46:38 goba Exp $
 
 /**
  * Implementation of hook_install().
diff --git a/modules/upload/upload.module b/modules/upload/upload.module
index 4c508bc..f3e6251 100644
--- a/modules/upload/upload.module
+++ b/modules/upload/upload.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: upload.module,v 1.197.2.7 2010/08/11 20:35:48 goba Exp $
 
 /**
  * @file
@@ -17,8 +16,8 @@ function upload_help($path, $arg) {
       $output .= '<p>'. t('Users with the upload files permission can upload attachments to posts. Uploads may be enabled for specific content types on the content types settings page. Each user role can be customized to limit or control the file size of uploads, or the maximum dimension of image files.') .'</p>';
       $output .= '<p>'. t('For more information, see the online handbook entry for <a href="@upload">Upload module</a>.', array('@upload' => 'http://drupal.org/handbook/modules/upload/')) .'</p>';
       return $output;
-    case 'admin/settings/upload':
-      return '<p>'. t('Users with the <a href="@permissions">upload files permission</a> can upload attachments. Users with the <a href="@permissions">view uploaded files permission</a> can view uploaded attachments. You can choose which post types can take attachments on the <a href="@types">content types settings</a> page.', array('@permissions' => url('admin/user/permissions'), '@types' => url('admin/settings/types'))) .'</p>';
+    case 'admin/settings/uploads':
+      return '<p>'. t('Users with the <a href="@permissions">upload files permission</a> can upload attachments. Users with the <a href="@permissions">view uploaded files permission</a> can view uploaded attachments. You can choose which post types can take attachments on the <a href="@types">content types settings</a> page.', array('@permissions' => url('admin/user/permissions', array('fragment' => 'module-upload')), '@types' => url('admin/content/types'))) .'</p>';
   }
 }
 
@@ -196,7 +195,7 @@ function upload_node_form_submit(&$form, &$form_state) {
   if (isset($form_state['values']['files'])) {
     foreach ($form_state['values']['files'] as $fid => $file) {
       // If the node was previewed prior to saving, $form['#node']->files[$fid]
-      // is an array instead of an object. Convert file to object for compatibility. 
+      // is an array instead of an object. Convert file to object for compatibility.
       $form['#node']->files[$fid] = (object) $form['#node']->files[$fid];
       $form_state['values']['files'][$fid]['new'] = !empty($form['#node']->files[$fid]->new);
     }
diff --git a/modules/user/user-picture.tpl.php b/modules/user/user-picture.tpl.php
index 1ccb78a..183f151 100644
--- a/modules/user/user-picture.tpl.php
+++ b/modules/user/user-picture.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: user-picture.tpl.php,v 1.2 2007/08/07 08:39:36 goba Exp $
 
 /**
  * @file user-picture.tpl.php
diff --git a/modules/user/user-profile-category.tpl.php b/modules/user/user-profile-category.tpl.php
index 8d74783..bea21f0 100644
--- a/modules/user/user-profile-category.tpl.php
+++ b/modules/user/user-profile-category.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: user-profile-category.tpl.php,v 1.2 2007/08/07 08:39:36 goba Exp $
 
 /**
  * @file user-profile-category.tpl.php
diff --git a/modules/user/user-profile-item.tpl.php b/modules/user/user-profile-item.tpl.php
index 5a3b083..70b1de9 100644
--- a/modules/user/user-profile-item.tpl.php
+++ b/modules/user/user-profile-item.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: user-profile-item.tpl.php,v 1.2 2007/08/07 08:39:36 goba Exp $
 
 /**
  * @file user-profile-item.tpl.php
diff --git a/modules/user/user-profile.tpl.php b/modules/user/user-profile.tpl.php
index d7e6d2c..8840749 100644
--- a/modules/user/user-profile.tpl.php
+++ b/modules/user/user-profile.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: user-profile.tpl.php,v 1.2.2.2 2009/10/06 11:50:06 goba Exp $
 
 /**
  * @file user-profile.tpl.php
diff --git a/modules/user/user-rtl.css b/modules/user/user-rtl.css
index 8bdab56..2e4c2b4 100644
--- a/modules/user/user-rtl.css
+++ b/modules/user/user-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: user-rtl.css,v 1.3 2007/11/27 12:09:26 goba Exp $ */
 
 #permissions td.permission {
   padding-left: 0;
diff --git a/modules/user/user.admin.inc b/modules/user/user.admin.inc
index 6cf44b6..eac39df 100644
--- a/modules/user/user.admin.inc
+++ b/modules/user/user.admin.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: user.admin.inc,v 1.18.2.2 2010/03/01 11:15:38 goba Exp $
 
 /**
  * @file
diff --git a/modules/user/user.css b/modules/user/user.css
index 3c78cdf..7b2163e 100644
--- a/modules/user/user.css
+++ b/modules/user/user.css
@@ -1,4 +1,3 @@
-/* $Id: user.css,v 1.7 2007/06/21 04:38:41 unconed Exp $ */
 
 #permissions td.module {
   font-weight: bold;
diff --git a/modules/user/user.info b/modules/user/user.info
index 97d8b24..2f0d99e 100644
--- a/modules/user/user.info
+++ b/modules/user/user.info
@@ -1,12 +1,11 @@
-; $Id: user.info,v 1.4 2007/06/08 05:50:57 dries Exp $
 name = User
 description = Manages the user registration and login system.
 package = Core - required
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/modules/user/user.install b/modules/user/user.install
index 8f9d359..b2dd5bb 100644
--- a/modules/user/user.install
+++ b/modules/user/user.install
@@ -1,5 +1,4 @@
 <?php
-// $Id: user.install,v 1.5.2.2 2009/07/01 20:51:56 goba Exp $
 
 /**
  * Implementation of hook_schema().
diff --git a/modules/user/user.js b/modules/user/user.js
index 7b8316b..46bfad0 100644
--- a/modules/user/user.js
+++ b/modules/user/user.js
@@ -1,4 +1,3 @@
-// $Id: user.js,v 1.6 2007/09/12 18:29:32 goba Exp $
 
 /**
  * Attach handlers to evaluate the strength of any password fields and to check
diff --git a/modules/user/user.module b/modules/user/user.module
index 8ebbca3..23ffa0f 100644
--- a/modules/user/user.module
+++ b/modules/user/user.module
@@ -1,5 +1,4 @@
 <?php
-// $Id: user.module,v 1.892.2.27 2010/08/06 11:58:09 goba Exp $
 
 /**
  * @file
@@ -130,27 +129,29 @@ function user_external_login($account, $edit = array()) {
 /**
  * Fetch a user object.
  *
- * @param $array
- *   An associative array of attributes to search for in selecting the
- *   user, such as user name or e-mail address.
+ * @param $user_info
+ *   Information about the user to load, consisting of one of the following:
+ *   - An associative array whose keys are fields in the {users} table (such as
+ *     uid, name, pass, mail, status) and whose values are the field's value.
+ *   - A numeric user ID.
  *
  * @return
  *   A fully-loaded $user object upon successful user load or FALSE if user
  *   cannot be loaded.
  */
-function user_load($array = array()) {
+function user_load($user_info = array()) {
   // Dynamically compose a SQL query:
   $query = array();
   $params = array();
 
-  if (is_numeric($array)) {
-    $array = array('uid' => $array);
+  if (is_numeric($user_info)) {
+    $user_info = array('uid' => $user_info);
   }
-  elseif (!is_array($array)) {
+  elseif (!is_array($user_info)) {
     return FALSE;
   }
 
-  foreach ($array as $key => $value) {
+  foreach ($user_info as $key => $value) {
     if ($key == 'uid' || $key == 'status') {
       $query[] = "$key = %d";
       $params[] = $value;
@@ -180,7 +181,7 @@ function user_load($array = array()) {
     while ($role = db_fetch_object($result)) {
       $user->roles[$role->rid] = $role->name;
     }
-    user_module_invoke('load', $array, $user);
+    user_module_invoke('load', $user_info, $user);
   }
   else {
     $user = FALSE;
@@ -772,17 +773,7 @@ function user_block($op = 'list', $delta = 0, $edit = array()) {
           // Perform database queries to gather online user lists.  We use s.timestamp
           // rather than u.access because it is much faster.
           $anonymous_count = sess_count($interval);
-          $authenticated_users = db_query('SELECT DISTINCT u.uid, u.name, s.timestamp FROM {users} u INNER JOIN {sessions} s ON u.uid = s.uid WHERE s.timestamp >= %d AND s.uid > 0 ORDER BY s.timestamp DESC', $interval);
-          $authenticated_count = 0;
-          $max_users = variable_get('user_block_max_list_count', 10);
-          $items = array();
-          while ($account = db_fetch_object($authenticated_users)) {
-            if ($max_users > 0) {
-              $items[] = $account;
-              $max_users--;
-            }
-            $authenticated_count++;
-          }
+          $authenticated_count = db_result(db_query('SELECT COUNT(DISTINCT s.uid) FROM {sessions} s WHERE s.timestamp >= %d AND s.uid > 0', $interval));
 
           // Format the output with proper grammar.
           if ($anonymous_count == 1 && $authenticated_count == 1) {
@@ -795,6 +786,10 @@ function user_block($op = 'list', $delta = 0, $edit = array()) {
           // Display a list of currently online users.
           $max_users = variable_get('user_block_max_list_count', 10);
           if ($authenticated_count && $max_users) {
+            $authenticated_users = db_query_range('SELECT u.uid, u.name, MAX(s.timestamp) AS timestamp FROM {users} u INNER JOIN {sessions} s ON u.uid = s.uid WHERE s.timestamp >= %d AND s.uid > 0 GROUP BY u.uid, u.name ORDER BY s.timestamp DESC', $interval, 0, $max_users);
+            while ($account = db_fetch_object($authenticated_users)) {
+              $items[] = $account;
+            }
             $output .= theme('user_list', $items, t('Online users'));
           }
 
diff --git a/modules/user/user.pages.inc b/modules/user/user.pages.inc
index 38538b8..e5f7e5b 100644
--- a/modules/user/user.pages.inc
+++ b/modules/user/user.pages.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: user.pages.inc,v 1.11.2.3 2010/06/02 12:03:07 goba Exp $
 
 /**
  * @file
diff --git a/profiles/default/default.profile b/profiles/default/default.profile
index 3977211..0836021 100644
--- a/profiles/default/default.profile
+++ b/profiles/default/default.profile
@@ -1,5 +1,4 @@
 <?php
-// $Id: default.profile,v 1.22 2007/12/17 12:43:34 goba Exp $
 
 /**
  * Return an array of the modules to be enabled when this profile is installed.
diff --git a/robots.txt b/robots.txt
index 752a8a8..804a074 100644
--- a/robots.txt
+++ b/robots.txt
@@ -1,4 +1,3 @@
-# $Id: robots.txt,v 1.9.2.1 2008/12/10 20:12:19 goba Exp $
 #
 # robots.txt
 #
@@ -25,7 +24,6 @@ Disallow: /misc/
 Disallow: /modules/
 Disallow: /profiles/
 Disallow: /scripts/
-Disallow: /sites/
 Disallow: /themes/
 # Files
 Disallow: /CHANGELOG.txt
@@ -42,7 +40,6 @@ Disallow: /xmlrpc.php
 # Paths (clean URLs)
 Disallow: /admin/
 Disallow: /comment/reply/
-Disallow: /contact/
 Disallow: /logout/
 Disallow: /node/add/
 Disallow: /search/
@@ -52,7 +49,6 @@ Disallow: /user/login/
 # Paths (no clean URLs)
 Disallow: /?q=admin/
 Disallow: /?q=comment/reply/
-Disallow: /?q=contact/
 Disallow: /?q=logout/
 Disallow: /?q=node/add/
 Disallow: /?q=search/
diff --git a/scripts/code-clean.sh b/scripts/code-clean.sh
index b0256a6..3338b6a 100644
--- a/scripts/code-clean.sh
+++ b/scripts/code-clean.sh
@@ -1,5 +1,4 @@
 #!/bin/sh
-# $Id: code-clean.sh,v 1.8 2005/08/11 13:02:08 dries Exp $
 
 find . -name "*~" -type f | xargs rm -f
 find . -name ".#*" -type f | xargs rm -f
diff --git a/scripts/code-style.pl b/scripts/code-style.pl
index 99501fb..f71bef9 100644
--- a/scripts/code-style.pl
+++ b/scripts/code-style.pl
@@ -1,5 +1,4 @@
 #!/usr/bin/perl -w
-# $Id: code-style.pl,v 1.14 2007/02/15 11:40:19 dries Exp $
 
 use Pod::Usage;
 use Getopt::Long qw(GetOptions);
diff --git a/scripts/cron-curl.sh b/scripts/cron-curl.sh
index df4ed99..9b168ab 100644
--- a/scripts/cron-curl.sh
+++ b/scripts/cron-curl.sh
@@ -1,4 +1,3 @@
 #!/bin/sh
-# $Id: cron-curl.sh,v 1.3 2006/08/22 07:38:24 dries Exp $
 
 curl --silent --compressed http://example.com/cron.php
diff --git a/scripts/cron-lynx.sh b/scripts/cron-lynx.sh
index 9ceb2db..904667a 100644
--- a/scripts/cron-lynx.sh
+++ b/scripts/cron-lynx.sh
@@ -1,4 +1,3 @@
 #!/bin/sh
-# $Id: cron-lynx.sh,v 1.3 2006/08/22 07:38:24 dries Exp $
 
 /usr/bin/lynx -source http://example.com/cron.php > /dev/null 2>&1
diff --git a/scripts/drupal.sh b/scripts/drupal.sh
index 8a371ea..981e071 100755
--- a/scripts/drupal.sh
+++ b/scripts/drupal.sh
@@ -1,6 +1,5 @@
 #!/usr/bin/php
 <?php
-// $Id: drupal.sh,v 1.4 2007/07/02 14:41:37 dries Exp $
 
 /**
  * Drupal shell execution script
diff --git a/sites/all/README.txt b/sites/all/README.txt
index e549030..7166d37 100644
--- a/sites/all/README.txt
+++ b/sites/all/README.txt
@@ -1,4 +1,3 @@
-// $Id: README.txt,v 1.3 2006/12/23 15:35:51 dries Exp $
 
 This directory should be used to place downloaded and custom modules
 and themes which are common to all sites. This will allow you to
diff --git a/sites/default/default.settings.php b/sites/default/default.settings.php
index f04f552..497bf11 100644
--- a/sites/default/default.settings.php
+++ b/sites/default/default.settings.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: default.settings.php,v 1.8.2.4 2009/09/14 12:59:18 goba Exp $
 
 /**
  * @file
@@ -93,6 +92,26 @@ $db_url = 'mysql://username:password@localhost/databasename';
 $db_prefix = '';
 
 /**
+ * Database default collation.
+ *
+ * All data stored in Drupal is in UTF-8. Certain databases, such as MySQL,
+ * support different algorithms for comparing, indexing, and sorting characters;
+ * a so called "collation". The default collation of a database normally works
+ * for many use-cases, but depending on the language(s) of the stored data, it
+ * may be necessary to use a different collation.
+ * Important:
+ * - Only set or change this value BEFORE installing Drupal, unless you know
+ *   what you are doing.
+ * - All database tables and columns should be in the same collation. Otherwise,
+ *   string comparisons performed for table JOINs will be significantly slower.
+ * - Especially when storing data in German or Russian on MySQL 5.1+, you want
+ *   to use the 'utf8_unicode_ci' collation instead.
+ *
+ * @see http://drupal.org/node/772678
+ */
+# $db_collation = 'utf8_general_ci';
+
+/**
  * Access control for update.php script
  *
  * If you are updating your Drupal installation using the update.php script
diff --git a/themes/bluemarine/block.tpl.php b/themes/bluemarine/block.tpl.php
index 99747ed..a2a9d3b 100644
--- a/themes/bluemarine/block.tpl.php
+++ b/themes/bluemarine/block.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: block.tpl.php,v 1.3 2007/08/07 08:39:36 goba Exp $
 ?>
   <div class="block block-<?php print $block->module; ?>" id="block-<?php print $block->module; ?>-<?php print $block->delta; ?>">
     <h2 class="title"><?php print $block->subject; ?></h2>
diff --git a/themes/bluemarine/bluemarine.info b/themes/bluemarine/bluemarine.info
index 16cdc60..1997bec 100644
--- a/themes/bluemarine/bluemarine.info
+++ b/themes/bluemarine/bluemarine.info
@@ -1,12 +1,11 @@
-; $Id: bluemarine.info,v 1.4 2007/06/08 05:50:57 dries Exp $
 name = Bluemarine
 description = Table-based multi-column theme with a marine and ash color scheme.
 version = VERSION
 core = 6.x
 engine = phptemplate
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/themes/bluemarine/box.tpl.php b/themes/bluemarine/box.tpl.php
index 5d1b1b9..09b07da 100644
--- a/themes/bluemarine/box.tpl.php
+++ b/themes/bluemarine/box.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: box.tpl.php,v 1.3 2007/08/07 08:39:36 goba Exp $
 ?>
   <div class="box">
     <?php if ($title) { ?><h2 class="title"><?php print $title; ?></h2><?php } ?>
diff --git a/themes/bluemarine/comment.tpl.php b/themes/bluemarine/comment.tpl.php
index 9dbf09f..736faa1 100644
--- a/themes/bluemarine/comment.tpl.php
+++ b/themes/bluemarine/comment.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: comment.tpl.php,v 1.7 2008/01/04 19:24:23 goba Exp $
 ?>
   <div class="comment<?php print ' '. $status; ?>">
     <?php if ($picture) {
diff --git a/themes/bluemarine/logo.png b/themes/bluemarine/logo.png
old mode 100755
new mode 100644
diff --git a/themes/bluemarine/node.tpl.php b/themes/bluemarine/node.tpl.php
index 0409460..657cc1a 100644
--- a/themes/bluemarine/node.tpl.php
+++ b/themes/bluemarine/node.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: node.tpl.php,v 1.7 2007/08/07 08:39:36 goba Exp $
 ?>
   <div class="node<?php if ($sticky) { print " sticky"; } ?><?php if (!$status) { print " node-unpublished"; } ?>">
     <?php if ($picture) {
diff --git a/themes/bluemarine/page.tpl.php b/themes/bluemarine/page.tpl.php
index 258a229..74e4962 100644
--- a/themes/bluemarine/page.tpl.php
+++ b/themes/bluemarine/page.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: page.tpl.php,v 1.28.2.1 2009/04/30 00:13:31 goba Exp $
 ?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml" lang="<?php print $language->language ?>" xml:lang="<?php print $language->language ?>" dir="<?php print $language->dir ?>">
 
diff --git a/themes/bluemarine/style-rtl.css b/themes/bluemarine/style-rtl.css
index 4c852e6..63c2352 100644
--- a/themes/bluemarine/style-rtl.css
+++ b/themes/bluemarine/style-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: style-rtl.css,v 1.5 2007/12/17 15:05:09 goba Exp $ */
 body {
   direction: rtl;
 }
diff --git a/themes/bluemarine/style.css b/themes/bluemarine/style.css
index 48c5147..961e938 100644
--- a/themes/bluemarine/style.css
+++ b/themes/bluemarine/style.css
@@ -1,4 +1,3 @@
-/* $Id: style.css,v 1.23 2007/12/17 15:05:09 goba Exp $ */
 
 /*
 ** HTML elements
diff --git a/themes/chameleon/chameleon.info b/themes/chameleon/chameleon.info
index 3816cc5..e077d2d 100644
--- a/themes/chameleon/chameleon.info
+++ b/themes/chameleon/chameleon.info
@@ -1,4 +1,3 @@
-; $Id: chameleon.info,v 1.4 2007/07/01 23:27:31 goba Exp $
 name = Chameleon
 description = Minimalist tabled theme with light colors.
 regions[left] = Left sidebar
@@ -12,8 +11,8 @@ stylesheets[all][] = common.css
 version = VERSION
 core = 6.x
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/themes/chameleon/chameleon.theme b/themes/chameleon/chameleon.theme
index 4b6e3d7..2fec1ba 100644
--- a/themes/chameleon/chameleon.theme
+++ b/themes/chameleon/chameleon.theme
@@ -1,5 +1,4 @@
 <?php
-// $Id: chameleon.theme,v 1.76.2.1 2009/04/30 00:13:31 goba Exp $
 
 /**
  * @file
diff --git a/themes/chameleon/common-rtl.css b/themes/chameleon/common-rtl.css
index 7be5393..9fbcd87 100644
--- a/themes/chameleon/common-rtl.css
+++ b/themes/chameleon/common-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: common-rtl.css,v 1.2 2007/06/05 09:15:02 dries Exp $ */
 
 body {
   direction: rtl;
diff --git a/themes/chameleon/common.css b/themes/chameleon/common.css
index 8b41eb3..4d3523d 100644
--- a/themes/chameleon/common.css
+++ b/themes/chameleon/common.css
@@ -1,4 +1,3 @@
-/* $Id: common.css,v 1.12 2007/06/04 11:10:38 goba Exp $ */
 
 /*
 ** HTML elements
diff --git a/themes/chameleon/logo.png b/themes/chameleon/logo.png
old mode 100755
new mode 100644
diff --git a/themes/chameleon/marvin/logo.png b/themes/chameleon/marvin/logo.png
old mode 100755
new mode 100644
diff --git a/themes/chameleon/marvin/marvin.info b/themes/chameleon/marvin/marvin.info
index 22ffdca..138290b 100644
--- a/themes/chameleon/marvin/marvin.info
+++ b/themes/chameleon/marvin/marvin.info
@@ -1,4 +1,3 @@
-; $Id: marvin.info,v 1.4 2007/06/08 05:50:57 dries Exp $
 name = Marvin
 description = Boxy tabled theme in all grays.
 regions[left] = Left sidebar
@@ -7,8 +6,8 @@ version = VERSION
 core = 6.x
 base theme = chameleon
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/themes/chameleon/marvin/style-rtl.css b/themes/chameleon/marvin/style-rtl.css
index 0ba8f30..2e540d4 100644
--- a/themes/chameleon/marvin/style-rtl.css
+++ b/themes/chameleon/marvin/style-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: style-rtl.css,v 1.2 2007/11/27 12:09:27 goba Exp $ */
 
 body {
   background-image: url(druplicon-watermark-rtl.png);
diff --git a/themes/chameleon/marvin/style.css b/themes/chameleon/marvin/style.css
index fa0df47..456bbc2 100644
--- a/themes/chameleon/marvin/style.css
+++ b/themes/chameleon/marvin/style.css
@@ -1,4 +1,3 @@
-/* $Id: style.css,v 1.8 2007/06/04 11:10:38 goba Exp $ */
 
 /*
 ** HTML elements
diff --git a/themes/chameleon/style-rtl.css b/themes/chameleon/style-rtl.css
index c4ea071..0bf1f34 100644
--- a/themes/chameleon/style-rtl.css
+++ b/themes/chameleon/style-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: style-rtl.css,v 1.3 2007/11/27 12:09:27 goba Exp $ */
 
 body {
   padding: 5em 3em 0 0;
diff --git a/themes/chameleon/style.css b/themes/chameleon/style.css
index b1da9e6..c4c5787 100644
--- a/themes/chameleon/style.css
+++ b/themes/chameleon/style.css
@@ -1,4 +1,3 @@
-/* $Id: style.css,v 1.7 2007/06/04 11:10:38 goba Exp $ */
 
 /*
 ** HTML elements
diff --git a/themes/engines/phptemplate/phptemplate.engine b/themes/engines/phptemplate/phptemplate.engine
index c40666f..9eadf48 100644
--- a/themes/engines/phptemplate/phptemplate.engine
+++ b/themes/engines/phptemplate/phptemplate.engine
@@ -1,5 +1,5 @@
 <?php
-// $Id: phptemplate.engine,v 1.69.2.1 2010/05/11 09:48:03 goba Exp $
+// $Id$
 
 /**
  * @file
diff --git a/themes/garland/block.tpl.php b/themes/garland/block.tpl.php
index e2771fc..e1167ad 100644
--- a/themes/garland/block.tpl.php
+++ b/themes/garland/block.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: block.tpl.php,v 1.3 2007/08/07 08:39:36 goba Exp $
 ?>
 <div id="block-<?php print $block->module .'-'. $block->delta; ?>" class="clear-block block block-<?php print $block->module ?>">
 
diff --git a/themes/garland/color/color.inc b/themes/garland/color/color.inc
index 88da819..02db92a 100644
--- a/themes/garland/color/color.inc
+++ b/themes/garland/color/color.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: color.inc,v 1.4 2007/12/14 17:00:14 goba Exp $
 
 $info = array(
 
diff --git a/themes/garland/color/preview.css b/themes/garland/color/preview.css
index 093da66..771be83 100644
--- a/themes/garland/color/preview.css
+++ b/themes/garland/color/preview.css
@@ -1,4 +1,3 @@
-/* $Id: preview.css,v 1.1 2006/10/29 13:17:38 unconed Exp $ */
 
 /* Positioning */
 #preview {
diff --git a/themes/garland/comment.tpl.php b/themes/garland/comment.tpl.php
index 95ad0d7..739057c 100644
--- a/themes/garland/comment.tpl.php
+++ b/themes/garland/comment.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: comment.tpl.php,v 1.10 2008/01/04 19:24:24 goba Exp $
 ?>
 <div class="comment<?php print ($comment->new) ? ' comment-new' : ''; print ' '. $status; print ' '. $zebra; ?>">
 
diff --git a/themes/garland/fix-ie-rtl.css b/themes/garland/fix-ie-rtl.css
index 67e3673..fe160a1 100644
--- a/themes/garland/fix-ie-rtl.css
+++ b/themes/garland/fix-ie-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: fix-ie-rtl.css,v 1.2 2007/11/09 22:14:41 goba Exp $ */
 
 body {
   /* Center layout */
diff --git a/themes/garland/fix-ie.css b/themes/garland/fix-ie.css
index 044dfcc..325aaef 100644
--- a/themes/garland/fix-ie.css
+++ b/themes/garland/fix-ie.css
@@ -1,4 +1,3 @@
-/* $Id: fix-ie.css,v 1.8.2.1 2008/02/05 09:27:26 goba Exp $ */
 
 /**
  * Garland, for Drupal 6.x
diff --git a/themes/garland/garland.info b/themes/garland/garland.info
index 0393f58..5539987 100644
--- a/themes/garland/garland.info
+++ b/themes/garland/garland.info
@@ -1,4 +1,3 @@
-; $Id: garland.info,v 1.5 2007/07/01 23:27:32 goba Exp $
 name = Garland
 description = Tableless, recolorable, multi-column, fluid width theme (default).
 version = VERSION
@@ -7,8 +6,8 @@ engine = phptemplate
 stylesheets[all][] = style.css
 stylesheets[print][] = print.css
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/themes/garland/maintenance-page.tpl.php b/themes/garland/maintenance-page.tpl.php
index bda5bf4..91987d7 100644
--- a/themes/garland/maintenance-page.tpl.php
+++ b/themes/garland/maintenance-page.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: maintenance-page.tpl.php,v 1.3.2.1 2009/04/30 00:13:31 goba Exp $
 
 /**
  * @file maintenance-page.tpl.php
diff --git a/themes/garland/minnelli/color/color.inc b/themes/garland/minnelli/color/color.inc
index cfeb5aa..a05fe66 100644
--- a/themes/garland/minnelli/color/color.inc
+++ b/themes/garland/minnelli/color/color.inc
@@ -1,5 +1,4 @@
 <?php
-// $Id: color.inc,v 1.4 2007/12/14 17:00:14 goba Exp $
 
 $info = array(
 
diff --git a/themes/garland/minnelli/minnelli.css b/themes/garland/minnelli/minnelli.css
index 7da0bee..cec148c 100644
--- a/themes/garland/minnelli/minnelli.css
+++ b/themes/garland/minnelli/minnelli.css
@@ -1,4 +1,3 @@
-/* $Id: minnelli.css,v 1.3.2.1 2008/02/05 09:27:26 goba Exp $ */
 
 /**
  * Minnelli, for Drupal 6.x
diff --git a/themes/garland/minnelli/minnelli.info b/themes/garland/minnelli/minnelli.info
index 3969e9b..8f2bf30 100644
--- a/themes/garland/minnelli/minnelli.info
+++ b/themes/garland/minnelli/minnelli.info
@@ -1,4 +1,3 @@
-; $Id: minnelli.info,v 1.7 2007/12/04 20:58:44 goba Exp $
 name = Minnelli
 description = Tableless, recolorable, multi-column, fixed width theme.
 version = VERSION
@@ -6,8 +5,8 @@ core = 6.x
 base theme = garland
 stylesheets[all][] = minnelli.css
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/themes/garland/node.tpl.php b/themes/garland/node.tpl.php
index f3999d7..184e11c 100644
--- a/themes/garland/node.tpl.php
+++ b/themes/garland/node.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: node.tpl.php,v 1.5 2007/10/11 09:51:29 goba Exp $
 ?>
 <div id="node-<?php print $node->nid; ?>" class="node<?php if ($sticky) { print ' sticky'; } ?><?php if (!$status) { print ' node-unpublished'; } ?>">
 
diff --git a/themes/garland/page.tpl.php b/themes/garland/page.tpl.php
index 3f6cbe8..8c7ff9a 100644
--- a/themes/garland/page.tpl.php
+++ b/themes/garland/page.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: page.tpl.php,v 1.18.2.1 2009/04/30 00:13:31 goba Exp $
 ?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="<?php print $language->language ?>" lang="<?php print $language->language ?>" dir="<?php print $language->dir ?>">
diff --git a/themes/garland/print.css b/themes/garland/print.css
index 41ff2fe..1b82c36 100644
--- a/themes/garland/print.css
+++ b/themes/garland/print.css
@@ -1,4 +1,3 @@
-/* $Id: print.css,v 1.3.2.1 2010/08/06 11:37:38 goba Exp $ */
 
 /**
  * Garland, for Drupal 5.0
diff --git a/themes/garland/style-rtl.css b/themes/garland/style-rtl.css
index f012b52..c9e783c 100644
--- a/themes/garland/style-rtl.css
+++ b/themes/garland/style-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: style-rtl.css,v 1.6 2007/12/17 15:05:10 goba Exp $ */
 
 html {
   direction: rtl;
diff --git a/themes/garland/style.css b/themes/garland/style.css
index e51e2f9..46b9b57 100644
--- a/themes/garland/style.css
+++ b/themes/garland/style.css
@@ -1,4 +1,3 @@
-/* $Id: style.css,v 1.38.2.4 2009/09/14 13:10:47 goba Exp $ */
 
 /**
  * Garland, for Drupal 6.x
diff --git a/themes/garland/template.php b/themes/garland/template.php
index b488ce5..f09f42d 100644
--- a/themes/garland/template.php
+++ b/themes/garland/template.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: template.php,v 1.16.2.3 2010/05/11 09:41:22 goba Exp $
 
 /**
  * Sets the body-tag class attribute.
diff --git a/themes/pushbutton/block.tpl.php b/themes/pushbutton/block.tpl.php
index d65b7f3..c787f7f 100644
--- a/themes/pushbutton/block.tpl.php
+++ b/themes/pushbutton/block.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: block.tpl.php,v 1.2 2007/08/07 08:39:36 goba Exp $
 ?>
 <div class="<?php print "block block-$block->module" ?>" id="<?php print "block-$block->module-$block->delta"; ?>">
   <div class="title"><h3><?php print $block->subject ?></h3></div>
diff --git a/themes/pushbutton/box.tpl.php b/themes/pushbutton/box.tpl.php
index cc571c5..d89d67b 100644
--- a/themes/pushbutton/box.tpl.php
+++ b/themes/pushbutton/box.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: box.tpl.php,v 1.3 2007/08/07 08:39:36 goba Exp $
 ?>
 <div class="box">
   <?php if ($title): ?>
diff --git a/themes/pushbutton/comment.tpl.php b/themes/pushbutton/comment.tpl.php
index 5e67ff0..9a4151b 100644
--- a/themes/pushbutton/comment.tpl.php
+++ b/themes/pushbutton/comment.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: comment.tpl.php,v 1.6 2008/01/04 19:24:24 goba Exp $
 ?>
 <div class="comment<?php print ' '. $status; ?>">
   <?php if ($picture) : ?>
diff --git a/themes/pushbutton/logo-active.jpg b/themes/pushbutton/logo-active.jpg
old mode 100755
new mode 100644
diff --git a/themes/pushbutton/logo-background.jpg b/themes/pushbutton/logo-background.jpg
old mode 100755
new mode 100644
diff --git a/themes/pushbutton/logo-hover.jpg b/themes/pushbutton/logo-hover.jpg
old mode 100755
new mode 100644
diff --git a/themes/pushbutton/logo.png b/themes/pushbutton/logo.png
old mode 100755
new mode 100644
diff --git a/themes/pushbutton/node.tpl.php b/themes/pushbutton/node.tpl.php
index 39eb522..68853f7 100644
--- a/themes/pushbutton/node.tpl.php
+++ b/themes/pushbutton/node.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: node.tpl.php,v 1.4 2007/08/07 08:39:36 goba Exp $
 ?>
 <div class="node<?php if ($sticky) { print " sticky"; } ?><?php if (!$status) { print " node-unpublished"; } ?>">
   <?php print $picture ?>
diff --git a/themes/pushbutton/page.tpl.php b/themes/pushbutton/page.tpl.php
index a3867aa..7443df1 100644
--- a/themes/pushbutton/page.tpl.php
+++ b/themes/pushbutton/page.tpl.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: page.tpl.php,v 1.25.2.2 2009/04/30 00:13:31 goba Exp $
 ?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml" lang="<?php print $language->language ?>" xml:lang="<?php print $language->language ?>" dir="<?php print $language->dir ?>">
 <head>
diff --git a/themes/pushbutton/pushbutton.info b/themes/pushbutton/pushbutton.info
index a5c40fe..1bd3d7d 100644
--- a/themes/pushbutton/pushbutton.info
+++ b/themes/pushbutton/pushbutton.info
@@ -1,12 +1,11 @@
-; $Id: pushbutton.info,v 1.4 2007/06/08 05:50:58 dries Exp $
 name = Pushbutton
 description = Tabled, multi-column theme in blue and orange tones.
 version = VERSION
 core = 6.x
 engine = phptemplate
 
-; Information added by drupal.org packaging script on 2010-08-11
-version = "6.19"
+; Information added by drupal.org packaging script on 2011-05-25
+version = "6.22"
 project = "drupal"
-datestamp = "1281559292"
+datestamp = "1306357015"
 
diff --git a/themes/pushbutton/style-rtl.css b/themes/pushbutton/style-rtl.css
index 45641da..1448829 100644
--- a/themes/pushbutton/style-rtl.css
+++ b/themes/pushbutton/style-rtl.css
@@ -1,4 +1,3 @@
-/* $Id: style-rtl.css,v 1.4 2008/01/25 21:20:26 goba Exp $ */
 
 body {
   direction: rtl;
diff --git a/themes/pushbutton/style.css b/themes/pushbutton/style.css
index d9b0c38..365f738 100644
--- a/themes/pushbutton/style.css
+++ b/themes/pushbutton/style.css
@@ -1,4 +1,3 @@
-/* $Id: style.css,v 1.24 2007/12/22 23:24:26 goba Exp $ */
 
 /*
 ** HTML elements
diff --git a/update.php b/update.php
index b62a10a..2f2c40a 100644
--- a/update.php
+++ b/update.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: update.php,v 1.252.2.3 2009/03/30 11:15:11 goba Exp $
 
 /**
  * @file
@@ -346,8 +345,8 @@ function update_results_page() {
           if (!count($queries)) {
             $output .= '<li class="none">No queries</li>';
           }
+          $output .= '</ul>';
         }
-        $output .= '</ul>';
       }
     }
     $output .= '</div>';
@@ -517,6 +516,31 @@ function update_fix_d6_requirements() {
       'primary key' => array('cid'),
     );
     db_create_table($ret, 'cache_block', $schema['cache_block']);
+
+    // Create the semaphore table now -- the menu system after 6.15 depends on
+    // this table, and menu code runs in updates prior to the table being
+    // created in its original update function, system_update_6054().
+    $schema['semaphore'] = array(
+      'fields' => array(
+        'name' => array(
+          'type' => 'varchar',
+          'length' => 255,
+          'not null' => TRUE,
+          'default' => ''),
+        'value' => array(
+          'type' => 'varchar',
+          'length' => 255,
+          'not null' => TRUE,
+          'default' => ''),
+        'expire' => array(
+          'type' => 'float',
+          'size' => 'big',
+          'not null' => TRUE),
+        ),
+      'indexes' => array('expire' => array('expire')),
+      'primary key' => array('name'),
+    );
+    db_create_table($ret, 'semaphore', $schema['semaphore']);
   }
 
   return $ret;
diff --git a/xmlrpc.php b/xmlrpc.php
index a5a1115..0f0300b 100644
--- a/xmlrpc.php
+++ b/xmlrpc.php
@@ -1,5 +1,4 @@
 <?php
-// $Id: xmlrpc.php,v 1.15 2005/12/10 19:26:47 dries Exp $
 
 /**
  * @file
